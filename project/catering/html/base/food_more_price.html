<!DOCTYPE html>
<html>
<head>
    <title>菜品价格维护</title>
    <script src="../../../../framework/core/boot.js"></script>
    <script>
        importFrameworkRes("view-form-bar");
    </script>

    <style type="text/css">
        body1 {
            overflow-x: hidden;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="app" style="width:500px;height:450px;padding-left:18px;padding-right:21px;">
        <view-form-bar id="vf" ref="vf"></view-form-bar>
        <el-row style="margin-bottom:10px;">
            <el-button-group>
                <el-button onclick="win.close();">保存</el-button>
                <el-button onclick="win.close();">放弃</el-button>
            </el-button-group>
        </el-row>
        <el-row>
            <el-form :model="form" ref="form" label-width="100px" label-position="right">
                <el-row>
                    <el-col :span="24">
                        <el-form-item label="选配项名称" required>
                            <el-input v-model="form.group_name" ref="name" />
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="16">
                        <el-form-item label="">
                            <el-checkbox v-model="form.flag_select" ref="name">允许多选</el-checkbox>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="序号">
                            <el-input v-model="form.sequence" />
                        </el-form-item>
                    </el-col>
                </el-row>
            </el-form>
        </el-row>
        <el-row style="padding-bottom:5px;">
            选配项：
        </el-row>
        <el-row v-for="item in prices">
            <el-col :span="18">
                <el-input v-model="item.name" @input="nameInput(item)"></el-input>
            </el-col>
            <el-col :span="6">
                <el-input v-model="item.price" style="text-align:right;"></el-input>
            </el-col>
        </el-row>
    </div>
</body>
</html>

<!-- appInit -->
<script>
    var app = new Vue({
        el: '#app',
        data: {
            form: {
                group_name: "",
                flag_base_price: false,
                flag_select: false,
                sequence: 1
            },

            prices: []
        },
        methods: {
            setMorePrice(morePrice) {
                this.prices = JSON.parse(morePrice || "[]");
                this.prices.push({
                    "name": "",
                    "price": 0
                });
            },
            nameInput(item) {
                if (this.prices[this.prices.length - 1].name) {
                    this.prices.push({
                        "name": "",
                        "price": 0
                    });
                }
                else {
                    for (let i = this.prices.length - 2; i >= 0; i--) {
                        if (!this.prices[i].name) {
                            this.prices.splice(i, 1);
                        }
                    }
                }
            }
        }
    });
</script>

<!-- winLoad -->
<script>
    function winLoad() {
        app.setMorePrice(win.para.morePrice);

        win.addEventListener("afterClose", () => {            
            app.prices.pop();
            app.prices.sort(function (item1, item2) {
                try {
                    let price1 = parseFloat(item1.price);
                    let price2 = parseFloat(item2.price);
                    return price2 - price1;
                }
                catch (e) {
                    return 0;
                }
            });
            let morePrice = JSON.stringify(app.prices);

            win.para.callback({ "morePrice": morePrice });
            return true;
        });
    }

</script>