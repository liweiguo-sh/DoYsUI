<!DOCTYPE html>
<html>
<head>
    <title>标准入库单</title>
	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script> 
		
	<script src="../../../../res/control/tab/xwf.tab.js" type="text/javascript"></script>
	<script src="../../../../res/control/tree/xwf.tree.js" type="text/javascript"></script>
	<script src="../../../../res/control/grid/xwf.grid.js" type="text/javascript"></script>
	<script src="../../../../res/control/grid/xwf.gridview.js" type="text/javascript"></script>
	<script src="../../../../res/control/uvform/xwf.uvform.js" type="text/javascript"></script>

	<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
</head>
<body>
	<div id="divDC"></div>
	<form id="frm" action="" target="example.training2_uview.In">
		<table id="tbForm" class="tbForm" style="width:705px;">
			<tr class="trH">
				<th style="width:150px;"></th>
				<th style="width:200px;"></th>
				<th style="width:150px;"></th>
				<th style="width:200px;"></th>
			</tr>
			<tr>
				<td>入库单号：</td>
				<td><input type="text" id="_cIn_key" value="" disabled="disabled" /></td>
				<td>日期：</td>
				<td><input type="text" id="_cIn_date" class="Wdate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" /></td>
			</tr>
			<tr>				
				<td>入库仓库：</td>
				<td><input id="_cWarehouse_id" type="text" controlType="dropdown" fieldValue="warehouse_id" fieldText="warehouse_name" visibleSearch="false" /></td>
				<td>金额：</td>
				<td><span id="_cIn_amount"></span></td>
			</tr>
			<tr>
				<td>备注：</td>
				<td colspan="3"><textarea id="_cIn_remark" rows="3" cols="0"></textarea></td>
			</tr>
			<tr>
				<td>制单人：</td>				
				<td><span id="_cCreator"></span></td>
				<td>制单时间：</td>
				<td><span id="_cCDate"></span></td>
			</tr>
			<tr>
				<td>修改人：</td>				
				<td><span id="_cModifier"></span></td>
				<td>修改时间：</td>
				<td><span id="_cMDate"></span></td>
			</tr>
		</table>
		<input id="_cIN_ID" type="hidden" value="" />
	</form>
    <div class="divButtons" style="margin-top:5px;">
        <input type="button" id="importDtlA" value="导入明细(全新)" onclick="importDtl('A');" />
        <input type="button" id="importDtlB" value="导入明细(累加)" onclick="importDtl('B');" />
        <input type="button" id="btnAddDetail" value="添加明细" onclick="btnAddDetail_click();" />
    </div>
	<div id="divTab" class="xwf_tab_divContainer" style="width:705px;height:250px;">
		<div id="divGridB" style="display:none"></div>
		<div id="divGridC" style="display:none"></div>
	</div>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
	var frmParent = null;
	var tabs = null;
	var gridviewB = null, gridviewC = null;	
	// ------------------------------------------------------------------------
	function formLoad() {
		frmParent = win.parentWindow.frm;
		vf.css(gId("tbForm"));

		tabs = new window.xwf_tab({ divContainer: gId("divTab"), tabClick: tab_click });
		tabs.addTab({ key: "tabB", text: "入库明细表", control: gId("divGridB") });
		tabs.addTab({ key: "tabC", text: "测试标签",  control: gId("divGridC") });
	}

	function tab_click(tab) {
		var inId = frm._cIN_ID.value.toInt();
		if (tab.key == "tabB") {
			if (gridviewB == null) {
				var prop = {
					divContainer: gId("divGridB"),
					viewKey: "ex_in_dtl",
					viewFilter: "in_id = " + inId,
					viewForm: "project/example/html/training2_uview/in_dtl.html"
				};
				gridviewB = new window.xwf_gridview(prop);
				gridviewB.beforeAddnew = function () {
					if (!vf.status.equals("view")) {
						showWarn("当前状态不允许添加明细记录。");
						return false;
					}
					return true;
				}
			}
			else {
				gridviewB.setViewFilter("in_id = " + inId);
			}
		}
		else if (tab.key == "tabC") {
			
		}
		return true;
    }

    function btnAddDetail_click() {
        gridviewB.addnew();
    }
</script>

<!-- vf.events -->
<script type="text/javascript">
	vf.afterAddnew = function () {
		frm._cIn_date.value = (new Date).toString();
    }
    vf.beforeSave = function () {
        // .....
        return true;
    }

	vf.afterMove = function () {
		tab_click(tabs.tabSelected);
		if (vf.status.equals("view")) {
			gId("importDtlA").disabled = false;
		}
		else {
			gId("importDtlA").disabled = true;
		}
		gId("importDtlB").disabled = gId("importDtlA").disabled;
	}	
</script>

<!-- 明细数据导入 -->
<script type="text/ecmascript">
	var importDtlType = "";
	function importDtl(importType) {
		importDtlType = importType;
		var prop = {
            parent: win
		};
		var para = {
			target: "example.training2_uview.InUploadDetailFile",
			uploadType: "importDetail",
			fileName: "importDetail_" + frm._cIN_ID.value,
			callback: afterImportDetail
		};
		topWin.uploadFile(prop, para);
	}
	function afterImportDetail(para) {
		if (g.a.send("processType=example.training2_uview.InImportDetail&actionType=importDetail" + importDtlType, { inId: frm._cIN_ID.value, filePathName: para.filePath + para.fileName }, true)) {
			if (g.a.OK) {
				var cReturn = g.a.cReturn;
				gId("_cIn_amount").innerHTML = cReturn.inAmount;
				tab_click(tabs.tabSelected);
			}
			else {
				return false;
			}
		}
		else {
			return false;
		}
	}
</script>