<!DOCTYPE html />
<html>
<head>
    <title>一次性测试窗口</title>
    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>

    <script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>

    <style type="text/css">
        .txt1 {
            width: 200px;
            height: 42px;
            line-height: 32px;
            text-align: right;
            padding: 5px;
            margin: 10px;
        }

        .divResult {
            padding: 10px;
            color: red;
        }
    </style>
</head>
<body onload="formLoad();">
    <div id="divButton" class="divButtons">
        <input type="button" id="btnOperate" onclick="btnOperate_click();" value="操作" />
        <input type="button" id="btnTest2" onclick="btnTest2_click();" value="数字格式化" />
        <input type="button" id="btnClose" onclick="btnClose_click();" value="关闭" />
    </div>
    <div>
        <input type="text" id="txtNum" class="txt1" value="1234.9" />
        <input type="text" id="txtFormat" class="txt1" value=",3" />
    </div>
    <div class="PanelA">
        一次性测试窗口...
    </div>
    <div id="divResult" class="divResult"></div>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
    var txt1 = gId("txtNum");
    var txtFormat = gId("txtFormat");
    var divResult = gId("divResult");
    // ------------------------------------------------------------------------
    function formLoad() {
        btnTest2_click();

        g.x.bindEnterEvent(txt1, function () {
            btnTest2_click();
        });
    }

    function btnOperate_click() {
        if (g.a.send("processType=example.liweiguo.TempTest&actionType=actionTypeA", {}, true)) {
            if (g.a.OK) {
                debug("当前操作成功。");
            }
            else {
                return false;
            }
        }
        else {
            return false;
        }
    }

    function btnClose_click() {
        win.close();
    }
</script>

<!-- 数字格式化 -->
<script>
    function btnTest2_click() {
        var number = txtNum.value.trim().toNumber();
        var format = txtFormat.value.trim();
        var result;

        //-------------------------------------------------
        result = format1(number, format);
         
        divResult.innerHTML = result;
        txtNum.select();
    }

    function format1(number, format) { 
        var result = "", scale;

        scale = format.replaceAll(",", "").toInt();
        number = number.toFixed(scale);

        if (format.indexOf(",") >= 0) {
            var arrNumber = (number + "").split(".");
            var arrTemp = arrNumber[0].split("");
            var len = arrTemp.length;
            for (var i = 1; i < len; i++) {
                result = (i % 3 == 0 ? "," : "") + arrTemp[len - i] + result;
            }
            result = arrTemp[0] + result;

            if (arrNumber.length > 1) {
                result += "." + arrNumber[1];
            }
        }
        else {
            result = number;
        }

        return result;
    }
</script>
