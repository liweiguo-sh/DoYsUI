<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>标签设计窗口</title>
	<style type="text/css">
		body {
			overflow: hidden;
		}
	</style>
	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>
</head>
<body onscroll="no">
	<div id="divDesigner">
		<object id="designer" classid="CLSID:E7120012-A986-4653-9728-76E11DBFA586" width="940">
        	未安装标签预览控件，请到登录页面下载并安装标签控件。
		</object>		
	</div>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
	var labelId = 0;
	var labelWidth = 80, labelHeight = 40, labelPoint = 600;

	var divDesigner = gId("divDesigner");
	var designer = gId("designer");
	var cvs = designer.CavasObj;
	// ----------------------------------------------------
	function formLoad() {
		labelId = win.para.labelId;
		labelWidth = parseInt(win.para.width) || labelWidth;
		labelHeight = parseInt(win.para.height) || labelHeight;
		labelPoint = parseInt(win.para.point) || labelPoint;

		formResize();
		initLabel();
	}

	function formResize() {
		divDesigner.style.width = (win.p.width - 1) + "px";
		divDesigner.style.height = (win.p.height - 0) + "px";

		designer.style.width = (divDesigner.clientWidth) + "px";
		designer.style.height = (divDesigner.clientHeight) + "px";
	}
</script>

<!-- canvas -->
<script type="text/javascript">
	function initLabel() {
		if (g.a.send("processType=example.training5_label.LabelFile&actionType=getLabelFileById", { labelId: labelId }, true)) {
			if (g.a.OK) {
				var cReturn = g.a.cReturn;
				dtbLabel = cReturn.dtbLabel;
				dtbElement = cReturn.dtbElement;
				dtbSequence = cReturn.dtbSequence;

				if (cReturn.isBlankLabel.equals("1")) {	// -- 空白新标签 --
					cvs.NewLabel(labelWidth, labelHeight, labelPoint);
				}
				else {
					cvs.OpenXML(dtbLabel.rows[0]["label_file"].value);
				}
				cvs.ZoomToFit();
			}
			else {
				return false;
			}
		}
		else {
			return false;
		}		
	}
</script>
<script type="text/javascript" for="designer" event="SaveLabel(xmlContent, blUntreated);">
	try {
		if (g.a.send("processType=example.training5_label.LabelFile&actionType=saveLabelFileById", { labelId: labelId, xmlContent: xmlContent}, true)) {
			if (g.a.OK) {
				showMsg("标签设计内容保存成功.");
			}
			else {
				return false;
			}
		}
		else {
			return false;
		}		
	}
	catch(e) {
		showErr(e.toString());
	}
</script>