<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="../../../res_plugin/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../../../res_plugin/zui-1.8.1-dist/css/zui.css" rel="stylesheet" />
    <link href="../../../res_plugin/zui-1.8.1-dist/css/zuiExt.css" rel="stylesheet" />

    <script src="../../../res/jscript/xwf.js"></script>
    <script src="../../../res/jscript/xwf.ajax.js"></script>
    <script src="../../../res/jscript/xwf.const.js"></script>
    <script src="../../../res/jscript/xwf.datatable.js"></script>

    <script src="../../../res_plugin/zui-1.8.1-dist/lib/jquery/jquery.js"></script>
    <script src="../../../res_plugin/zui-1.8.1-dist/js/zui.js"></script>
    <script src="../../../res_plugin/zui-1.8.1-dist/js/zuiExt.js"></script>

    <script src="../../h_spd/js/background.js"></script>

    <style type="text/css">
        body {
            margin: 0px;
            overflow: auto;
            background-color: #3c3c3c;
        }
        
        body::-webkit-scrollbar {
            display: none;
        }
        
        .divTitle {
            color: Yellow;
            font-family: 微软雅黑;
            text-align: right;
            padding-top: 30px;
            padding-right: 38%;
        }
        
        #divWorkBench {
            margin-left: auto;
            margin-right: auto;
            width: 70%;
            --background-color: LightGray;
            padding: 20px;
            overflow: auto;
        }
        
        #divTaskContainer {
            margin-left: auto;
            margin-right: auto;
            width: 90%;
        }
        
        .panel-a {
            border: 1px solid #3c3c3c;
            border-radius: 0px;
            margin-top: 5px;
            background-color: White;
        }
        
        .title-bar {
            font-family: 微软雅黑;
            font-size: 1.0em;
            color: LightGray;
            background-color: #455a70;
            border-bottom: 1px solid Gray;
            padding: 5px 5px 5px 20px;
        }
        
        .user-current {
            font-size: 4em;
            color: DarkGreen;
            height: 80px;
        }
        
        .station-current {
            font-size: 4em;
            color: RoyalBlue;
            height: 80px;
        }
        
        .user-text {
            font-size: 1.3em;
            font-family: 微软雅黑;
            color: #3c3c3c;
        }
        
        .btn-active:hover {
            color: Blue;
            cursor: pointer;
        }
        
        .div-content {
            font-size: 0.8em;
            border: 0px solid blue;
            padding: 20px 0px 20px 50px;
        }
        
        .td-content {
            font-size: 1em;
            font-family: 微软雅黑;
            line-height: 36px;
        }
        
        .td-content:hover {
            color: RoyalBlue;
            cursor: pointer;
        }
        
        .span-count {
            font-size: 1em;
            font-family: Arial Black;
        }
        
        .td-right {
            --border-left: 1px solid Gray;
            --padding-left: 20px;
            width: 50%;
        }
        
        .td-left {
            width: 50%;
        }
        
        .cert-alert {
            color: Red;
        }
        
        .minScreen #tablebox {
            margin-top: 0px !important;
        }
        
        .minScreen #boxws {
            height: 200px !important;
        }
        
        .minScreen #boxinfo {
            height: 400px !important;
        }
        
        .minScreen #boxws>table {
            margin-top: 9% !important;
        }
    </style>
</head>

<body onload="formLoad();">
    <div id="divWorkBench" style="height:100%;position:absolute; width:100%;">
        <div class="panel-a" style="width:900px;height: 300px;">
            <div class="title-bar"><i class="fa fa-cog btn-active" onclick="openMenuCollectSetup();"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span>我的常用菜单</span></div>
            <div id="divMenuCollect" class="div-content"></div>
        </div>
    </div>
</body>

</html>
<script type="text/javascript">
    var background = {};

    function formLoad() {
        var tdLogo = top.window.document.getElementById("tdTopLeft");
        // ------------------------------------------------
        top.statusBar.setValue("info", "技术支持：forten-tech.com");
        tdLogo.style.background = "url('project/g_spd/images/login/forten_logo.jpg') no-repeat center left";
        // tdLogo.style.width = "200px";

        // ------------------------------------------------
        setTimeout("initSubSystem();", 100);
        if (window.innerHeight < 600) {
            $("#divWorkBench").addClass("minScreen");
        }


        if (g.a.initNotice) g.a.initNotice("boxinfoContent", "boxinfoTitle");
    }

    function initSubSystem() {
        initStation();
        //refreshTask();
        refreshMenuCollect();
        //refreshUserArea();
        //if (topWin.wbRefreshInterval && topWin.wbRefreshInterval > 0) {
        //    setInterval("refreshTask();", topWin.wbRefreshInterval * 1000);
        //}
    }

    // 自定义页面
    background.openWindowDefine = function(menuUrl) {
        var url = g.appPath + "project/" + menuUrl + "?officeName=" + encodeURIComponent(topWin.office0Name) + "&stationName=" + encodeURIComponent(topWin.stationStorageName) + "&rnd=" + Math.random();
        var properties = "channelmode=1,resizable=1";
        if (!g.b.ie) {
            properties = "channelmode=1,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 52) + ",left=0,top=0,resizable=1";
        }
        window.open(url, "", properties);
        return false;
    }

    function onMenuClick(menu) {
        var menuKey = menu.menuKey;
        var menuText = menu.text;
        var menuUrl = menu.drMenu["menu_url"].value;

        if (menuKey.equals("PG100S005001")) {
            var url = g.appPath + "project/" + menuUrl + "?officeName=" + encodeURIComponent(topWin.office0Name) + "&stationName=" + encodeURIComponent(topWin.stationStorageName) + "&rnd=" + Math.random();
            var properties = "channelmode=1,resizable=1";
            if (!g.b.ie) {
                properties = "channelmode=1,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 52) + ",left=0,top=0,resizable=1";
            }
            window.open(url, "", properties);
            return false;
        } else if (menuKey.equals("PG100S005004")) {
            var url = g.appPath + "project/" + menuUrl + "?officeName=" + encodeURIComponent(topWin.office0Name) + "&stationName=" + encodeURIComponent(topWin.stationStorageName) + "&rnd=" + Math.random();
            var properties = "channelmode=1,resizable=1";
            if (!g.b.ie) {
                properties = "channelmode=1,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 52) + ",left=0,top=0,resizable=1";
            }
            window.open(url, "", properties);
            return false;
        } else if (menuKey.equals("PG100S005002")) {
            var url = g.appPath + "project/" + menuUrl + "?officeName=" + encodeURIComponent(topWin.office0Name) + "&stationName=" + encodeURIComponent(topWin.stationStorageName) + "&rnd=" + Math.random();
            var properties = "channelmode=1,resizable=1";
            if (!g.b.ie) {
                properties = "channelmode=1,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 52) + ",left=0,top=0,resizable=1";
            }
            window.open(url, "", properties);
            return false;
        } else if (menuKey.equals("PG100S005006")) {
            var url = g.appPath + "project/" + menuUrl + "?officeName=" + encodeURIComponent(topWin.office0Name) + "&stationName=" + encodeURIComponent(topWin.stationStorageName) + "&rnd=" + Math.random();
            var properties = "channelmode=1,resizable=1";
            if (!g.b.ie) {
                properties = "channelmode=1,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 52) + ",left=0,top=0,resizable=1";
            }
            window.open(url, "", properties);
            return false;
        } else if (menuKey.equals("PG100S005007")) {
            var url = g.appPath + "project/" + menuUrl + "?officeName=" + encodeURIComponent(topWin.office0Name) + "&stationName=" + encodeURIComponent(topWin.stationStorageName) + "&rnd=" + Math.random();
            var properties = "channelmode=1,resizable=1";
            if (!g.b.ie) {
                properties = "channelmode=1,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 52) + ",left=0,top=0,resizable=1";
            }
            window.open(url, "", properties);
            return false;
        } else if (menuKey.equals("PG100S005008")) {
            var url = g.appPath + "project/" + menuUrl + "?officeName=" + encodeURIComponent(topWin.office0Name) + "&stationName=" + encodeURIComponent(topWin.stationStorageName) + "&rnd=" + Math.random();
            var properties = "channelmode=1,resizable=1";
            if (!g.b.ie) {
                properties = "channelmode=1,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 52) + ",left=0,top=0,resizable=1";
            }
            window.open(url, "", properties);
            return false;
        } else if (menuKey.equals("PG100S005009")) {
            var url = g.appPath + "project/" + menuUrl + "?officeName=" + encodeURIComponent(topWin.office0Name) + "&stationName=" + encodeURIComponent(topWin.stationStorageName) + "&rnd=" + Math.random();
            var properties = "channelmode=1,resizable=1";
            if (!g.b.ie) {
                properties = "channelmode=1,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 52) + ",left=0,top=0,resizable=1";
            }
            window.open(url, "", properties);
            return false;
        } else if (menuKey.equals("PG100S003001")) {
            background.openWindowDefine(menuUrl);
        } else if (menuKey.equals("PG100S003002")) {
            background.openWindowDefine(menuUrl);
        } else {
            return true;
        }
    }
</script>
<!-- 工作台 -->
<script type="text/javascript">
    var dtbWorkBenchTask = null;
    var dtbMenuCollect = null;
    //==刷新用户名和站点==
    function refreshUserArea() {
        gId("divStationName").innerHTML = topWin.stationStorageName ? topWin.stationStorageName : "未设置";
        gId("divUserName").innerHTML = topWin.userName;
    }
    //==获取数据，刷新待办事务及资质预警区域==
    function refreshTask() {
        var dtbMenu = topWin.dtbMenu;
        var menuList = new Array();
        for (var i = 0; i < dtbMenu.rowCount; i++) {
            if (!dtbMenu.rows[i]["wb_flag"].value.toInt() == 0) {
                menuList.push("'" + dtbMenu.rows[i]["menu_key"].value + "'");
            }
        }
        if (menuList.length == 0) {
            return;
        }
        if (g.a.send("processType=com.xznext.Framework&actionType=getWorkBenchTask", {
                menuKeys: menuList.join(",")
            }, true)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                dtbWorkBenchTask = cReturn.dtbWorkBenchTask;
                //createTaskList0();
                //createTaskList1();
            }
        }
    }
    //==创建待办区域==
    function createTaskList0() {
        var html = new Array();
        var taskCount = 0;

        html.push("<table style='width:100%'>");
        for (var i = 0; i < dtbWorkBenchTask.rowCount; i++) {
            if (dtbWorkBenchTask.rows[i]["task_count"].value.toInt() > 0 && dtbWorkBenchTask.rows[i]["wb_area"].value.equals("0")) {
                var appendClass = "";
                if (taskCount % 2 == 0) {
                    html.push("<tr>");
                    html.push("    <td class='td-content td-left' onclick=menuClick(" + i + ")><i class='fa fa-exclamation'></i>&nbsp;&nbsp;" + dtbWorkBenchTask.rows[i]["wb_title"].value + "&nbsp;&nbsp<span class='span-count'>" + dtbWorkBenchTask.rows[i]["task_count"].value + "</span></td>");
                } else {
                    html.push("    <td class='td-content td-right' onclick=menuClick(" + i + ")><i class='fa fa-exclamation'></i>&nbsp;&nbsp;" + dtbWorkBenchTask.rows[i]["wb_title"].value + "&nbsp;&nbsp<span class='span-count'>" + dtbWorkBenchTask.rows[i]["task_count"].value + "</span></td>");
                    html.push("</tr>");
                }
                taskCount++;
            }
        }
        if (taskCount % 2 == 1) {
            html.push("</tr>");
        }
        html.push("</table>");
        gId("divTaskContainer0").innerHTML = html.join("");
        if (taskCount > 0) {
            top.playSound("mp3/msg2.mp3");
        }
    }
    //==创建资质预警区==
    function createTaskList1() {
        var html = new Array();
        var taskCount = 0;

        html.push("<table style='width:100%'>");
        for (var i = 0; i < dtbWorkBenchTask.rowCount; i++) {
            if (dtbWorkBenchTask.rows[i]["task_count"].value.toInt() > 0 && dtbWorkBenchTask.rows[i]["wb_area"].value.equals("1")) {
                var appendClass = "";
                if (taskCount % 2 == 0) {
                    html.push("<tr>");
                    html.push("    <td class='td-content td-left' onclick=menuClick(" + i + ")><i class='fa fa-exclamation cert-alert'></i>&nbsp;&nbsp;" + dtbWorkBenchTask.rows[i]["wb_title"].value + "&nbsp;&nbsp<span class='span-count'>" + dtbWorkBenchTask.rows[i]["task_count"].value + "</span></td>");
                } else {
                    html.push("    <td class='td-content td-right' onclick=menuClick(" + i + ")><i class='fa fa-exclamation cert-alert'></i>&nbsp;&nbsp;" + dtbWorkBenchTask.rows[i]["wb_title"].value + "&nbsp;&nbsp<span class='span-count'>" + dtbWorkBenchTask.rows[i]["task_count"].value + "</span></td>");
                    html.push("</tr>");
                }
                taskCount++;
            }
        }
        if (taskCount % 2 == 1) {
            html.push("</tr>");
        }
        html.push("</table>");
        gId("divTaskContainer1").innerHTML = html.join("");
    }
    //==模拟点击待办区/预警区菜单==
    function menuClick(index) {
        topWin.openMenu({
            menuKey: dtbWorkBenchTask.rows[index]["menu_key"].value
        });
    }
    //==站点设置==
    function openStationSetup() {
        try {
        	return true;
            topWin.openMenu({
                menuKey: "PG100M001004"
            });
        } catch (e) {
            showErr("打开工作站配置失败！");
        }
    }
    //==收藏菜单设定==
    function openMenuCollectSetup() {
        var prop = {
            url: "./project/xpas/html/frame/wb_menu_collect.html",
            modal: true
        };
        var para = {
            dtbMenuCollect: dtbMenuCollect,
            callback: function() {
                refreshMenuCollect();
            }
        }
        topWin.openWindow(prop, para);
    }
    //==获取数据，刷新菜单收藏区域==
    function refreshMenuCollect() {
        if (g.a.send("processType=com.xznext.Framework&actionType=getMenuCollect", {}, true)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                dtbMenuCollect = cReturn.dtbMenuCollect;
                dtbMenuCollect.sort("menu_key");
                createMenuCollect();
            }
        }
    }
    //==创建菜单收藏区==
    function createMenuCollect() {
        var html = new Array();
        var dtbMenu = topWin.dtbMenu;
        var nCount = 0;
        html.push("<table style='width:100%'>");
        for (var i = 0; i < dtbMenu.rowCount; i++) {
            var pos = dtbMenuCollect.find([dtbMenu.rows[i]["menu_key"].value]);
            if (pos >= 0) {
                if (nCount % 3 == 0) {
                    html.push("<tr>");
                }
                html.push("    <td class='td-content' style='width:33%' onclick=collectMenuClick(" + i + ")><i class='fa fa-file-text-o'></i>&nbsp;&nbsp;" + dtbMenu.rows[i]["menu_text"].value + "</td>");
                if (nCount % 3 == 2) {
                    html.push("</tr>");
                }
                nCount++;
            }
        }
        if (nCount % 3 != 0) {
            html.push("</tr>");
        }

        html.push("</table>");
        gId("divMenuCollect").innerHTML = html.join("");
    }
    //==模拟点击收藏菜单==
    function collectMenuClick(index) {
        topWin.openMenu({
            menuKey: topWin.dtbMenu.rows[index]["menu_key"].value
        });
    }
</script>