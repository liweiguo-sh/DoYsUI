<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>树控件样例</title>
	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>

	<script src="../../../../res/control/tree/xwf.tree.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>

	<style type="text/css">
		#divTree {
			width: 360px;
			height: 400px;
			overflow: auto;
			border: solid 1px Olive;
		}
	</style>
</head>
<body>
	<div id="divButton" class="divButtons">
		<input type="button" id="btnInitTree" onclick="btnInitTree_click();" value="初始化树" />
		<input type="button" id="btnGetCheckedNodes" onclick="btnGetCheckedNodes_click();" value="获取选中节点" />
		<input type="button" id="btnClose" onclick="btnClose_click();" value="关闭" />
	</div>
	<div id="divTree"></div>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
	var divTree = gId("divTree");
	// ------------------------------------------------------------------------
	function formLoad() {
		
	}
	function btnClose_click() {
		win.close();
	}

	function btnInitTree_click() {
		initTree();
	}
	function btnGetCheckedNodes_click() {
		getCheckedNodes();
	}
</script>

<!-- tree -->
<script type="text/javascript">
	function initTree() {
		var rootNodeKey = "";
		var jsonPara = {
			divContainer: divTree,
			imgPath: "../../../../res/control/tree/" + top.cssStyle + "/",
			title: "机构导航",
			showCheckBoxs: "all",
			selecteMode: "single",
			beforeExpand: beforeNodeExpand,
			nodeClick: onNodeClick
		};
		tree = new window.xwf_tree(jsonPara);

		rootNodeKey = "0" + tree.sd + topWin.officeId;
		tree.addNode({ key: rootNodeKey, text: topWin.officeShortname, officeId: topWin.officeId, officeNodeKey: topWin.officeNodeKey, officeName: topWin.officeName });
		tree.addNode({ key: rootNodeKey + tree.sd + "loading", text: "loading..." });

		tree.expand(rootNodeKey);
	}
	function beforeNodeExpand(node, firstExpand) {
		if (!firstExpand) return;
		tree.removeNode(node.key + tree.sd + "loading");
		loadOfficeNodes(node.key, node.officeId);
	}
	function loadOfficeNodes(pNodeKey, officeId) {
		if (g.a.send("processType=example.training1.Tree&actionType=getOfficeNodeData", { officeId: officeId }, true)) {
			if (g.a.OK) {
				var c = g.a.cReturn;
				var dtb = c.dtbOfficeNodeData;
				for (var i = 0; i < dtb.rowCount; i++) {
					var nodeText = dtb.rows[i]["office_shortname"].value;
					var officeId = dtb.rows[i]["office_id"].value;
					var officeName = dtb.rows[i]["office_name"].value;
					var checked = 0;

					if (officeId % 2 == 0) {
						checked = 1;
					}
					tree.addNode({ key: pNodeKey + tree.sd + officeId, text: nodeText, checked: checked, officeId: officeId, officeName: officeName, title: officeName });
					// -- 加载虚拟子节点 ------------------
					if (dtb.rows[i]["children"].value > 0) {
                        tree.addNode({ key: pNodeKey + tree.sd + officeId + tree.sd + "loading", text: "loading..." + dtb.rows[i]["children"].value });
					}
				}
			}
			else {
				return;
			}
		}
		else {
			return;
		}
	}

	function onNodeClick(node) {
		var officeId = node.officeId;
		var shortName = node.text;
		var officeName = node.officeName;
		debug("<br /><br />officeId = " + officeId + "<br />shortName = " + shortName + "<br />officeName = " + officeName);
	}

	function getCheckedNodes() {
		var node = null;
		var arrHtml = new Array();

		var arr = tree.getCheckedKeys();
		// ------------------------------------------------
		for (var i = 0; i < arr.length; i++) {
			node = tree.nodes[arr[i]];
			arrHtml.push("officeId = " + node.officeId + ", officeName = " + node.officeName);
		}
		debug(arrHtml.join("<br />"));
	}
</script>