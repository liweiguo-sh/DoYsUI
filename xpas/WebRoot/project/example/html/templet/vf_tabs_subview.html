<!DOCTYPE html">
<html>
<head>
    <title>多标签、子视图模板</title>
	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>
		
	<script src="../../../../res/control/tab/xwf.tab.js" type="text/javascript"></script>
	<script src="../../../../res/control/tree/xwf.tree.js" type="text/javascript"></script>
	<script src="../../../../res/control/grid/xwf.grid.js" type="text/javascript"></script>
	<script src="../../../../res/control/grid/xwf.gridview.js" type="text/javascript"></script>
	<script src="../../../../res/control/uvform/xwf.uvform.js" type="text/javascript"></script>

	<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
</head>
<body>
	<div id="divDC"></div>
	<form id="frm" action="" target="">
		<div id="divTab" class="xwf_tab_divContainer" style="width:705px;">
			<table id="tbForm" class="tbForm" style="width:705px;">
				<tr class="trH">
					<th style="width:150px;"></th>
					<th style="width:200px;"></th>
					<th style="width:150px;"></th>
					<th style="width:200px;"></th>
				</tr>
				<tr>				
					<td>单号：</td>
					<td><input type="text" id="_cSerialNO" value="" /></td>
					<td>日期：</td>
					<td><input type="text" id="_cDate" class="Wdate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" /></td>
				</tr>
				<tr>				
					<td>名称：</td>
					<td colspan="3"><input type="text" id="_cName" value="" /></td>
				</tr>
				<tr>				
					<td>类别1：</td>
					<td>
						<select id="_cType1_Key">
							<option value="P">采购</option>
							<option value="S">销售</option>
							<option value="O">其它</option>
						</select>
					</td>
					<td>类别2：</td>
					<td><input type="text" id="_cType2_ID" value="" textField="field_text" valueField="field_value" colCount="2" searchField="field_text,field_value,field_remark" /></td>
				</tr>
				<tr>
					<td>备注：</td>
					<td colspan="3"><textarea id="_cCallback_remark" rows="3" cols="0"></textarea></td>
				</tr>
			</table>			
			<div id="divGridB" style="display:none"></div>
			<div id="divGridC" style="display:none"></div>
		</div>
		<input id="_cID" type="hidden" value="" />
	</form>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
	var frmParent = null;
	var tabs = null;
	var gridviewB = null, gridviewC = null;	
	// ------------------------------------------------------------------------
	function formLoad() {
		frmParent = win.parentWindow.frm;
        vf.css(gId("tbForm"));
        vf.addExtraButton({ key: "printWi", text: "打印入库单" });

		tabs = new window.xwf_tab({ divContainer: gId("divTab"), tabClick: tab_click });
		tabs.addTab({ key: "tabA", text: "基本信息", control: gId("tbForm") });
		tabs.addTab({ key: "tabB", text: "子视图B", title: "子视图B标题", control: gId("divGridB") });
		tabs.addTab({ key: "tabC", text: "子视图C", title: "子视图C标题", control: gId("divGridC") });
	}

	function tab_click(tab) {
		var foreignKeyId = frm._cID.value.toInt();
		if (tab.key == "tabB") {
			if (gridviewB == null) {
				var prop = {
					divContainer: gId("divGridB"),
					viewKey: "viewB",
					viewFilter: "foreign_key_id = " + foreignKeyId,
					viewForm: "project/project_name/html/module_name/edit_form.html"
				};
				gridviewB = new window.xwf_gridview(prop);
				gridviewB.beforeAddnew = function () {
					if (!vf.status.equals("view")) {
						showWarn("当前状态不允许添加明细记录。");
						return false;
					}
					return true;
				}
			}
			else {
				gridviewB.setViewFilter("foreign_key_id = " + foreignKeyId);
			}
		}
		else if (tab.key == "tabC") {
			if (gridviewC == null) {
				var prop = {
					divContainer: gId("divGridC"),
					viewKey: "viewC",
					viewFilter: "foreign_key_id = " + foreignKeyId,
					viewForm: "project/project_name/html/module_name/edit_form.html"
				};
				gridviewC = new window.xwf_gridview(prop);
				gridviewC.beforeAddnew = function () {
					if (!vf.status.equals("view")) {
						showWarn("当前状态不允许添加明细记录。");
						return false;
					}
					return true;
				}
			}
			else {
				gridviewC.setViewFilter("foreign_key_id = " + foreignKeyId);
			}
		}
		return true;
	}
</script>

<!-- vf.events -->
<script type="text/javascript">
	vf.afterAddnew = function () {
		frm._cDate.value = (new Date).toString();
	}

	vf.afterMove = function () {
		tab_click(tabs.tabSelected);
	}	
</script>