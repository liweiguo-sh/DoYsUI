<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>新用户注册</title>
    <link href="../../../../res_plugin/bootstrap3.7/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <script src="../../../../res_plugin/jquery/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/bootstrap3.7/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

    <!--系统框架引用 -->
    <!-- <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script> -->
    <script src="../../js/xwf.js"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
    <script src="../../../../res/control/window/xwf.window.js" type="text/javascript"></script>
    <!-- zui引用 -->
    <link rel="stylesheet" href="../../../../res_plugin/zui-1.8.1-dist/css/zui.min.css" />
    <link rel="stylesheet" href="../../../../res_plugin/zui-1.8.1-dist/css/zuiExt.css" />
    <script src="../../../../res_plugin/zui-1.8.1-dist/js/zui.min.js"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/js/zuiExt.js"></script>
    <style type="text/css">
        .self-main-panel {
            width: 40%;
            min-width: 600px;
            margin-top: 30px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .self-input-panel {
            width: 80%;
            margin: 15px;
            border: 0px solid green;
        }
        
        a {
            color: #3498DB;
            cursor: pointer;
        }
        
        a:hover {
            color: #2980B9;
        }
        
        label {
            color: #7F8C8D;
            font-size: 1em;
            font-weight: lighter;
        }
        
        .checkbox>label {
            padding: 0;
        }
        
        input[type="checkbox"].agreementFlag {
            margin-top: 2px;
        }
    </style>
</head>

<body>
    <div class="panel panel-primary self-main-panel">
        <div class="panel-heading">
            新用户注册
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-xs-6">
                    <div class="self-input-panel">
                        <div role="form">
                            <div class="form-group">
                                <label for="_cCompany_name">企业名称<span style="color: red">&nbsp;&nbsp;*</span></label>
                                <input type="text" class="form-control" id="_cCompany_name" onclick="onFocusInput('name');" style="width: 100%" data-toggle="popover" data-container="body" data-content="企业全称，确保和工商营业执照上的名称保持一致">
                            </div>
                            <div class="form-group">
                                <label for="_cApplication_user_key">用户名<span style="color: red">&nbsp;&nbsp;*</span></label>
                                <input type="text" class="form-control" id="_cApplication_user_key" onclick="onFocusInput('user');" style="width: 100%" data-toggle="popover" data-container="body" data-content="6-20位，下列字符不能在用户名中出现：/\'$%^&*">
                            </div>
                            <div class="form-group">
                                <label for="_cPassword">登录密码<span style="color: red">&nbsp;&nbsp;*</span></label>
                                <input type="password" class="form-control" id="_cPassword" onclick="onFocusInput('pwd');" style="width: 100%" data-toggle="popover" data-container="body" data-content="6-20位，不能和用户名相同，并且不能全是数字或字母">
                            </div>
                            <div class="form-group">
                                <label for="_cRePassword">再输一次<span style="color: red">&nbsp;&nbsp;*</span></label>
                                <input type="password" class="form-control" id="_cRePassword" onclick="onFocusInput('pwd-r');" style="width: 100%" data-toggle="popover" data-container="body" data-content="请确保和输入的一致">
                            </div>
                            <div class="form-group">
                                <label for="_cMoblile">手机</label>
                                <input type="text" class="form-control" id="_cMobile" onclick="onFocusInput('mobile');" style="width: 100%" data-toggle="popover" data-container="body" data-content="11位，请确保手机能接收到验证码">
                            </div>
                            <!--div class="form-group">
									<label for="_cMoblile">图形验证码<span style="color:red">&nbsp;&nbsp;*</span></label>
									<div class="row">
										<div class="col-xs-6"><input type="text" class="form-control" id="_cCheckCode"  ></div>
										<div class="col-xs-6"><img id="imgCheckCode" src="" alt="" title="看不清楚，点击更换" onclick="getCheckCode();" /></div>
									</div>
								</div-->
                            <div class="form-group" style="display:none;">
                                <label for="divVerifyCode">短信验证码<span style="color: red">&nbsp;&nbsp;*</span></label>
                                <div class="row">
                                    <div class="col-xs-6" style="width: 50%">
                                        <input type="text" class="form-control" id="_cVerifyCode" placeholder=""></div>
                                    <div class="col-xs-6">
                                        <button id="btnGetVerifyCode" class="btn btn-warning" onclick="btnGetVerifyCode_click();">获取验证码</button></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-1" style="text-align: center;">
                    <div style="height: 400px; border-left: 1px solid lightGray; margin-top: 20px;"></div>
                </div>
                <div class="col-xs-5">
                    <label style="margin-top: 40px; color: Gray; font-family: 微软雅黑">已有帐号，直接<a id="aLogin" href="../login.html">登录</a></label>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-2">
                </div>
                <div class="col-xs-8">
                    <div style="width: 100%; text-align: center;">
                        <button class="btn btn-primary btn-block" style="width: 100%; margin-top: 50px;" onclick="btnCommit_click()">提交注册</button>
                        <div class="checkbox" style="font-size: 0.9em; text-align: left;">
                            <input type="checkbox" id="agreementFlag" class="agreementFlag" checked />
                            <label>我已阅读并同意</label>
                            <a href="agreement.html">《首营资料共享平台使用协议》</a>
                        </div>
                    </div>
                </div>
                <div class="col-xs-2">
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<!-- init -->
<script type="text/javascript">
    var urlLogin = urlPara["url_login"] || "../login.html";
    var restSecond = 0;

    init();
    // ----------------------------------------------------
    function init() {
        gId("aLogin").href = urlLogin;
    }
</script>

<script type="text/javascript">
    function onFocusInput(type) {
        if (type.equals("name")) {
            $('#_cCompany_name').popover('show');
        } else if (type.equals("user")) {
            $('#_cApplication_user_key').popover('show');
        } else if (type.equals("pwd")) {
            $('#_cPassword').popover('show');
        } else if (type.equals("pwd-r")) {
            $('#_cRePassword').popover('show');
        } else if (type.equals("mobile")) {
            $('#_cMobile').popover('show');
        } else {

        }
        //setTimeout(onUnfocusInput(type), 10000);
    }

    function onUnfocusInput(type) {
        if (type.equals("name")) {
            $('#_cCompany_name').popover('hide');
        } else if (type.equals("user")) {
            $('#_cApplication_user_key').popover('hide');
        } else if (type.equals("pwd")) {
            $('#_cPassword').popover('hide');
        } else if (type.equals("pwd-r")) {
            $('#_cRePassword').popover('hide');
        } else if (type.equals("mobile")) {
            $('#_cMobile').popover('hide');
        } else {

        }
    }

    function getCheckCode() {
        if (g.a.send("processType=com.xznext.xpas.Login&actionType=getCheckCode", {}, true)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                gId("imgCheckCode").src = g.xpasRunPath + "checkcode/" + cReturn.urlCheckCode;
            } else {
                return false;
            }
        } else {
            return false;
        }
    }

    function btnGetVerifyCode_click() {
        var mobile = gId("_cMobile").value;
        if (!(/^1[3|4|5|8][0-9]\d{4,8}$/.test(mobile))) {
            zuiExt.msg({
                msg: '请输入正确的手机号码！',
                type: 'warning'
            });
            return;
        }
        if (g.a.send("processType=g_mshare.anonymous.VerifyCode&actionType=requestVerifyCode", {
                bussinessType: "VC_LOGIN",
                mobile: mobile
            }, true)) {
            if (g.a.OK) {
                restSecond = 60;
                gId("btnGetVerifyCode").disabled = true;
                setInterval(function() {
                    if (restSecond == 0) {
                        gId("btnGetVerifyCode").disabled = false;
                        gId("btnGetVerifyCode").innerHTML = "发送验证码";
                    } else {
                        restSecond--;
                        gId("btnGetVerifyCode").innerHTML = restSecond + "秒后，可重新发送";
                    }
                }, 1000);
            }
        }
    }

    function btnCommit_click() {
        if (!$('#agreementFlag').is(':checked')) {
            zuiExt.msg({
                msg: '请先阅读《医疗基础数据平台使用协议》！',
                type: 'warning'
            });
            return;
        }

        var companyName = $("#_cCompany_name").val();
        var applicationUserKey = $("#_cApplication_user_key").val();
        var passWord = $("#_cPassword").val();
        var repassWord = $("#_cRePassword").val();
        var mobile = $("#_cMobile").val();
        var VerifyCode = $("#_cVerifyCode").val();

        if (companyName.trim() === '') {
            zuiExt.msg({
                msg: '企业名称不能为空！',
                type: 'warning'
            });
            $("#_cCompany_name").focus();
            return false;
        } else if (applicationUserKey.trim() === '') {
            zuiExt.msg({
                msg: '用户名不能为空！',
                type: 'warning'
            });
            $("#_cApplication_user_key").focus();
            return false;
        } else if (passWord.trim() === '') {
            zuiExt.msg({
                msg: '密码不能为空！',
                type: 'warning'
            });
            $("#_cPassword").focus();
            return false;
        } else if (repassWord.trim() === '') {
            zuiExt.msg({
                msg: '确认密码不能为空！',
                type: 'warning'
            });
            $("#_cRePassword").focus();
            return false;
        } else if (passWord.trim() !== repassWord.trim()) {
            zuiExt.msg({
                msg: '两次密码不一致，请重新确认密码！',
                type: 'warning'
            });
            $("#_cRePassword").val('').focus();
            return false;
        } else if (!(/^1[3|4|5|8][0-9]\d{4,8}$/.test(mobile))) {
            // zuiExt.msg({
            //     msg: '请输入正确的手机号码！',
            //     type: 'warning'
            // });
            //return;
        }

        var jsonPara = {
            companyName: companyName,
            applicationUserKey: applicationUserKey,
            password: passWord,
            password2: repassWord,
            mobile: mobile,
            verifyCode: VerifyCode
        };
        if (g.a.send("processType=g_mshare.anonymous.Register&actionType=register", jsonPara, true)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                zuiExt.msg({
                    msg: '账户注册成功，请登陆系统完善企业信息！',
                    type: 'success',
                    time: 5000
                });
                window.location.href = urlLogin + "?userKey=" + applicationUserKey;
            }
        }
    }
</script>