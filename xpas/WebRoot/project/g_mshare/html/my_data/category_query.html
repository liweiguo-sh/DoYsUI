<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>创建供应商</title>
    <link rel="stylesheet" href="../../../../res_plugin/zui-1.8.1-dist/css/zui.min.css" />
    <link rel="stylesheet" href="../../../../res_plugin/zui-1.8.1-dist/lib/chosen/chosen.min.css" />
    <script src="../../../../res_plugin/jquery/jquery-3.1.1.min.js"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/js/zui.min.js"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/lib/chosen/chosen.min.js"></script>
    <script src="../../js/xwf.js"></script>
    <script src="../../../../res/jscript/xwf.ajax.js"></script>
    <script src="../../../../res/jscript/xwf.const.js"></script>
    <script src="../../../../res/jscript/xwf.datatable.js"></script>
    <script src="../../../../res_plugin/echarts/echarts.min.js"></script>
    <style>
        html,
        body,
        .app,
        .container-fluid,
        .row .col-md-12,
        .echarts {
            width: 100%;
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
        
        .container-fluid .row {
            height: 50%;
        }
        
        .categoryCompany {
            border-bottom: solid 1px #ccc;
        }
    </style>
</head>

<body>
    <div class="app" id="app">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12 col-lg-12">
                    <div id="categoryCompany" class="echarts categoryCompany"></div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-lg-12">
                    <div id="categoryMatr" class="echarts"></div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    var category = {
        matrQry: null
    };
    category.toolbox = {
        show: true,
        feature: {
            saveAsImage: {}
        }
    };
    // 企业资质（饼图）
    category.categoryCompanyCharts = {
        id: gId('categoryCompany'),
        chart: null,
        loadChart: null,
        option: {},
        toolbox: category.toolbox
    };
    // 耗材资质 （饼图）
    category.categoryMatrCharts = {
        id: gId('categoryMatr'),
        chart: null,
        loadChart: null,
        option: {},
        toolbox: category.toolbox
    };

    // 格式化后台数据
    category.formatObjectData = function(arr) {
        var array = [],
            len = arr.length;
        for (var i = 0; i < len; i++) {
            var obj = {};
            Object.keys(arr[i]).forEach(function(key) {
                if (isNaN(key) && key !== '$') {
                    obj[key] = arr[i][key].value;
                }
            });
            array.push(obj);
        }
        return array;
    }

    category.getMatrQty = function() {
        if (g.a.send("processType=g_mshare.my_data.CategoryECharts&actionType=getMatrQty", {}, true)) {
            if (g.a.OK) {
                var rows = g.a.cReturn.data.rows;
                if (rows.length > 0 && rows[0] != "") {
                    var array = category.formatObjectData(rows);
                    category.matrQry = array[0]["matr_qty"];
                } else {
                    new $.zui.Messager('暂无耗材', {
                        type: 'warning'
                    }).show();
                    return false;
                }
            } else {
                new $.zui.Messager('获取耗材总数失败', {
                    type: 'danger'
                }).show();
                return false;
            }
        } else {
            return false;
        }
    }

    // 企业资质（饼图）图表设置
    category.categoryCompanyCharts.option = function(seriesData) {
        var option = {};
        option = {
            title: {
                text: '企业资质信息',
                subtext: '耗材总数：' + category.matrQry,
                left: '5'
            },
            legend: {
                type: 'plain',
                show: true,
                top: '80',
                left: '20',
                orient: 'vertical',
                data: seriesData
            },
            tooltip: {
                show: true,
                trigger: 'item',
                formatter: '{a}<br />{b}: {c} ({d}%)'
            },
            toolbox: category.categoryCompanyCharts.toolbox,
            xAxis: {
                show: false
            },
            yAxis: {
                show: false
            },
            series: {
                type: 'pie',
                name: '企业资质',
                center: ['60%', '50%'],
                radius: '50%',
                data: seriesData,
                label: {
                    normal: {
                        // formatter: '{a|{a}}{abg|}\n{hr|}\n  {b|{b}：}{c}  {per|{d}%}  ',
                        formatter: '{b}：{c}  ',
                        backgroundColor: '#eee',
                        borderColor: '#aaa',
                        borderWidth: 0,
                        borderRadius: 4,
                        shadowBlur: 3,
                        rich: {
                            a: {
                                color: '#999',
                                lineHeight: 22,
                                align: 'center'
                            },
                            abg: {
                                backgroundColor: '#fff',
                                width: '100%',
                                align: 'right',
                                height: 22,
                                borderRadius: [4, 4, 0, 0]
                            },
                            hr: {
                                borderColor: '#aaa',
                                width: '100%',
                                borderWidth: 0.5,
                                height: 0
                            },
                            b: {
                                fontSize: 16,
                                lineHeight: 33
                            },
                            per: {
                                color: '#eee',
                                backgroundColor: '#334455',
                                padding: [2, 4],
                                borderRadius: 2
                            }
                        }
                    }
                },
                itemStyle: {
                    emphasis: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            },
            color: ['#06a83f', '#CA8622']
        }
        return option;
    }

    // 企业资质（饼图）图表数据
    category.categoryCompanyCharts.loadChart = function() {
        var option = null;
        if (g.a.send("processType=g_mshare.my_data.CategoryECharts&actionType=queryCategoryCompany", {}, true)) {
            if (g.a.OK) {
                var rows = g.a.cReturn.data.rows;
                var seriesData = [];
                if (rows.length > 0 && rows[0] != "") {
                    var array = category.formatObjectData(rows);
                    for (var i = 0, len = array.length; i < len; i++) {
                        var obj = {
                            value: array[i]["cert_category_qty"],
                            name: array[i]["cert_category_name"]
                        };
                        seriesData.push(obj);
                    }
                } else {
                    new $.zui.Messager('暂无补货需求任务信息', {
                        type: 'warning'
                    }).show();
                    seriesData = [{
                        name: '医疗器械经营许可证（备案凭证）',
                        value: 0
                    }, {
                        name: '营业执照',
                        value: 0
                    }];
                }
                option = category.categoryCompanyCharts.option(seriesData);
                category.categoryCompanyCharts.chart.setOption(option);
            } else {
                new $.zui.Messager('获取补货需求任务信息失败', {
                    type: 'danger'
                }).show();
                return false;
            }
        } else {
            return false;
        }
    }

    // 耗材资质（饼图）图表设置
    category.categoryMatrCharts.option = function(seriesData) {
        var option = {};
        var total = 0;
        option = {
            title: {
                text: '耗材资质信息',
                subtext: '耗材总数：' + category.matrQry,
                left: '5'
            },
            legend: {
                type: 'plain',
                show: true,
                top: '80',
                left: '20',
                orient: 'vertical',
                data: seriesData
            },
            tooltip: {
                show: true,
                trigger: 'item',
                formatter: '{a}<br />{b}: {c} ({d}%)'
            },
            toolbox: category.categoryMatrCharts.toolbox,
            xAxis: {
                show: false
            },
            yAxis: {
                show: false
            },
            series: {
                type: 'pie',
                name: '耗材资质信息',
                center: ['60%', '50%'],
                radius: '50%',
                data: seriesData,
                label: {
                    normal: {
                        // formatter: '{a|{a}}{abg|}\n{hr|}\n  {b|{b}：}{c}  {per|{d}%}  ',
                        formatter: '{b}：{c}  ',
                        backgroundColor: '#eee',
                        borderColor: '#aaa',
                        borderWidth: 0,
                        borderRadius: 4,
                        shadowBlur: 3,
                        rich: {
                            a: {
                                color: '#999',
                                lineHeight: 22,
                                align: 'center'
                            },
                            abg: {
                                backgroundColor: '#fff',
                                width: '100%',
                                align: 'right',
                                height: 22,
                                borderRadius: [4, 4, 0, 0]
                            },
                            hr: {
                                borderColor: '#aaa',
                                width: '100%',
                                borderWidth: 0.5,
                                height: 0
                            },
                            b: {
                                fontSize: 16,
                                lineHeight: 33
                            },
                            per: {
                                color: '#eee',
                                backgroundColor: '#334455',
                                padding: [2, 4],
                                borderRadius: 2
                            }
                        }
                    }
                },
                itemStyle: {
                    emphasis: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            },
            color: ['#CA8622', '#6C40F9', '#61a0a8', '#A917BF', '#3280FC']
        }
        return option;
    }

    // 耗材资质（饼图）图表数据
    category.categoryMatrCharts.loadChart = function() {
        var option = null;
        if (g.a.send("processType=g_mshare.my_data.CategoryECharts&actionType=queryCategoryMatr", {}, true)) {
            if (g.a.OK) {
                var rows = g.a.cReturn.data.rows;
                var seriesData = [];
                if (rows.length > 0 && rows[0] != "") {
                    var array = category.formatObjectData(rows);
                    for (var i = 0, len = array.length; i < len; i++) {
                        var obj = {
                            value: array[i]["cert_category_qty"],
                            name: array[i]["cert_category_name"]
                        };
                        seriesData.push(obj);
                    }

                } else {
                    new $.zui.Messager('暂无耗材资质信息', {
                        type: 'warning'
                    }).show();
                    seriesData = [{
                        name: '产品图片',
                        value: 0
                    }, {
                        name: '厂商生产许可证',
                        value: 0
                    }, {
                        name: '厂商营业执照',
                        value: 0
                    }, {
                        name: '注册证',
                        value: 0
                    }, {
                        name: '授权书',
                        value: 0
                    }];
                }
                option = category.categoryMatrCharts.option(seriesData);
                category.categoryMatrCharts.chart.setOption(option);
            } else {
                new $.zui.Messager('获取耗材资质信息失败', {
                    type: 'danger'
                }).show();
                return false;
            }
        } else {
            return false;
        }
    }

    category.init = function() {
        category.getMatrQty();
        // 企业资质（饼图）初始化
        category.categoryCompanyCharts.chart = echarts.init(category.categoryCompanyCharts.id);
        category.categoryCompanyCharts.loadChart();

        // 耗材资质（饼图）初始化
        category.categoryMatrCharts.chart = echarts.init(category.categoryMatrCharts.id);
        category.categoryMatrCharts.loadChart();
    }

    category.init();
</script>

</html>