<!DOCTYPE html>
<html lang="zh-cn">
	<head>
		<title>我的产品信息</title>
		<link href="../../../../res_plugin/bootstrap3.7/bootstrap/css/bootstrap.min.css"	rel="stylesheet" type="text/css" />
		<link href="../../../../res_plugin/bootstrap3.7/bootstrap-table/css/bootstrap-table.css" rel="stylesheet" type="text/css" />

        <script src="../../../../res_plugin/jquery/jquery-3.1.1.min.js" type="text/javascript"></script>
		<script src="../../../../res_plugin/bootstrap3.7/bootstrap-table/js/bootstrap-table.js"	type="text/javascript"></script>
		 <script src="../../js/rstodata.js" type="text/javascript"></script>
        <script src="../../../../res_plugin/bootstrap3.7/bootstrap-table/js/bootstrap-table-local-zh-CN.js" type="text/javascript"></script>

        <!--系统框架引用 -->
         <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
        <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
        <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
        <script src="../../../../res/control/window/xwf.window.js" type="text/javascript"></script>
		<script src="../../../../res/control/upload/xwf.upload.js" type="text/javascript"></script>
       <script src="../../js/rstodata.js" type="text/javascript"></script>
		<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
		
		<style type="text/css">
			body{
				background-color:lightGray;
			}
			.self-panel-main{
				border:1px solid lightGray;
				width:80%;
				margin-top:20px;
				margin-bottom:20px;
				background-color:White;
				box-shadow: 3px 3px 3px #7F8C8D;
				padding:80px;
			}
			h5{
				color:#7F8C8D;
			}
			th{
				background-color:#3498DB;
				color:White;
				font-size:0.9em;
				text-align:center;
			}
		</style>
	</head>
	<body>
		<div class="container self-panel-main" id="div1" style="">
			
			<div class="row"><!--第3行-->
				
				<table id="tbMatrCertDocs" data-toggle="table" data-toolbar="#toolbar" data-height="600" 
					data-sort-name="no"
					data-sort-order="asc"
					data-pagination="true"
					data-search="true"
					data-page-size="10"
					data-page-list="[10,20,30]"
					kk_data-url="../json/data1.json">
					<thead>
						<tr>
							<th  style="width:10%" data-field="no">序</th>
							<th  style="width:50%" data-field="matr_name"  data-sortable="true">产品名称</th>
							<th  style="width:10%" data-field="push_name">推送企业</th>
							<th  style="width:20%" data-field="push_date"  data-sortable="true">推送时间</th>
							<th  style="width:10%" data-field="operate">操作</th>
						</tr>
					</thead>
				</table>
			</div><!--第3行.结束-->
		</div>
	
	</body>

</html>
<script type="text/javascript">
    var $table = $('#tbMatrCertDocs'),
		$button = $('#btnLoad');
		var companys="";
		var coms;
	$(function () {
	    editdata();
	});
	
	function addpro(){
		var para = {
				flowKey: "",
				viewKey: "v_material",
				isAddnew: true,
				callback:callback
			};
			var prop = {
				text: "产品定义",
				url: g.appPath + "project/g_mshare/html/base/material.html"
			};
			top.topWin.openFullWindow(prop, para);
	}
	function callback(){
	 editdata();
	}
	function editdata(){
	    if (g.a.send("processType=g_mshare.base.certMaterial&actionType=getProduct_js", {   "viewKey": "receive"}, true)) {
             if (g.a.OK) {
              var  comrs=g.a.cReturn.comrs
              var  matcertrs=g.a.cReturn.matrrs
                fillcom(comrs);
                fillmatr(matcertrs);
             }
             else {
                return false;
            }
        }
	}
	
	function fillcom(rs){
	
	}
	
    function fillmatr(rs){
   
      for(var i=0;i<rs.rowCount;i++){
      companys+=rs.rows[i]['company_id_from'].value+",";
          if (parseInt(rs.rows[i]['operate'].value)>0) {
             rs.rows[i]['operate'].value = " <i class='fa fa-wrench' style='color:#2980B9;cursor:pointer' ><span onclick='edit(" + rs.rows[i]['matr_id'].value + ","+rs.rows[i]['my_matr_id'].value+","+i+")'>查看</span></i>";
          } else {

              rs.rows[i]['operate'].value = "<i class='fa fa-close'  style='color:#E74C3C;cursor:pointer' ><span   onclick='del(" + rs.rows[i]['my_matr_id'].value + ")'>删除</span></i> &nbsp;&nbsp;<i class='fa fa-edit' style='color:#2980B9;cursor:pointer' ><span onclick='edit(" + rs.rows[i]['my_matr_id'].value + ")'>修改</span></i>";
          }
      }
      coms=companys.split(",");
      var rows = todatatable(rs);
      $table.bootstrapTable('load', rows);
	}



	function del(index) {
	    if (confirm("确认删除吗？") == true) {
	        if (g.a.send("processType=g_mshare.base.certMaterial&actionType=deleMatr", { my_matr_id: index, "viewKey": "receive" }, true)) {
	            if (g.a.OK) {
	                var cReturn = g.a.cReturn;
	                editdata();
	            }
	            else {
	                return false;
	            }
	        }
	    } else {
	    }
	}
	function edit(index,index1,i) {
		var para = {
				flowKey: "",
				viewKey: "v_material",
				isAddnew: false,
				primaryKey: "matr_id," + index,
				my_matr_id:"mmi,"+index1,
				company_id_from:coms[i],
				callback:callback

			};
			var prop = {
				text: "我接收的产品",
				url: g.appPath + "project/g_mshare/html/base/product_js.html"
			};
			
				top.topWin.openFullWindow(prop, para);
			
	}
</script>