<!DOCTYPE html>
<html>
<head>
    <title>首营商品导入</title>
	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
        
    <script src="../../../../res/control/toolbar/xwf.toolbar.js"></script>
    
	<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/excel.js"></script>

    <style type="text/css">
        #tbLayout {
            border-collapse: collapse;
        }

        #tbLayout td {
            padding: 0px;
            overflow: hidden;
            border: dotted 1px green;
            height: 40px;
            line-height: 40px;
            text-align: center;
        }
        
        /* 响应结果样式 */
        
        #serverInfo p, #serverInfo h3{
        	padding-left:20px;
        }
        #serverInfo h3{
        }
        
        .success{
        	color:green;
        }
        
        .fail{
        	color:red;
        }
    </style>
</head>
<body>    
	<div id="divToolbar"></div>
	<div class="PanelA" style="margin-top:5px;">
        <table id="tbLayout" style="width:98%;">
            <tr>
                <th style="width:200px;">最近使用文件</th>
                <th style="width:200px;">数据模板</th>
                <th style="">说明</th>
                <th style="width:300px;">操作</th>
            </tr>
            <tr>
                <td><a id="aFileSp" href="#" target="_blank" style="display:none;">首营供应商数据文件</a></td>
                <td>
                	<a href="../../templet/import/供应商导入模板.xls" class="download-item-link">供应商数据模板</a>
                </td>
                 <td style="text-align: left;">
                 	<p>excel格式为【Excel 97-2003工作簿(*.xls)】，格式与左侧数据模板中列顺序保持一致</p>
                 	<p>导入生成供应商部门对应登录用户等信息</p>
                 </td>
                <td><input type="button" id="btnSelFileSp" value="选择首营供应商数据文件并导入" onclick="selFileSp();" /></td>
            </tr>
        	<tr>
                <td></td>
                <td></td>
                 <td style="text-align: left;"></td>
                <td><input type="button" id="btnSelFileSp" value="品类初始化" onclick="initCategory();" /></td>
            </tr>
           <!--  <tr>
                <td><a id="aFileMatr" href="#" target="_blank" style="display:none;">首营商品数据文件</a></td>
                <td></td>
                <td></td>
                <td><input type="button" id="btnSelFileMatr" value="选择首营商品数据文件并导入" onclick="selFileMatr();" /></td>
            </tr> -->
            <tr>
                <td><a id="aFileMatrZip" href="javascript:;" target="_blank" style="display:none;">首营商品数据文件(zip格式)</a></td>
                <td>
                	<a href="../../templet/import/产品登记表-模板.xls" class="download-item-link">产品登记表-模板</a>
                </td>
                 <td  style="text-align: left;">
                 		<p>目前仅支持zip格式，excel格式为【Excel 97-2003工作簿(*.xls)】，格式与左侧数据模板中列顺序保持一致</p>
                 		<p>导入新增或更新耗材信息厂商信息等【肿瘤医院使用】</p>
                 </td>
                <td><input type="button" id="btnSelFileMatrZip" value="选择首营商品数据文件(zip)并导入" onclick="selFileMatrZip();" /></td>
            </tr>
            <tr>
                <td></td>
                <td>
                	<a href="../../templet/import/药品导入模板.xls" class="download-item-link">药品导入模板</a>
                </td>
                 <td  style="text-align: left;">
                 		<p>目前仅支持zip格式，excel格式为【Excel 97-2003工作簿(*.xls)】，格式与左侧数据模板中列顺序保持一致</p>
                 		<p>导入新增或更新耗材信息厂商信息等【960使用】</p>
                 </td>
                <td><input type="button" id="btnSelFileMatrZip" value="选择药品数据文件(zip)并导入" onclick="selFileMatrZip2();" /></td>
            </tr>
            <tr>
                <td>服务器响应结果</td>
                <td colspan="3" id="serverInfo" style="text-align:left;padding-left:9px;"></td>
            </tr>
        </table>
    </div>
    <div id="divResult" style="width:80%"></div>
</body>
</html>

<script src="../../../../res_plugin/jquery/jquery-1.11.3.min.js"></script>
<script src="../../../../res_plugin/jquery/jquery-migrate-1.2.1.js" title="jQuery migrate插件解决迁移兼容问题"></script>
<script src="../../../../res_plugin/jquery/jquery.jqprint-0.3.js" title="打印插件"></script>
 <script src="../../../../res/jscript/web_print.js" type="text/javascript"></script>
<!-- formLoad -->
<script type="text/javascript"> 
	// ------------------------------------------------------------------------
	function formLoad() { 
	    var json = {
	        domContainer: gId("divToolbar"),
	        height: "M",
	        onclick: barClick 
	    };
	    toolbar = new window.xwf_toolbar(json);

	    toolbar.addBar({ type: "button", key: "close", text: "<i class='fa fa-close'></i>  关闭" });
	    toolbar.addBar({ type: "button", key: "print", text: "打印服务器响应结果" });
	}

	function btnOperate_click() {
		if (g.a.send("processType=package.subpkg.ClassName&actionType=actionA", { paraNameX: paraValueX }, true)) {
			if (g.a.OK) {
				showMsg("当前操作成功。");
			}
			else {
				return false;
			}
		}
		else {
			return false;
		}
	}
</script>

<!-- 工具栏 -->
<script type="text/javascript">
    function barClick(para) {
        var btnKey = para.key;
        if (para.key.equals("close")) {
            win.close();
        }else  if (para.key.equals("print")) {
        	$("#serverInfo").jqprint({
	    		 debug: false, //如果是true则可以显示iframe查看效果
	    	     //（iframe默认高和宽都很小，可以再源码中调大），默认是false
	    	     importCSS: true, //true表示引进原来的页面的css，默认是true。
	    	     //（如果是true，先会找$("link[media=print]")，若没有会去找$("link")中的css文件）
	    	     printContainer: true, //表示如果原来选择的对象必须被纳入打印
	    	     //（注意：设置为false可能会打破你的CSS规则）。
	    	     operaSupport: true//表示如果插件也必须支持歌opera浏览器，在这种情况下，
	    	     //它提供了建立一个临时的打印选项卡。默认是true
	    	});
        }
        else {
            showMsg("Unknown bar: " + btnkey + ", please check it.");
        }
    }
</script>

<!-- upload file -->
<script type="text/javascript">
    function selFileMatr() {
		var prop = {
			parent: win
		};
		var para = {
		    target: "g_mshare.import_data.UploadFileMatr",
			// uploadType: "xpasExample",
			// fileName: "xpasExample",
			callback: callbackFileMatrSelect
		};
		topWin.uploadFile(prop, para);
	}
    function callbackFileMatrSelect(para) {
        var fileXls = para.filePath + para.fileName;
        var urlXls = para.fileUrl;
        var localFile = para.localFile;
        // ------------------------------------------------
        gId("aFileMatr").href = urlXls;
        gId("aFileMatr").style.display = "";

        //openExcel(localFile);
        //var arrData = workSheetToArray();
        //for (var i = 0; i < arrData.length; i++) {
        //    arrData[i] = arrData[i].replaceAll(g.c.CHAR2, "&nbsp;&nbsp;&nbsp;&nbsp;");
        //}
        //divResult.innerHTML = arrData.join("<br />");

        //return;
        // ------------------------------------------------
        if (g.a.send("processType=g_mshare.import_data.ImportMatrData&actionType=importMataDataByXls", { fileXls: fileXls }, true)) {
            if (g.a.OK) {
                //showMsg("首营商品数据导入成功，请查询并检查结果是否正确。");
            }
            else {
                return false;
            }
        }
        else {
            return false;
        }
    }
    
    
    //选择商品zip文件
    function selFileMatrZip() {
		var prop = {
			parent: win
		};
		var para = {
		    target: "g_mshare.import_data.UploadFileMatr",
			uploadType: "zip",
			callback: callbackFileMatrZipSelect,
			beforeUpload:function(param){//上传前文件校验
				if(param && param.extName && !param.extName.equals("ZIP")){
					showWarn("请选择zip格式的数据文件");
					return false;
				}
				return true;
			}
		};
		topWin.uploadFile(prop, para);
	}
	
	
	//选择商品zip文件 回调函数
	var aFileMatrZip= gId("aFileMatrZip");
    function callbackFileMatrZipSelect(para) {
        var urlZipObPath = para.filePath+para.fileName;
       aFileMatrZip.text=para.originalName;
       aFileMatrZip.style.display = "";
        if (g.a.send("processType=g_mshare.import_data.ImportMatrData&actionType=importMataDataByZIP", { urlZipObPath: urlZipObPath,fileUrl:para.fileUrl}, false)) {
        	var cReturn = g.a.cReturn;
        	console.log(cReturn)
           	gId("serverInfo").innerHTML=cReturn.errorInfos?cReturn.errorInfos:"服务器未返回有效信息";
        }
    }
    
      //选择商品zip文件
    function selFileMatrZip2() {
		var prop = {
			parent: win
		};
		var para = {
		    target: "g_mshare.import_data.UploadFileMatr",
			uploadType: "zip",
			callback: callbackFileMatrZipSelect2,
			beforeUpload:function(param){//上传前文件校验
				if(param && param.extName && !param.extName.equals("ZIP")){
					showWarn("请选择zip格式的数据文件");
					return false;
				}
				return true;
			}
		};
		topWin.uploadFile(prop, para);
	}
	
	
	//选择商品zip文件 回调函数
    function callbackFileMatrZipSelect2(para) {
        var urlZipObPath = para.filePath+para.fileName;
        if (g.a.send("processType=g_mshare.import_data.ImportMatrData&actionType=importMataDataFor960", { urlZipObPath: urlZipObPath,fileUrl:para.fileUrl}, false)) {
        	var cReturn = g.a.cReturn;
           	gId("serverInfo").innerHTML=cReturn.errorInfos?cReturn.errorInfos:"服务器未返回有效信息";
        }
    }
</script>
<!-- upload SP file -->
<script type="text/javascript">
    function selFileSp() {
		var prop = {
			parent: win
		};
		var para = {
		    target: "g_mshare.import_data.UploadFileSp",
			// uploadType: "xpasExample",
			// fileName: "xpasExample",
			callback: callbackFileSpSelect
		};
		topWin.uploadFile(prop, para);
	}
    function callbackFileSpSelect(para) {
        var fileXls = para.filePath + para.fileName;
        var urlXls = para.fileUrl;
        var localFile = para.localFile;
        // ------------------------------------------------
        gId("aFileSp").href = urlXls;
        gId("aFileSp").style.display = "";

        //openExcel(localFile);
        //var arrData = workSheetToArray();
        //for (var i = 0; i < arrData.length; i++) {
        //    arrData[i] = arrData[i].replaceAll(g.c.CHAR2, "&nbsp;&nbsp;&nbsp;&nbsp;");
        //}
        //divResult.innerHTML = arrData.join("<br />");

        //return;
        // ------------------------------------------------
        if (g.a.send("processType=g_mshare.import_data.ImportSpData&actionType=importSpDataByXls", { fileXls: fileXls }, true)) {
            if (g.a.OK) {
                showMsg("首营供应商数据导入成功，请查询并检查结果是否正确。");
            }
            else {
                return false;
            }
        }
        else {
            return false;
        }
    }
</script>

<!-- 初始化品类 --> 
<script type="text/javascript">
    function initCategory() {
        if (g.a.send("processType=g_mshare.import_data.InitData&actionType=initData_ver_2012", {   }, true)) {
            if (g.a.OK) {
                debug("耗材品类目录初始化成功，请查询并检查结果是否正确。");
            }
            else {
                return false;
            }
        }
        else {
            return false;
        }
    }
</script>
