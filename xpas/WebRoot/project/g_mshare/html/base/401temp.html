<!DOCTYPE html>
<html>
<head>
    <title>401SPD数据同步（临时、一次性）</title>
    <link href="../../../../res_plugin/bootstrap3.7/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../../res_plugin/bootstrap3.7/bootstrap-table/css/bootstrap-table.css" rel="stylesheet" type="text/css" />

    <script src="../../../../res_plugin/jquery/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/bootstrap3.7/bootstrap-table/js/bootstrap-table.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/bootstrap3.7/bootstrap-table/js/bootstrap-table-local-zh-CN.js" type="text/javascript"></script>
    <script src="../../js/rstodata.js" type="text/javascript"></script>
    <!--系统框架引用 -->
    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
    <script src="../../../../res/control/window/xwf.window.js" type="text/javascript"></script>
    <script src="../../../../res/control/upload/xwf.upload.js" type="text/javascript"></script>
    <script src="../../js/rstodata.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>

    <style type="text/css">
        body {
            background-color: lightGray;
        }

        .self-panel-main {
            border: 1px solid lightGray;
            width: 80%;
            margin-top: 20px;
            margin-bottom: 20px;
            background-color: White;
            box-shadow: 3px 3px 3px #7F8C8D;
            padding: 80px;
        }

        h5 {
            color: #7F8C8D;
        }

        th {
            background-color: #3498DB;
            color: White;
            font-size: 0.9em;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="container self-panel-main" id="div1" style="">


        <div class="row">
            <!--第3行-->
            <div id="toolbar">
                <button id="btnLoadInline" class="btn btn-default" onclick="synchronizeSpdInline();">获取401SPD耗材数据</button>

            </div>
        </div><!--第3行.结束-->
    </div>

</body>

</html>
<script type="text/javascript">

    $(function () {

    });


    //在线获取401spd耗材数据
    function synchronizeSpdInline() {
        var officeId = topWin.officeId;
        var userKey = topWin.userKey;
        var serverName = topWin.serverName;
        var companyCode = getcompanyCode(officeId);
        if (!"SPD-401".equals(companyCode)) {
            showMsg("此功能仅对401用户开放！");
            return;
        }
        $.ajax({
            type: "post",
            async: false,
            url: 'http://localhost:7000/xpas/filter.do?processType=g_spd.anonymous.Synchronize&actionType=SynchronizeGetmaterial',
            data: { "serverName": serverName },
            dataType: "jsonp",
            jsonp: "callback",
            success: function (data) {
                var newjson;
                newjson = JSON.stringify(data);

                //--把从SPD服务器获取的json耗材数据存入mshare本地库----------------
                getMaterialIntoMshare(newjson, officeId, userKey);

            },
            error: function (xhr, status, error, res) {
                alert("获取数据遇到错误" + error);
                //return false;
            }
        });
    }


    function getcompanyCode(officeId) {
        if (g.a.send("processType=g_mshare.base.product&actionType=getCompanyCode", { officeId: officeId, "viewKey": "receive" }, true)) {
            if (g.a.OK) {
                var companyCode = g.a.cReturn.companyCode;
            }
        }
        return companyCode;
    }
    //--把从服务器获取的json耗材数据存入mshare本地库----------------
    function getMaterialIntoMshare(rsjson, officeId, userKey) {
        if (g.a.send("processType=g_mshare.base.product&actionType=SaveSynchronizedMaterial", { rsjson: rsjson, officeId: officeId, userKey: userKey, "viewKey": "receive" }, true)) {
            if (g.a.OK) {
                showMsg("在线导入成功！");
                win.close();
            }
        }

    }





</script>