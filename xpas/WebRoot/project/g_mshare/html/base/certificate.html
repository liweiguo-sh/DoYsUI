<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>企业信息修改</title>
    <script src="../../../../res_plugin/jquery/jquery-3.1.1.min.js" type="text/javascript"></script>
	<link href="../../../../res_plugin/bootstrap3.7/bootstrap/css/bootstrap.min.css"	rel="stylesheet" type="text/css" />
	<script src="../../../../res_plugin/bootstrap3.7/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

    <script src="../../js/rstodata.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
    <script src="../../../../res/control/toolbar/xwf.toolbar.js" type="text/javascript"></script>
    <script src="../../../../res/control/uvform/xwf.uvform.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/util/chinese_py.js" type="text/javascript"></script>

	<script src="../../../../res/control/upload/xwf.upload.js" type="text/javascript"></script>
	<script src="../../../../res/control/upload/xwf.upload_core.js" type="text/javascript"></script>
	<link href="../../../../res/control/upload/style3/xwf.upload.css" rel="stylesheet"	type="text/css" />
	<script src="../../js/doc_center.js" type="text/javascript"></script>
	<style type="text/css">
        body
        {
            background-color: lightGray;
        }
        a
        {
            color: #3498DB;
            cursor: pointer;
        }
        a:hover
        {
            color: #2980B9;
        }
        .self-panel-main
        {
			width:80%;
			margin-left:auto;
			margin-right:auto;
			margin-top:20px;
            background-color: White;
            box-shadow: 3px 3px 3px #888888;
            padding: 80px;
        }
        .self-panel-nav
        {
            margin-top: 20px;
            margin-left: auto;
            margin-right: auto;
            width: 60%;
            border: 0px solid green;
        }
        .self-nav-inactive
        {
            color: DarkGray;
            font-size: 1.5em;
        }
        .self-nav-active
        {
            color: #3498DB;
            font-size: 1.8em;
        }
        .div-title
        {
            font-size: 1.3em;
            font-family: 微软雅黑;
            color: #3498DB;
            width: 100%;
            border-bottom: 1px solid #3498DB;
        }
        .div-input-info
        {
            font-size: 0.9em;
            font-family: 微软雅黑;
            color: #2C3E50;
            width: 90%;
            margin-left: 20px;
            margin-top: 50px;
			margin-bottom: 50px;
        }
        .div-cert
        {
            width: 100%;
            margin-bottom: 50px;
        }
        .div-cert td
        {
            text-align: center;
            border: 0px solid red;
        }
        .td-field-title
        {
            text-align: right;
            padding-right: 15px;
			width:25%;
        }
        .td-field-content
        {
            text-align: left;
            padding-bottom: 10px;
            padding-top: 10px;
            height: 50px;
			width:75%;
        }
        .input-field-content
        {
            height: 30px;
            border: 1px solid LightGray;
            background-color: GhostWhite;
            color: #7F8C8D;
            padding-left: 5px;
        }
        .chk-field-content
        {
            cursor: pointer;
        }
        .img-cert
        {
            width: 200px;
            height: 150px;
            text-align: center;
            font-size: 0.8em;
        }
        
        .self-panel-main
        {
            border: 1px solid lightGray;
            width: 80%;
            margin-top: 20px;
            margin-bottom: 20px;
            background-color: White;
            box-shadow: 3px 3px 3px #7F8C8D;
            padding: 80px;
        }
		.cert-container{
			width:100%;
			margin-top:30px;
			margin-left:15px;
		}
        h5
        {
            color: #7F8C8D;
        }
        th
        {
            background-color: #3498DB;
            color: White;
            font-size: 0.9em;
            text-align: center;
        }
		#divBackgroundCover{
			position:fixed;
			padding-top:100px;
			border:0px solid Gray;
			background-color:Black;
			background-image:url(../../images/lock.png);
			background-repeat:no-repeat;
			background-position:center;
			font-family:微软雅黑;
			color:lightGray;
			text-align:center;
			font-size:2em;
			opacity:0.5;
			filter:alpha(opacity=50); /* 针对 IE8 以及更早的版本 */
		}
		</style>
    </head>
    <body>
		<div id="divBackgroundCover">信息审核中...</div>
		<div class="self-panel-nav" id="divNav">
			<table style="width:100%">
				<tr>
					<td style="width:33%" class="self-nav-inactive">
						1.企业注册
					</td>
					<td style="width:33%" class="self-nav-active">
						<div><i class="fa fa-chevron-circle-right "></i>&nbsp;&nbsp;2.完善资料</div>
					</td>
					<td style="width:33%" class="self-nav-inactive">
						3.信息审核
					</td>
				</tr>
			</table>
		</div>
        <div class="self-panel-main" id="divBackground" style="height:auto;">
            <div class="div-title" style="border:0px;">企业信息</div>
            <div class="div-title"></div>
            <div class="div-input-info" style="border:0px solid green;">
                <table style="width:100%; font-size: 16px">
                    <tr>
                        <td class="td-field-title"><span style="color:red">*&nbsp;</span>企业名称 ：</td>
                        <td class="td-field-content"><input type="text" class="input-field-content" style="width:50%;height:32px" id="_cCompany_name" /></td>
                    </tr>
                    <tr>
                        <td class="td-field-title"><span style="color:red">*&nbsp;</span>营业执照号码 ：</td>
                        <td class="td-field-content"><input type="text" class="input-field-content" style="width:50%;height:32px" id="_cCompany_code" /></td>
                    </tr>
                    <tr>
                        <td class="td-field-title"><span style="color:red">*&nbsp;</span>区域 ：</td>
                        <td class="td-field-content"><input type="text" class="input-field-content" style="width:50%;height:32px" id="_cArea_id" controlType="dropdown" fieldValue="area_id" fieldText="area_fullname" fieldsVisible="area_fullname" fieldsSearch="area_fullname" /></td>
                    </tr>
                    <tr>
                        <td class="td-field-title"><span style="color:red">*&nbsp;</span>详细地址 ：</td>
                        <td class="td-field-content"><input type="text" class="input-field-content" style="width:100%;height:32px" id="_cCompany_address" /></td>
                    </tr>
                    <tr>
                        <td class="td-field-title"><span style="color:red">*&nbsp;</span>企业类型 ：</td>
                        <td class="td-field-content">
                            <input type="checkbox" class="chk-field-content" id="_cIs_manufacturer" /><label for="_cIs_manufacturer">&nbsp;&nbsp;生产厂商</label>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-field-title"></td>
                        <td class="td-field-content">
                            <input type="checkbox" class="chk-field-content" id="_cIs_commerce" /><label for="_cIs_commerce">&nbsp;&nbsp;商业公司</label>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-field-title"></td>
                        <td class="td-field-content">
                            <input type="checkbox" class="chk-field-content" id="_cIs_medical" /><label for="_cIs_medical">&nbsp;&nbsp;医疗机构</label>
                        </td>
                    </tr>
                </table>
            </div>
            <!--区域1 结束-->
            <!--区域2-->
            <div class="div-title" style="border:0px;">资料负责人</div>
            <div class="div-title"></div>
            <div class="div-input-info">
                <table style="width:100%; font-size: 16px">
                        <tr>
                            <td class="td-field-title"><span style="color:red">*&nbsp;</span>身份证号 ：</td>
                            <td class="td-field-content"><input type="text" class="input-field-content" style="width:50%;height:32px" id="_cCompany_user_code" /></td>
                        </tr>
						<tr>
                            <td class="td-field-title"><span style="color:red">*&nbsp;</span>姓名 ：</td>
                            <td class="td-field-content"><input type="text" class="input-field-content" style="width:30%;height:32px" id="_cCompany_contactor" /></td>
                        </tr>
                        <tr>
                            <td class="td-field-title"><span style="color:red">*&nbsp;</span>手机 ：</td>
                            <td class="td-field-content"><input type="text" class="input-field-content" style="width:30%;height:32px" id="_cCompany_contactor_mobile" /></td>
                        </tr>
                        <tr>
                            <td class="td-field-title">传真 ：</td>
                            <td class="td-field-content"><input type="text" class="input-field-content" style="width:30%;height:32px" id="_cCompany_fax" /></td>
                        </tr>

                    </table>
            </div>
            <!--区域2 结束-->
			<!--区域3-->
            <div class="div-title" style="border:0px;">请上传认证资料</div>
            <div class="div-title"></div>
			<table style="width:100%">
				<tr>
					<td style="width:50%"><div class="cert-container" id="divCertCompany"></div></td>
					<td style="width:50%;><div class="cert-container" id="divCertCompanyExample"></div></td>
				</tr>
				<tr>
					<td><div class="cert-container" id="divCertAttorney"></div></td>
					<td><div class="cert-container" id="divCertAttorneyExample"></div></td>
				</tr>
				<tr>
					<td><div class="cert-container" id="divCertAgentID"></div></td>
					<td><div class="cert-container" id="divCertAgentIDExample"></div></td>
				</tr>
			</table>
			<!--区域3 结束-->
            <!--区域4-->           
            <div class="div-title" style="text-align:center;border:0"><button id="submitreg" class="btn btn-success" style="width:200px;margin-top:25px;">确认提交</button></div>
			<!--区域4 结束-->
        </div>
	   <div id="divDC" class="ScreenCenter" style="display: none; width: 1000px"></div>
	   <form id="frm" action="" target="g_mshare.base.register">
		<table id="tbForm" class="tbForm" style="width: 1205px;">
			<tr id="trH">
				<th style="width: 150px;"></th>
				<th style="width: 250px;"></th>
				<th style="width: 150px;"></th>
				<th style="width: 250px;"></th>
				<th style="width: 150px;"></th>
				<th style="width: 250px;"></th>
			</tr>
		</table>
		<input type="hidden" id="_cCompany_id" />
		<input type="hidden" id="_cCompany_real_status" />

	</form>
	
    </body>
</html>
<!-- formLoad -->
<script type="text/javascript">
	var ctlUploadCompany = null;
	var ctlUploadAttorney = null;
    var ctlUploadAgentID = null;

    var doc_id_company = null;
    var doc_id_attorney = null;
    var doc_id_agent = null;
    function formLoad() {
    	gId("divBackgroundCover").style.top = "0px";
    	gId("divBackgroundCover").style.left = "0px";
    	gId("divBackgroundCover").style.width = document.body.offsetWidth + "px";
    	gId("divBackgroundCover").style.height = document.body.offsetHeight + "px";
    	gId("divBackgroundCover").style.zIndex = "9999999999999";
    }
    $("#submitreg").click(function () {
    	if ($("#_cCompany_name").val() == null || "".equals($("#_cCompany_name").val())) {
    		alert("请输入企业名称！");
    		$("#_cCompany_name").focus();
    		return false;
    	}

    	if ($("#_cCompany_code").val() == null || "".equals($("#_cCompany_code").val())) {
    		alert("请输入企业营业执照号！");
    		$("#_cCompany_code").focus();
    		return false;
    	}

    	if ("无区域".equals($("#_cArea_id").val())) {
    		alert("请选择区域！");
    		$("#_cArea_id").focus();
    		return false;
    	}

    	if ($("#_cCompany_address").val() == null || "".equals($("#_cCompany_address").val())) {
    		alert("请输入公司详细地址！");
    		$("#_cCompany_address").focus();
    		return false;
    	}

    	if (!$('#_cIs_manufacturer').is(':checked') && !$('#_cIs_commerce').is(':checked') && !$('#_cIs_medical').is(':checked')) {
    		alert("企业类型必须选择一项！");
    		return false;
    	}

    	if ($("#_cCompany_user_code").val() == null || "".equals($("#_cCompany_user_code").val())) {
    		alert("请输入联系人身份证号！");
    		$("#_cCompany_user_code").focus();
    		return false;
    	}

    	if (!(/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test($("#_cCompany_user_code").val()))) {
    		alert("输入的身份证号长度不对，或者号码不符合规定！\n15位号码应全为数字，18位号码末位可以为数字或X。");
    		$("#_cCompany_user_code").focus();
    		return false;
    	}

    	if ($("#_cCompany_contactor").val() == null || "".equals($("#_cCompany_contactor").val())) {
    		alert("请输入联系人姓名！");
    		$("#_cCompany_contactor").focus();
    		return false;
    	}

    	if ($("#_cCompany_contactor_mobile").val() == null || "".equals($("#_cCompany_contactor_mobile").val())) {
    		alert("请输入联系人手机号！");
    		$("#_cCompany_contactor_mobile").focus();
    		return false;
    	}

    	if (!(/^1[3|4|5|8][0-9]\d{4,8}$/.test($("#_cCompany_contactor_mobile").val()))) {
    		alert("请输入正确的手机号码！");
    		$("#_cCompany_contactor_mobile").focus();
    		return false;
    	}

    	if ($('#_cIs_manufacturer').is(':checked')) {
    		$("#_cIs_manufacturer").val(1);
    	}
    	if ($('#_cIs_commerce').is(':checked')) {
    		$("#_cIs_commerce").val(1);
    	}
    	if ($('#_cIs_medical').is(':checked')) {
    		$("#_cIs_medical").val(1);
    	}



    	if (ctlUploadCompany && ctlUploadCompany.validCount > 0) {
    		debug("comanyDocId:" + ctlUploadCompany.docId);
    		doc_id_company = ctlUploadCompany.docId;
    	} else {
    		showErr("企业营业执照尚未正确上传！");
    		return false;
    	}

    	if (ctlUploadAttorney && ctlUploadAttorney.validCount > 0) {
    		debug("attorneyDocId:" + ctlUploadAttorney.docId);
    		doc_id_attorney = ctlUploadAttorney.docId;
    	} else {
    		showErr("企业授权书尚未正确上传！");
    		return false;
    	}

    	if (ctlUploadAgentID && ctlUploadAgentID.validCount > 0) {
    		debug("agentIDDocId:" + ctlUploadAgentID.docId);
    		doc_id_agent = ctlUploadAgentID.docId;
    	} else {
    		showErr("代理人身份证号尚未正确上传！");
    		return false;
    	}

    	vf.save();

    	var companyId = $("#_cCompany_id").val();
    	if (!showConfirm("确认要提交企业信息吗？")) {
    		return false;
    	}
    	if (g.a.send("processType=g_mshare.base.register&actionType=updadteReal", { viewKey: "company_reg_info", companyId: companyId, doc_id_company: doc_id_company, doc_id_attorney: doc_id_attorney, doc_id_agent: doc_id_agent }, true)) {
    		if (g.a.OK) {
    			win.close();
    			alert("信息已提交，请耐心等待工作人员审核！");

    		}
    	}

    });

    vf.afterMove = function () {
    	var certConfig = {};
    	var Doc_id_company = null;
    	var Doc_id_attorney = null;
    	var Doc_id_agent = null;
    	var company_id = $("#_cCompany_id").val();
    	if (g.a.send("processType=g_mshare.base.certCompany&actionType=getCertificateCategory", { viewKey: "company_reg_info", company_id: company_id }, true)) {
    		if (g.a.OK) {
    			certConfig = g.a.cReturn;
    			ctlUploadCompany = docService.createUploadArea({
    				divContainer: gId("divCertCompany"),
    				certCategoryId: certConfig.companyMainCodeCert,
    				docId: certConfig.Doc_id_company,
    				needSignature: false,
    				afterDocSave: null
    			});
    			if (ctlUploadCompany.para.docIdModel.toInt() > 0) {
    				docService.createUploadExampleArea({
    					divContainer: gId("divCertCompanyExample"),
    					docId: ctlUploadCompany.para.docIdModel
    				});
    			}
    			ctlUploadAttorney = docService.createUploadArea({
    				divContainer: gId("divCertAttorney"),
    				certCategoryId: certConfig.attorneyCert,
    				docId: certConfig.Doc_id_attorney,
    				needSignature: false,
    				afterDocSave: null
    			});
    			if (ctlUploadAttorney.para.docIdModel.toInt() > 0) {
    				docService.createUploadExampleArea({
    					divContainer: gId("divCertAttorneyExample"),
    					docId: ctlUploadAttorney.para.docIdModel
    				});
    			}
    			ctlUploadAgentID = docService.createUploadArea({
    				divContainer: gId("divCertAgentID"),
    				certCategoryId: certConfig.agentIDCert,
    				docId: certConfig.Doc_id_agent,
    				needSignature: false,
    				afterDocSave: null
    			});
    			if (ctlUploadAgentID.para.docIdModel.toInt() > 0) {
    				docService.createUploadExampleArea({
    					divContainer: gId("divCertAgentIDExample"),
    					docId: ctlUploadAgentID.para.docIdModel
    				});
    			}
    		}
    	}

    	var status = gId("_cCompany_real_status").value.toInt();
    	if (status == 0 || status == 2) {
    		gId("divNav").innerHTML = getNavHtml(2);
    		gId("divBackgroundCover").style.display = "none";
    		gId("submitreg").style.display = "";
    	} else {
    		gId("divNav").innerHTML = getNavHtml(3);
    		gId("divBackgroundCover").style.display = "";
    		gId("submitreg").style.display = "none";
    	}
    }

    function getNavHtml(step) {
    	var html = new Array();
		html.push('<table style="width:100%">');
		html.push('		<tr>');
		html.push('			<td style="width:33%" class="self-nav-inactive">');
		html.push('				1.企业注册');
		html.push('			</td>');
		if (step == 2) {
			html.push('			<td style="width:33%" class="self-nav-active">');
			html.push('				<div><i class="fa fa-chevron-circle-right "></i>&nbsp;&nbsp;2.完善资料</div>');
			html.push('			</td>');
			html.push('			<td style="width:33%" class="self-nav-inactive">');
			html.push('				3.信息审核');
			html.push('			</td>');
		} else {
			html.push('			<td style="width:33%" class="self-nav-inactive">');
			html.push('				<div>2.完善资料</div>');
			html.push('			</td>');
			html.push('			<td style="width:33%" class="self-nav-active">');
			html.push('				<div><i class="fa fa-chevron-circle-right "></i>&nbsp;&nbsp;3.信息审核</div>');
			html.push('			</td>');
		}
		html.push('		</tr>');
		html.push('	</table>');
		return html.join("");
    }

   </script> 