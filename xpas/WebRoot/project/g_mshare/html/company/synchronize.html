<!DOCTYPE html>
<html>
	<head>
		<title>我的产品信息</title>
		<link href="../../../../res_plugin/bootstrap3.7/bootstrap/css/bootstrap.min.css"	rel="stylesheet" type="text/css" />
		<link href="../../../../res_plugin/bootstrap3.7/bootstrap-table/css/bootstrap-table.css" rel="stylesheet" type="text/css" />

        <script src="../../../../res_plugin/jquery/jquery-3.1.1.min.js" type="text/javascript"></script>
		<script src="../../../../res_plugin/bootstrap3.7/bootstrap-table/js/bootstrap-table.js"	type="text/javascript"></script>
		<script src="../../../../res_plugin/bootstrap3.7/bootstrap-table/js/bootstrap-table-local-zh-CN.js"	type="text/javascript"></script>
		 <script src="../../js/rstodata.js" type="text/javascript"></script>
        <!--系统框架引用 -->
        <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
        <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
        <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
        <script src="../../../../res/control/window/xwf.window.js" type="text/javascript"></script>
		<script src="../../../../res/control/upload/xwf.upload.js" type="text/javascript"></script>
       <script src="../../js/rstodata.js" type="text/javascript"></script>
		<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
		
		<style type="text/css">
			body{
				background-color:lightGray;
			}
			.self-panel-main{
				border:1px solid lightGray;
				width:80%;
				margin-top:20px;
				margin-bottom:20px;
				background-color:White;
				box-shadow: 3px 3px 3px #7F8C8D;
				padding:80px;
			}
			h5{
				color:#7F8C8D;
			}
			th{
				background-color:#3498DB;
				color:White;
				font-size:0.9em;
				text-align:center;
			}
		</style>
	</head>
	<body>
	
		<div class="container self-panel-main" id="div1" style="">
			
			
			<div class="row"><!--第3行-->
				<div id="toolbar">
                    <button id="btnLoad" class="btn btn-success" onclick="synchronizeSpOutline();">导出供应商数据</button>
                    &nbsp;&nbsp;&nbsp;&nbsp;<a href="" id="filearea" style="display:none">右击保存文件</a>
				</div>
				<table id="tbMatrCertDocs" data-toggle="table" data-toolbar="#toolbar" data-height="600" 
					data-sort-name="cert_name"
					data-sort-order="desc"
					data-pagination="true"
					data-search="true"
					data-page-size="10"
					data-page-list="[10,20,30]"
					kk_data-url="../json/data1.json">
					<thead>
                        <tr>
                            <th data-field="no">序</th>
                            <th data-field="company_name" data-sortable="true">企业名称</th>
                            <th data-field="area_fullname">区域</th>
                            <th style="width:10%" data-field="operate">操作</th>
                        </tr>
					</thead>
				</table>
			</div><!--第3行.结束-->

            <h5 class="step-title">
                * 注：SPD系统无法连接外网情况下，通过首营平台把耗材、供应商信息导出，在SPD系统进行导入，实现数据同步。
            </h5>
            <br />
		</div>
	
	</body>

</html>
<script type="text/javascript">
    var $table = $('#tbMatrCertDocs'),
        $button = $('#btnLoad');
    var comrs = "";
    var comcertrs;


    $(function () {
	    editdata();
    });

    //导出供应商数据
    function synchronizeSpOutline() {
        if (comcertrs.rowCount == 0) {
            alert("暂无同步数据！");
            return;
        }
        if (g.a.send("processType=g_mshare.base.certMaterial&actionType=exportSynchronizedSp", { "viewKey": "v_material" }, true)) {
            var c = g.a.cReturn;
            if (g.a.OK) {
                var c = g.a.cReturn;
                var urlFile = c.urlFile;           
                //showMsg("导出功能，右击按钮保存！");
                var filepath = "../../../../res_run/xpas/" + urlFile;
                $('#filearea').attr('href', filepath);
                $("#filearea").show();
                funDownload(filepath);
                //topWin.downloadFile(urlFile);
            }
            else {
                return false;
            }
        }
        else {
            return false;
        }

    }

    function funDownload(url) {
        var a = window.open(url, "_blank", "width=0, height=0,status=0");
        a.document.execCommand("SaveAs");
        a.close();
    };


    function editdata() {
        if (g.a.send("processType=g_mshare.base.certMaterial&actionType=getSynchronizedSp", {   "viewKey": "receive"}, true)) {
             if (g.a.OK) {
                 comrs = g.a.cReturn.comrs;
                 comcertrs = g.a.cReturn.comcertrs;
                fillcom(comrs);
                fillmatr(comcertrs);
             }
             else {
                return false;
            }
        }
	}
	
	function fillcom(rs){
	
	}
	
    function fillmatr(rs){

        for (var i = 0; i < rs.rowCount; i++) {
            if (parseInt(rs.rows[i]['operate'].value) > 0) {
                rs.rows[i]['operate'].value = " <i class='fa fa-wrench' style='color:#2980B9;cursor:pointer' ><span onclick='edit(" + rs.rows[i]['company_id_from'].value + ")'>查看</span></i>";
            }
             if(rs.rows[i]['cooperation'].value.equals("1")){
                rs.rows[i]['company_name'].value ="<span class='badge badge-success' style='background-color:green'>合作方</span>&nbsp;&nbsp;"+rs.rows[i]['company_name'].value;
            }
        }
        var rows = todatatable(rs);
        $table.bootstrapTable('load', rows);

	}

    function edit(index) {

        var para = {
            flowKey: "",
            viewKey: "",
            isAddnew: false,
            primaryKey: "company_id," + index

        };
        var prop = {
            text: "我接收的企业资质",
            url: g.appPath + "project/g_mshare/html/company/company_js.html"
        };
        top.topWin.openFullWindow(prop, para);

    }

    function callback() {
        editdata();
    }
</script>