<!DOCTYPE html>
<html>
<head>
    <title>新用户注册</title>
    <script src="../../../../res_plugin/jquery/jquery-3.1.1.min.js" type="text/javascript"></script>
    <link href="../../../../res_plugin/bootstrap3.7/bootstrap/css/bootstrap.min.css"
        rel="stylesheet" type="text/css" />
    <script src="../../../../res_plugin/bootstrap3.7/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <!--dtpicker -->
    <link href="../../../../res_plugin/bootstrap3.7/dtpicker/css/bootstrap-datetimepicker.min.css"
        rel="stylesheet" type="text/css" />
    <script src="../../../../res_plugin/bootstrap3.7/dtpicker/js/bootstrap-datetimepicker.min.js"
        type="text/javascript"></script>
    <script src="../../../../res_plugin/bootstrap3.7/dtpicker/js/locales/bootstrap-datetimepicker.zh-CN.js"
        type="text/javascript"></script>
    <!--系统框架引用 -->
    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
    <script src="../../../../res/control/window/xwf.window.js" type="text/javascript"></script>
    <script src="../../../../res/control/upload/xwf.upload.js" type="text/javascript"></script>
    		<script src="../../../../res/control/upload/xwf.upload_core.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
    <script src="../../js/doc_center.js" type="text/javascript"></script>
    <style type="text/css">
        .screen-center
        {
            margin-left: auto;
            margin-right: auto;
        }
        #_viewSignature .row
        {
            padding: 10px 0px 10px 0px;
        }
        #_viewSignature a
        {
            cursor: pointer;
        }
        #_viewSignature p
        {
            color: Black;
            background-color: lightGray;
            border: 1px solid lightGray;
            padding: 5px;
            font-size: 0.7em;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div style="padding: 10px;">
    </div>
    <div class="screen-center" style="width: 60%; background-color: White; height: 1000px;">
        <div id="divUpload" style="width: 100%; height:350px;">
        </div>
        <h3 id="uptitle"><i class="fa fa-magic"></i>&nbsp;&nbsp;更新为：</h3>
        <div id="divEdit" style="width: 100%;  height:350px;margin-top: 20px">
        </div>
         <div style="width: 100%; text-align: center; margin-top: 30px" >
            <button class="btn btn-success" id="btnSubmit" onclick="sub();">
              <span id="mess">  </span></button>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    var doc_id="";
    var uptype="";
    var idCtl = null;
    var etype = "";
    var mycertid = "";
    var certmess;
    $(function () {
        mycertid = win.para.primaryKey.split(",")[1];
        etype = win.para.etype;
        getmess();
        if (etype == 1) {
            btnNew1_click();
            btnShowDoc1_click();
            $("#mess").html("确认无误，我要更新资质");
             $("#uptitle").show();
            
        }else  if (etype ==3) {
            btnShowDoc1_click();
           
             $("#uptitle").hide();
              $("#btnSubmit").hide();
            
        } else {
            btnShowDoc2_click();
            $("#mess").html("确认无误，我要修改资质");
           $("#uptitle").hide();
        }
        win.addEventListener("afterClose",
			function () {
				if (win.para.callback) {
					win.para.callback();
				}
			}
		);
    });

    function getmess() {
        if (g.a.send("processType=g_mshare.base.certCompany&actionType=getCertMess", { "viewKey": "receive", "mycertid": mycertid }, true)) {
            if (g.a.OK) {
                certmess = g.a.cReturn.rs.rows[0];
            }
            else {
                return false;
            }
        }
    }
    function btnNew1_click() {
        idCtl = docService.createUploadArea({
            divContainer: gId("divEdit"),
            certCategoryId: certmess['cert_category_id'].value,
            pWidth: 300,
            pHeight: 200,
            gapWidth: 50,
            afterDocSave: afterDocSave
        });
    }
    function btnShowDoc1_click() {
        docService.createUploadArea({
            divContainer: gId("divUpload"),
            docId: certmess['cert_doc_id'].value,
            certCategoryId: certmess['cert_category_id'].value,
            readonly: true
        });
    }
    function btnShowDoc2_click() {
        docService.createUploadArea({
            divContainer: gId("divUpload"),
            docId: certmess['cert_doc_id'].value,
            certCategoryId: certmess['cert_category_id'].value,
            afterDocSave: afterDocSave2
        });
    }
    function btnNew2_click() {
        idCtl = docService.createUploadArea({
            divContainer: gId("divUpload"),
            files: [{ fileUrl: "/res_run/mshare/file_center/2017/2017959db64746d6ebfc7bc408c6367322aa.jpg", localPath: "", signature: "", fileName: "20170bc3b2ffd0ab83726f8d32749413c73e.jpg"}],
            afterDocSave: afterDocSave3
        });
    }

    function afterDocSave(ctl) {
      doc_id=ctl.docId;
      uptype=1;
       
    }
     function afterDocSave2(ctl) {
     doc_id=ctl.docId;
         uptype=2;
    }
    
    function sub(){
     if(uptype.equals("")){
      alert("未检测到更改");
      return false;
    }
    else if(uptype.equals("1")){
     if (g.a.send("processType=g_mshare.base.certCompany&actionType=updateComCertWithH", { "viewKey": "receive", "my_cert_id": mycertid, "doc_id": doc_id }, true)) {
            if (g.a.OK) {
               win.close();
            }
            else {
                return false;
            }
        }
        }else{
        if (g.a.send("processType=g_mshare.base.certCompany&actionType=updateComCert", { "viewKey": "receive", "my_cert_id": mycertid, "doc_id":doc_id }, true)) {
            if (g.a.OK) {
                 win.close();
            }
            else {
                return false;
            }
        }
        }
    }
</script>
