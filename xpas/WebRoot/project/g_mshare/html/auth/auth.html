<!DOCTYPE html>
<html>
<head>
    <title>授权书信息</title>
    <link href="../../../../res_plugin/bootstrap3.7/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../../res_plugin/bootstrap3.7/bootstrap-table/css/bootstrap-table.css" rel="stylesheet" type="text/css" />

    <script src="../../../../res_plugin/jquery/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/bootstrap3.7/bootstrap-table/js/bootstrap-table.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/bootstrap3.7/bootstrap-table/js/bootstrap-table-local-zh-CN.js" type="text/javascript"></script>
    <script src="../../js/rstodata.js" type="text/javascript"></script>
    <!--系统框架引用 -->
    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
    <script src="../../../../res/control/window/xwf.window.js" type="text/javascript"></script>
    <script src="../../../../res/control/upload/xwf.upload.js" type="text/javascript"></script>
    <script src="../../js/rstodata.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>

    <style type="text/css">
        body {
            background-color: lightGray;
        }

        .self-panel-main {
            border: 1px solid lightGray;
            width: 80%;
            margin-top: 20px;
            margin-bottom: 20px;
            background-color: White;
            box-shadow: 3px 3px 3px #7F8C8D;
            padding: 80px;
        }

        h5 {
            color: #7F8C8D;
        }

        th {
            background-color: #3498DB;
            color: White;
            font-size: 0.9em;
            text-align: center;
        }
        .table.table-hover {
        	width: 100% !important;
        }
        .fa-wrench:before {
        	margin-right: 2px;
        }
        #tbMatrCertDocs tbody tr td:last-child {
        	text-align: center;
        }
    </style>
</head>
<body>
    <div class="container self-panel-main" id="div1" style="">
        <div class="row">
            <!--第3行-->
            <div id="toolbar">
                <button id="btnLoad" class="btn btn-default" onclick="addAuth();">新建授权书</button>
            </div>
            <table id="tbMatrCertDocs" data-toggle="table" data-toolbar="#toolbar" data-height="600"
                   data-sort-name=""
                   data-sort-order="desc"
                   data-pagination="true"
                   data-search="true"
                   data-page-size="10"
                   data-page-list="[10,20,30]"
                   kk_data-url="">
                <thead>
                    <tr>
                        <th style="width:10%" data-field="no">序</th>
                        <th style="width:15%" data-field="auth_company_from">授权方</th>
                        <th style="width:15%" data-field="auth_company_to">被授权方</th>
                        <th style="width:15%" data-field="auth_title">授权书标题</th>
                        <th style="width:15%" data-field="auth_date0" data-sortable="true">授权起始日期</th>
                        <th style="width:15%" data-field="auth_date1" data-sortable="true">授权截至日期</th>
                        <th style="width:15%" data-field="operate">操作</th>
                    </tr>
                </thead>
            </table>
        </div><!--第3行.结束-->
    </div>

</body>

</html>
<script type="text/javascript">
    var $table = $('#tbMatrCertDocs'),
        $button = $('#btnLoad');
    var count = 0;
    $(function () {
        editdata();
    });

    function addAuth() {
        var para = {
            flowKey: "",
            viewKey: "v_auth",
            isAddnew: true,
            callback: callback,
            count: count
        };
        var prop = {
            text: "新增授权书",
            url: g.appPath + "project/g_mshare/html/auth/auth_add.html"
        };
        top.topWin.openFullWindow(prop, para);
    }

    function edit(index) {
        var para = {
            flowKey: "",
            viewKey: "v_auth",
            isAddnew: false,
            primaryKey: "auth_id," + index,
            callback: callback

        };
        var prop = {
            text: "授权书信息",
            url: g.appPath + "project/g_mshare/html/auth/auth_add.html"
        };

        top.topWin.openFullWindow(prop, para);

    }

    function callback() {
        editdata();
    }
    function editdata() {
        if (g.a.send("processType=g_mshare.auth.Auth&actionType=getAuth", { "viewKey": "receive" }, true)) {
            if (g.a.OK) {
                var comrs = g.a.cReturn.comrs
                var auths = g.a.cReturn.auths
                fillmatr(auths);
            }
            else {
                return false;
            }
        }
    }

    function fillcom(rs) {

    }

    // 填充表格内容
    function fillmatr(rs) {
    	count = rs.rowCount;
    	for(var i = 0; i < rs.rowCount; i++) {
    		if(parseInt(rs.rows[i]['operate'].value) > 0) {
    			rs.rows[i]['auth_date0'].value = rs.rows[i]['auth_date0'].value.substring(0, 10);
    			rs.rows[i]['auth_date1'].value = rs.rows[i]['auth_date1'].value.substring(0, 10);
    			rs.rows[i]['operate'].value = " <i class='fa fa-wrench' style='color:#2980B9;cursor:pointer' ><span onclick='edit(" + rs.rows[i]['auth_id'].value + ")'>维护</span></i>";
    		}
    	}
    	
        var rows = todatatable(rs);
        $table.bootstrapTable('load', rows);
    }

</script>