<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>选择流程接收人</title>
	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>

	<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>

	<style type="text/css">
		#divList {
			width: 350px;
			overflow: auto;
		}
		#tbList td {
			height: 26px;
			line-height: 26px;
			padding-right: 5px;
		}
	</style>
</head>
<body>
	<div class="divButtons">
		<input type="button" id="btnOK" value="确定" onclick="btnOK_click();" />
		<input type="button" id="btnCancel" value="取消" onclick="win.close();" />	
	</div>
	<div id="divList">审核人列表</div>	
	<div id="divOpinion">
		<div style="margin:5px 0px 3px 0px">请填写附言：</div>
		<textarea id="txtOpinion" rows="5" cols="0" style="width:420px;"></textarea>
	</div>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
	var divList = gId("divList");
	var divOpinion = gId("divOpinion");
	var txtOpinion = gId("txtOpinion");

	var flData = {};
	var dtbReceiver = null;
	var nIdxSelected = -1;

	function formLoad() {
		flData = win.para.flData;
		dtbReceiver = win.para.dtbReceiver;
		initReceiverList();

		if (divList.offsetHeight > 250) {
			divList.style.height = "250px";
		}
		if (flData.fl_need_opinion == 0) {
			divOpinion.style.display = "none";
		}
		else {
			txtOpinion.focus();
		}
	}

	function initReceiverList() {
		var blFirst = true;
		var strRadio = "", strText = "";
		var arrHtml = new Array();

		arrHtml.push("<table id=\"tbList\">");
		for (var i = 0; i < dtbReceiver.rowCount; i++) {
			if (dtbReceiver.rows[i]["user_key"].value.equals(win.p.topWin.userKey)) continue;
			arrHtml.push("<tr>");
			strRadio = "<input type=\"radio\" name=\"userKey\" id=\"rdo_" + i + "\" onclick=\"rdo_click(" + i + ");\" />";
			arrHtml.push("<td>" + strRadio + "<label for=\"rdo_" + i + "\">" + dtbReceiver.rows[i]["user_name"].value + "</label></td>");
			arrHtml.push("<td>" + dtbReceiver.rows[i]["user_key"].value + "</td>");
			arrHtml.push("</tr>");
			if (blFirst) {				
				nIdxSelected = i;
				blFirst = false;
			}
		}
		arrHtml.push("</table>");
		divList.innerHTML = arrHtml.join("\n");
		if (nIdxSelected >= 0) {
			gId("rdo_" + nIdxSelected).checked = true;
		}
	}
	function rdo_click(nIndex) {
		nIdxSelected = nIndex;
	}

	function btnOK_click() {
		var receiver = "";
		if (dtbReceiver.rowCount > 0) {
			if (dtbReceiver.rowCount > 0 && nIdxSelected == -1) {
				showMsg("请先选择接收人.");
				return;
			}
			receiver = dtbReceiver.rows[nIdxSelected]["user_key"].value;
		}
		
		if (flData.fl_need_opinion == 1) {
			txtOpinion.value = txtOpinion.value.trim();
			if (txtOpinion.value.length == 0) {
				txtOpinion.focus();
				showMsg("请填写附言.");
				return;
			}
		}

		win.hide();
		win.para.callback(flData, receiver, txtOpinion.value);
		win.close();
	}
</script>