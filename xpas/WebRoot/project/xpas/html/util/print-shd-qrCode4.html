<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- 主子表二维码信息分离-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <script src="../../../../res/jscript/xwf.ajax.js"></script>
    <script src="../../../../res/jscript/xwf.js"></script>
    <script src="../../../../res/jscript/xwf.const.js"></script>
    <link href="../../../../res_plugin/zui-1.8.1-dist/css/zuibtn.css" rel="stylesheet" type="text/css" />
</head>

<body id="body-uview">
    <div class="container-fluid container-fluid-main scrollbar-hover" id="container-uview-edit">
        <div class="row">
            <div class="col-xs-12">
                <table class2="table table-hover table-borderless table-condensed table-striped">
                    <tbody>
                        <tr>
                            <td colspan="1" style="width:120px;">
                                <div class="btn-toolbar btn-toolbar-my">
                                    <div class="btn-group">
                                        <!-- <button type="button" class="btn btn-primary" onclick="formTool_edit.op('buildLine');" title="生成条形码">生成条形码</button> 
									  	<button type="button" class="btn btn-primary" disabled="disabled" onclick="formTool_edit.op('build2code');" title="生成二维码">生成二维码</button>
										<button type="button" class="btn btn-danger" name="btn-reset" onclick="formTool_edit.op('reset');" title="重置">重置</button> 
								  	
								  	-->
								  		   <button type="button" class="btn btn-primary" onclick="formTool_edit.op('print');" title="打印">打印</button>
                                            <button type="button" class="btn" onclick="win.close();" title="关闭当前窗口">关闭</button>
                                            
                                    </div>
                                </div>
                            </td>
                            <td colspan="1">
                                每页数量
                                <select id="pageRowNum" title="每页数量" style="margin-right:22px;">
						  		<option value="8" selected="selected">8条明细</option>
						  		<option value="10" selected="selected">10条明细</option>
						  	</select> 纸张大小
                                <select id="pageSize" title="纸张大小" style="margin-right:22px;">
						  		<option value="a4">a4</option>
						  	</select> 固定位置
                                <select id="pageFixed" title="固定位置">
						  		<option value="pf2" selected = "selected">每页都包含头部，尾部放到最后一页</option>
								<option value="pf1">每页都包含头部和尾部</option>
						  	</select>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="tableBox">
                <style type="text/css"  media="print">
                    .noprint {
                        display: none
                    }
                    
                    .print {
                        margin-left: 25%
                    }
                    
                    @("@")page {
                        size: auto;
                        /* auto is the initial value */
                        margin: 0mm;
                        /* this affects the margin in the printer settings */
                    }
                    
                    .print-table {
                        color: black;
                        margin: auto auto;
                        width: 100%;
                        background-color: rgb(255, 255, 255);
                        box-sizing: border-box;
                        PADDING-LEFT: 10PX;
                        table-layout: fixed;
                        font-family: microsoft yahei;
                    }
                    
                    .noboder {
                        border: 0px !important;
                    }
                    
                    table {
                        width: 100%;
                        border-spacing: 0;
                        border-collapse: collapse;
                    }
                    
                    table th {
                        word-break: keep-all;
                    }
                    
                    .table5 {
                        margin-top: 0px;
                    }
                    
                    .table5 th,
                    .table5 td {
                        padding: 2px 4px !important;
                    }
                    
                    .table5 .codeOutput object {
                        height: 60px;
                    }
                    
                    table td {
                        word-break: break-all;
                    }
                    
                    table th,
                    table td {
                        padding: 10px 5px;
                        border: 1px dotted #2f2f2f;
                    }
                    
                    .codeOutput {
                        padding-top: 10px !important;
                        width: 100% !important;
                        margin: auto auto;
                    }
                    
                    .codeOutput object {
                        height: 70px;
                        width: 100%;
                    }
                    
                    .codeOutput div:LAST-CHILD {
                        font-size: 9px !important;
                        height: auto !important;
                        text-align: left !important;
                    }
                    
                    .codeOutputinfo {
                        text-align: center;
                        letter-spacing: 0.5px;
                        font-size: 13px;
                    }
                    
                    .title {
                        text-align: center;
                        font-weight: 700;
                        font-size: 22px;
                    }
                    
                    .title2,
                    .table-info th {
                        font-size: 12px;
                        font-weight: 700;
                    }
                    
                    .print-table-ie .title {
                        font-size: 52px !important;
                    }
                    
                    .table-footer {
                        font-weight: bold;
                        font-size: 12px;
                    }
                    
                    .print-table-ie .table-footer {
                        font-size: 22px !important;
                    }
                    
                    .table-footer,
                    .table-footer td {
                        border: 0px !important;
                    }
                    
                    .print-table-ie .title2,
                    .print-table-ie .table-info th {
                        font-size: 22px !important;
                    }
                    
                    .table-info td {
                        font-size: 11px;
                    }
                    
                    .print-table-ie .table-info td {
                        font-size: 21px !important;
                    }
                    
                    #qrcodes img {
                        height: 165px;
                    }
                </style>
                <table id="print-table" class="print-table print-table-1">
                    <tr>
                        <td style="text-align: center;border: 0px;">
                            <table style="">
                                <tr>
                                    <td colspan="2" id="maintitle" class="title noboder" style="font-size: 30px;    padding: 0px;">送货单
                                    </td>
                                </tr>
                                <tr class="title2" style="font-size: 18px;">
                                    <td class="noboder" style="text-align:left ;    padding: 0px;">
                                        <span class="titletd">供应单位：</span><span id="company_name"></span>
                                    </td>
                                    <td class="noboder" style=" text-align: left;    padding: 0px;width: 250px;">
                                        <span>送货日期：</span><span id="asn_date"></span>
                                    </td>
                                </tr>
                                <tr class="title2" style="font-size: 18px;">
                                    <td class="noboder" style="text-align:left ;    padding: 0px;">
                                        <span class="titletd">订单编号：</span><span id="ordercode"></span>
                                    </td>
                                    <td class="noboder" style=" text-align: left;    padding: 0px;">
                                        <span class="titletd">发货单号：</span><span id="asncode"></span>
                                    </td>
                                </tr>
                            </table>
                        </td>
                        <td class="noboder" style="width:180px;padding-right:20px;text-align: center;    padding: 0px;padding-bottom: 22px;padding-top: 11px;">
                            <img id="qrCodeMain" alt="加载中" />
                            <div id="qrCodeMainCan" style="display:none;"></div>
                        </td>
                    </tr>
                    <tr>
                        <td class="noboder" colspan="2" style="padding: 0px;">
                            <table id="table-form-dtl" class="table-info" style="margin-top:-17px !important;">
                                <tr>
                                    <th style="width: 30px;">序号 </th>
                                    <th style="width: auto;">材料名称 </th>
                                    <th style="width: 150px;">规格型号</th>
                                    <th style="width: 30px;">单位</th>
                                    <th style="width: 60px;">数量</th>
                                    <th style="width: 60px;">单价（元）</th>
                                    <th style="width: 80px;">总价（元）</th>
                                    <th style="width: 100px;">生产批号</th>
                                    <th style="width: 100px;">生产日期</th>
                                    <th style="width: 100px;">有效日期</th>
                                    <th style="width: 100px;">发票号</th>
                                    <th style="width: 160px;">注册证</th>
                                    <th style="width: 200px;">生产厂家</th>
                                    <th style="width: 60px;">存储条件</th>
                                </tr>
                                <tr style="display: none;">
                                    <td>合计
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td id="qtyCount">0
                                    </td>
                                    <td>
                                    </td>
                                    <td id="amountCount">0.00
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr id="table-form-footer">
                        <td class="noboder" colspan="2" style="padding:0px;">
                            <table class="table-footer" style="margin-top:0px; ">
                                <tr>
                                    <td>送货人：
                                    </td>
                                    <td>
                                    </td>
                                    <td>验收人
                                    </td>
                                    <td>
                                    </td>
                                    <td>储运条件:
                                    </td>
                                    <td>
                                    </td>
                                    <td style="width: 200px">
                                        需求科室：<span id="storage_fullname_req"></span>
                                    </td>
                                    <td>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td class="noboder" colspan="2" style="text-align:center;">

                        </td>
                    </tr>
                </table>
                <div style="text-align: center;display:none;">
                    <div class="page" style="page-break-after: always;"></div>
                    <div style="padding-top:111px;">请扫描我录入明细</div>
                    <img id="qrCodeDtlImg" alt="加载中" />
                    <div id="qrCodeDtlCode" style="display:none;"></div>
                    <div id="qrCodeBox" style="width:800px;height:600px;display:none;"></div>
                </div>
            </div>
        </div>
    </div>
    <input id="printqrcode" type="hidden" value="0" />
    <input id="asnId" type="hidden" value="" />
</body>

<script src="../../../../res_plugin/jquery/jquery-1.11.3.min.js"></script>
<script src="../../../../res_plugin/jquery/jquery-migrate-1.2.1.js" title="jQuery migrate插件解决迁移兼容问题"></script>
<script src="../../../../res_plugin/jquery/jquery-barcode.min.js" title="条形码"></script>
<script src="../../../../res_plugin/jquery/jquery.jqprint-0.3.js" title="打印插件"></script>
<script src="../../../../res/jscript/web_print.js" type="text/javascript"></script>
<script src="../../../../res/jscript/jquery.qrcode.min.js"></script>


<script>
    var formTool_edit = {},
        codeOutputbox = $("#codeOutputbox"),
        codeInput = $("#codeInput"),
        tableBox = $("#tableBox");
    var correctLevel = 3; //容錯級別  0 1 2 3
    function pageSize(sel) {
        if (sel.value == "5") {
            tableBox.css("padding-top", "5px");
            $("table").addClass("table5");
        } else {
            tableBox.css("padding-top", "30px");
            $("table").removeClass("table5");
        }
    }
    //条形码配置
    var barcodeSettings = {
        btype: "code128", //ean8  ean13  std25  int25  code11  code39  code93  code128（一般商品扫描使用）  codabar  msi  datamatrix
        output: 'bmp', //渲染方式 css/bmp/svg/canvas
        //bgColor: '#ff0000', //条码背景颜色
        //color: '#00ff00',   //条码颜色
        barWidth: 1, //单条条码宽度
        barHeight: 50, //单体条码高度
        //moduleSize: 10,   //条码大小
        // posX: 10,        //条码坐标X
        // posY: 5,         //条码坐标Y
        showHRI: true, //是否在条码下方显示内容
        addQuietZone: false //是否添加空白区（内边距）
    };
    //设置网页打印的页眉页脚为空 ，仅IE浏览器可用
    function PageSetup_Null() {
        try {
            var Wsh = new ActiveXObject("WScript.Shell");
            HKEY_Key = "header";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "");
            HKEY_Key = "footer";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "");
        } catch (e) {}
    }

    //设置网页打印的页眉页脚为默认值 ，仅IE浏览器可用
    function PageSetup_Default() {
        try {
            var Wsh = new ActiveXObject("WScript.Shell");
            HKEY_Key = "header";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "&w&b页码,&p/&P");
            HKEY_Key = "footer";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "&u&b&d");
        } catch (e) {}
    }

    function myBrowser() {
        var userAgent = navigator.userAgent; // 取得浏览器的userAgent字符串
        var isOpera = userAgent.indexOf("Opera") > -1;
        if (isOpera) {
            return "Opera"
        }; // 判断是否Opera浏览器
        if (userAgent.indexOf("Firefox") > -1) {
            return "FF";
        } // 判断是否Firefox浏览器
        if (userAgent.indexOf("Chrome") > -1) {
            return "Chrome";
        }
        if (userAgent.indexOf("Safari") > -1) {
            return "Safari";
        } // 判断是否Safari浏览器
        if (userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1 &&
            !isOpera) {
            return "IE";
        }; // 判断是否IE浏览器
        if (userAgent.indexOf(".NET") > -1) {
            return "IE";
        }
    };

    // 字段名：data_qr，压缩后的json字符串, url_qr: 后台生成好的二维码图片链接 
    window.init = function(vf, ob) {
        var formData = vf.drViewOne;
        var dtlGridRows = ob.dtls.rows;
        var main = ob.main;

        //供应单位
        $("#company_name").html(WebPrint.getObjStr(formData.company_name ? formData.company_name.value : ""));
        $("#asn_date").html(WebPrint.dateFormat(formData.asn_date ? formData.asn_date.value : "", "ymd"));
        $("#ordercode").html(WebPrint.getObjStr(formData.rn_key ? formData.rn_key.value : ""));
        $("#asncode").html(WebPrint.getObjStr(formData.asn_key ? formData.asn_key.value : ""));
        $("#storage_fullname_req").html(WebPrint.getObjStr(formData.storage_fullname_req ? formData.storage_fullname_req.value : ""));
        //主表二维码
        var codeOutputLast = $("#qrcodes .codeOutput:last");
        var qrCodeMainCan = $("#qrCodeMainCan");
        qrCodeMainCan.html("").qrcode({
            render: "canvas", //table方式
            height: 150, //高度
            width: 150, //寬度
            colorDark: "#000000", //前景色
            colorLight: "#ffffff", //背景色
            correctLevel: correctLevel, //降低容错级别
            text: main.rows[0].data_qr.value //任意内容
        });
        var canvas = qrCodeMainCan.children("canvas");
        var img = canvas[0].toDataURL("image/png");
        $("#qrCodeMain").prop("src", img);


        if (dtlGridRows && dtlGridRows.length > 0) {
            var row, rowsHtml = [],
                amountCount = 0;
            qtyCount = 0;
            var invoiceFlag = true;
            var tempObj = null;
            dtlGridRows.forEach(function(obj, index) {
                if (obj.invoice_no && obj.invoice_no.value) {

                } else {
                    invoiceFlag = false;
                }
            });

            if (invoiceFlag) {
                // 根据发票序号大小排序
                for (var m = 0; m < dtlGridRows.length - 1; m++) {
                    for (var n = m + 1; n < dtlGridRows.length; n++) {
                        if (dtlGridRows[m]["invoice_no"].value > dtlGridRows[n]["invoice_no"].value) {
                            tempObj = dtlGridRows[m];
                            dtlGridRows[m] = dtlGridRows[n];
                            dtlGridRows[n] = tempObj;
                        }
                    }
                }
            }

            for (var i = 0; i < dtlGridRows.length; i++) {
                row = dtlGridRows[i];
                var matr_name = WebPrint.getObjStr(row.matr_name ? row.matr_name.value : "");
                rowsHtml.push('<tr class="datarow">');
                rowsHtml.push('		<td>' + (i + 1) + '</td>');
                rowsHtml.push('		<td>' + matr_name + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.matr_spec ? row.matr_spec.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.matr_unit ? row.matr_unit.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.qty ? row.qty.value : "", 0, 2) + '</td>');
                rowsHtml.push('		<td>' + WebPrint.toFixed(row.price ? row.price.value : "", 3) + '</td>');
                rowsHtml.push('		<td>' + WebPrint.toFixed(row.amount ? row.amount.value : "", 4) + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.lot ? row.lot.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.dateFormat(row.mfg_date ? row.mfg_date.value : "", "ymd") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.dateFormat(row.exp_date ? row.exp_date.value : "", "ymd") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.invoice_no ? row.invoice_no.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.register_no ? row.register_no.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.manufacturer ? row.manufacturer.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.material_conditions ? row.material_conditions.value : "") + '</td>');
                rowsHtml.push('</tr>');
                amountCount += parseFloat(WebPrint.getObjStr(row.amount ? row.amount.value : "0", 0));
                qtyCount += parseInt(WebPrint.getObjStr(row.qty ? row.qty.value : "0", 0));

            }
            $(".table-info tr:eq(0)").after(rowsHtml.join(""));

            $("#amountCount").html(WebPrint.toFixed(amountCount));
            $("#qtyCount").html(WebPrint.toFixed(qtyCount));
            WebPrint.toFixed(row.price ? row.price.value : "");
            //明細二维码，可能有多個 
            var dtlsdata_qrarr = main.rows[0].dtlsdata_qrarr.value;
            var dtlsdata_qrTitleArr = main.rows[0].dtlsdata_qrtitlearr.value;

            if (dtlsdata_qrTitleArr) {
                var dtlsdata_qrTitleArrnew = JSON.parse(dtlsdata_qrTitleArr);
                var dtlsdata_qrarrNew = JSON.parse(dtlsdata_qrarr);
                var qrhtml = '<div style="text-align: center;">';
                qrhtml += '<div class="page" style="page-break-after: always;"></div>';
                qrhtml += '<div style="padding-top:111px;">请扫描我录入明细</div>';
                qrhtml += '<div class="qrtitle"></div>';
                qrhtml += '<img class="qrCodeDtlImg" alt="加载中" />';
                qrhtml += '<div class="qrCodeDtlCode" style="display:none;"></div>';
                qrhtml += '</div>';


                for (var i = 0; i < dtlsdata_qrTitleArrnew.length; i++) {
                    tableBox.append(qrhtml);
                    var qrCodeDtlCode = $(".qrCodeDtlCode:last");
                    dtlsdata_qr = dtlsdata_qrarrNew[i];
                    qrCodeDtlCode.html("").qrcode({
                        render: "canvas", //table方式
                        height: 280, //高度
                        width: 280, //寬度
                        colorDark: "#000000", //前景色
                        colorLight: "#ffffff", //背景色
                        correctLevel: correctLevel, //降低容错级别
                        text: dtlsdata_qr //任意内容
                    });
                    var canvasDtl = qrCodeDtlCode.children("canvas");
                    var imgDtl = canvasDtl[0].toDataURL("image/png");
                    $(".qrCodeDtlImg:last").prop("src", imgDtl);
                    $(".qrtitle:last").html(dtlsdata_qrTitleArrnew[i]);
                }
            }
        }
    }

    formTool_edit.printTableId = "print-table";

    $(function() {
        //初始化
        formTool_edit.getPrintTableNew = function() {
            var formInpArr = [];
            formInpArr.push({
                id: "id1",
                text: "材料编号",
                placeholder: "请输入",
                value: "010101100535"
            });
            formInpArr.push({
                id: "id2",
                text: "材料名称",
                placeholder: "请输入",
                value: "双极射频消融电极针（三角锥型）"
            });
            formInpArr.push({
                id: "id3",
                text: "规格型号",
                placeholder: "请输入",
                value: "WB990148"
            });
            formInpArr.push({
                id: "id4",
                text: "生产批号",
                placeholder: "请输入",
                value: "333"
            });
            formInpArr.push({
                id: "id5",
                text: "生产日期",
                placeholder: "请输入",
                value: "2018-11-30"
            });
            formInpArr.push({
                id: "id6",
                text: "失效日期",
                placeholder: "请输入",
                value: "2019-12-06"
            });

            var rowHtml = [],
                rowOb;
            var tabelStyle = 'style="text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box; height: 211px; padding-top: 12px; position: relative; overflow: hidden;"';
            var pstyle = 'style="margin:0;float:left;clear:both"';
            var spanleftstyle = 'style="font-size: 14px; line-height: 16px;"';
            var spanrightstyle = 'style="font-size: 14px; line-height: 16px;"';
            var codestyle = 'style="text-align: center; padding: 0px; overflow: auto; width: 187px; margin: auto; display: inline-block; position: absolute; left: 30px; transform-origin: left bottom 0px; transform: scale(1.3); bottom: 12px;"';

            rowHtml.push('<div   class="print-table" ' + tabelStyle + '>');
            rowHtml.push('  <div');
            for (var i = 0; i < formInpArr.length; i++) {
                rowOb = formInpArr[i];
                rowHtml.push('<p ' + pstyle + '>');
                rowHtml.push('	<span  ' + spanleftstyle + '>' + rowOb.text + '</span>');
                rowHtml.push('	<span  ' + spanrightstyle + '>' + rowOb.value + '</span>');
                rowHtml.push("</p>");
            };
            rowHtml.push('  </div');

            //图片区域
            rowHtml.push('  <div name="codeOutput"  ></div>');

            rowHtml.push('</div>');

            tableBox.append(rowHtml.join(" "));

            return tableBox.children(".print-table");
        }


		 formTool_edit.sumTableFun=function(jqPageTable){//打印汇总函数，即每个分页最后一行汇总行的处理方法，可以不传，可以参考 balance_matr.html 用法
	    	var trRet=["<tr class='sumrow'>"];
	    	
	    	//合计标题列和空列
	    	trRet.push("<td>合计</td>");
	    	trRet.push("<td></td>");
	    	trRet.push("<td></td>");
	    	trRet.push("<td></td>");
	    	
	    	
	    	//合计数量
	    	var sumqtyin=0;
	    	jqPageTable.find(".datarow").each(function(){
	    		var tr=$(this);
	    		var thqtyin=parseFloat(tr.children("td:eq(4)").text());
	    		if(!isNaN(thqtyin)) sumqtyin+=thqtyin;
	    	});
	    	trRet.push("<td>"+sumqtyin.toFixed(2)+"</td>");
	    	
	    	trRet.push("<td></td>");
	    	//合计金额
	    	var sumqtyin2=0;
	    	jqPageTable.find(".datarow").each(function(){
	    		var tr=$(this);
	    		var thqtyin=parseFloat(tr.children("td:eq(6)").text());
	    		if(!isNaN(thqtyin)) sumqtyin2+=thqtyin;
	    	});
	    	trRet.push("<td>"+sumqtyin2.toFixed(2)+"</td>");
	    	trRet.push("<td></td>");
	    	trRet.push("<td></td>");
	    	trRet.push("<td></td>");
	    	trRet.push("<td></td>");
	    	trRet.push("<td></td>");
	    	trRet.push("<td></td>");
	    	trRet.push("<td></td>");
	    	trRet.push("</tr>");
	    	return trRet.join("");
	    }
        /**
        	相关操作
        	type 		 
        	btn			操作的按钮（jq对象）
        	rowIndex	删改所操作的行索引
        */
        formTool_edit.op = function(type, btn, rowIndex) {
            if (type == "print") { //打印
                // PageSetup_Null();
                if (myBrowser() == "IE") $(".print-table").addClass("print-table-ie");

                //根据每页数量，拆分表格
                var dtlNum = $("#table-form-dtl .datarow").length;
                var pageRowNum = parseInt($("#pageRowNum").val());
                if (pageRowNum != -1 && dtlNum > pageRowNum) {
                    var pageSize = Math.ceil(dtlNum / pageRowNum);
                    var tableFormDtlNew;
                    var printTableFirst = $(".print-table:first").clone(),
                        printTableNew, datarowsnew;
                    var pageFixed = $("#pageFixed").val();
                    for (var i = 0; i < pageSize; i++) {
                        printTableNew = printTableFirst.clone();
                        var qtyCountPage = 0;
                        var amountCountPage = 0;
                        if (i == 0) { //第一个表格，保留最大数目
                            printTableNew.find(".datarow").slice(pageRowNum).remove();
                            // for (var a = 0; a < printTableNew.find(".datarow").length; a++) {
                            //     qtyCountPage += parseFloat(printTableNew.find(".datarow")[a].cells[4].innerText);
                            //     amountCountPage += parseFloat(printTableNew.find(".datarow")[a].cells[6].innerText);
                            // }
                            // $('#qtyCount').html(qtyCountPage);
                        } else { //2-n动态计算
                            //删掉之后的
                            printTableNew.find(".datarow").slice((pageRowNum * (i + 1))).remove();
                            //删掉之前的
                            printTableNew.find(".datarow").slice(0, pageRowNum * i).remove();
                        }
                        printTableNew.attr("id", "");
                        //尾部放到最后一页
                        if (pageFixed == "pf2" && i != pageSize - 1) {
                            printTableNew.find("#table-form-footer").remove();
                        }
                        
                          //追加每页的汇总行
                        try {
                             var trHtml = formTool_edit.sumTableFun(printTableNew);
                             printTableNew.find("#table-form-dtl").find("tr:last").after(trHtml);
                        } catch (e) {
                            console.log("paramG.sumTableFun.error");
                            console.log(e);
                        }
                        $(".print-table:last").after(printTableNew);
                    }
                   // console.log($("#amountCount").html())

                    $(".print-table[id!='print-table']").each(function() {
                        $(this).after('<div class="page" style="page-break-after: always;"></div>');
                    })
                    $("#print-table").hide();
                }else{
                
               	   		//追加每页的汇总行
                       try {
                            
                             var trHtml = formTool_edit.sumTableFun($(".print-table:first"));
                            $(".print-table:first").find("#table-form-dtl").find("tr:last").after(trHtml);
                       } catch (e) {
                           console.log("paramG.sumTableFun.error");
                           console.log(e);
                       }
                       $(".print-table:last").after(printTableNew);
                }

                tableBox.jqprint({
                    debug: false, //如果是true则可以显示iframe查看效果
                    //（iframe默认高和宽都很小，可以再源码中调大），默认是false
                    importCSS: true, //true表示引进原来的页面的css，默认是true。
                    //（如果是true，先会找$("link[media=print]")，若没有会去找$("link")中的css文件）
                    printContainer: true, //表示如果原来选择的对象必须被纳入打印
                    //（注意：设置为false可能会打破你的CSS规则）。
                    operaSupport: true //表示如果插件也必须支持歌opera浏览器，在这种情况下，
                        //它提供了建立一个临时的打印选项卡。默认是true
                });
                //打印完，重置显示
                $(".print-table[id!='print-table']").remove();
                 //删除合计列
                $(".sumrow").remove();
                
                
                $(".page").remove();
                $("#print-table").show();

            }
        };


        //var codeOutputLast=tableBox.find('.codeOutput:last');
        //codeOutputLast.html("").barcode("2018120203-01", barcodeSettings.btype, barcodeSettings);

        var companyNameMi = window.parent.topWin.companyNameMi;
        if (companyNameMi && companyNameMi != "请选择院方" && companyNameMi != "请选择") $("#maintitle").html(companyNameMi + "送货单");

    })
</script>

</html>