<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- 发货单 打印二维码 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <script src="../../../../res/jscript/xwf.ajax.js"></script>
    <script src="../../../../res/jscript/xwf.js"></script>
    <script src="../../../../res/jscript/xwf.const.js"></script>
    <link href="../../../../res_plugin/zui-1.8.1-dist/css/zuibtn.css" rel="stylesheet" type="text/css" />
</head>

<body id="body-uview">
    <div class="container-fluid container-fluid-main scrollbar-hover" id="container-uview-edit">
        <div class="row">
            <div class="col-xs-12">
                <table class2="table table-hover table-borderless table-condensed table-striped">
                    <tbody>
                        <tr>
                            <td colspan="2">
                                <div class="row">
                                    <div class="col-xs-2" style="width:120px;">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-primary" onclick="formTool_edit.op('print');" title="打印条形码或二维码及表单">打印</button>
                                            <button type="button" class="btn" onclick="win.close();" title="关闭当前窗口">关闭</button>
                                        </div>
                                    </div>
                                    <div class="col-xs-4">
                                        <div class="input-group">
                                            <span class="input-group-btn">
									    <button class="btn btn-default" type="button">纸张类型</button>
									  </span>
                                            <select class="form-control" title="纸张类型" onchange="pageSize(this);" style="width:150px;">
									  		<option value="1">标准纸张(a4/a5/b5)</option>
									  		<option value="5">针式五联打印</option>
									  	</select>
                                        </div>
                                    </div>
                                </div>


                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="tableBox" style="padding-top:30px;">
                <style type="text/css"  media="print">
                    .noprint {
                        display: none
                    }
                    
                    .print {
                        margin-left: 25%
                    }
                    
                    @("@")page {
                        size: auto;
                        /* auto is the initial value */
                        margin: 0mm;
                        /* this affects the margin in the printer settings */
                    }
                    
                    .print-table {
                        color: black;
                        margin: auto auto;
                        width: 100%;
                        background-color: rgb(255, 255, 255);
                        box-sizing: border-box;
                        PADDING-LEFT: 10PX;
                        table-layout: fixed;
                        font-family: microsoft yahei;
                    }
                    
                    .noboder {
                        border: 0px !important;
                    }
                    
                    table {
                        width: 100%;
                        border-spacing: 0;
                        border-collapse: collapse;
                    }
                    
                    table th {
                        word-break: keep-all;
                    }
                    
                    .table5 {
                        margin-top: 0px;
                    }
                    
                    .table5 th,
                    .table5 td {
                        padding: 2px 4px !important;
                    }
                    
                    .table5 .codeOutput object {
                        height: 60px;
                    }
                    
                    table td {
                        word-break: break-all;
                    }
                    
                    table th,
                    table td {
                        padding: 10px 5px;
                        border: 1px dotted #2f2f2f;
                    }
                    
                    .codeOutput {
                        padding-top: 10px !important;
                        width: 100% !important;
                        margin: auto auto;
                    }
                    
                    .codeOutput object {
                        height: 70px;
                        width: 100%;
                    }
                    
                    .codeOutput div:LAST-CHILD {
                        font-size: 9px !important;
                        height: auto !important;
                        text-align: left !important;
                    }
                    
                    .codeOutputinfo {
                        text-align: center;
                        letter-spacing: 0.5px;
                        font-size: 13px;
                    }
                    
                    .title {
                        text-align: center;
                        font-weight: 700;
                        font-size: 22px;
                    }
                    
                    .title2,
                    .table-info th {
                        font-size: 12px;
                        font-weight: 700;
                    }
                    
                    .print-table-ie .title {
                        font-size: 52px !important;
                    }
                    
                    .table-footer {
                        font-weight: bold;
                        font-size: 12px;
                    }
                    
                    .print-table-ie .table-footer {
                        font-size: 22px !important;
                    }
                    
                    .table-footer,
                    .table-footer td {
                        border: 0px !important;
                    }
                    
                    .print-table-ie .title2,
                    .print-table-ie .table-info th {
                        font-size: 22px !important;
                    }
                    
                    .table-info td {
                        font-size: 11px;
                    }
                    
                    .print-table-ie .table-info td {
                        font-size: 21px !important;
                    }
                </style>
                <table class="print-table print-table-1">
                    <tr>
                        <td id="maintitle" class="title noboder" style="text-align: center;">
                            送货单<span id="poType"></span>
                        </td>
                        <td class="noboder" style="width:300px;padding-right:20px;">
                            <div class="codeOutput">条形码显示区域</div>
                            <div class="codeOutputinfo">2018120203-01</div>
                        </td>
                    </tr>
                    <tr class="title2">
                        <td class="noboder">
                            供应单位：<span id="company_name" style="padding-right: 22px;"></span> 需求仓库：

                            <span id="storagename"></span>
                        </td>
                        <td class="noboder">
                            送货日期：<span id="asn_date"></span>
                        </td>
                    </tr>
                    <tr>
                        <td class="noboder" colspan="2">
                            <table class="table-info" style="margin-top:5px !important;">
                                <tr>
                                    <th style="width: 13.3%;">材料名称 </th>
                                    <th style="width: 10%;">规格型号</th>
                                    <th style="width: 3.3%;">一物一码</th>
                                    <th style='width: 3.3%;'>单位</th>
                                    <th style='width: 3.3%;'>数量</th>
                                    <th style='width: 6.6%;'>单价（元）</th>
                                    <th style='width: 10%;'>总价（元）</th>
                                    <th style="width: 9.9%;">生产批号</th>
                                    <th style="width:  9.9%;">有效日期</th>
                                    <th style="width: 13.3%;">生产厂家</th>
                                    <th style="width: 13.3%;" ">注册证</th>
								<th   style="width: 2.2%; "">灭菌批号</th>
                                </tr>
                                <!-- 	<tr>
								<td>结扎血管夹
								</td>
								<td>SD-JZM
								</td>
								<td>个
								</td>
								<td>60
								</td>
								<td>81.0000
								</td>
								<td>486.00
								</td>
								<td>JY1004-1804001
								</td>
								<td>2023-03-06
								</td>
								<td>浙江浙江浙江浙江浙江浙江浙江
								</td>
								<td>浙2008
								</td>
								<td>2008
								</td>
							</tr> 
							
								<tr style="    height: 42px;">
									<td colspan="11">
									</td>
								</tr>
							
							-->
                                <tr>
                                    <td>合计
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td id =qtyCount>0.00
                                    </td>
                                    <td>
                                    </td>
                                    <td id="amountCount">0.00
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td class="noboder" colspan="2">
                            <table class="table-footer" style="margin-top:0px; ">
                                <tr>
                                    <td>送货人：
                                    </td>
                                    <td>
                                    </td>
                                    <td>验收人
                                    </td>
                                    <td>
                                    </td>
                                    <td>储运条件:
                                    </td>
                                    <td>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </div>

            <div id="qrCodeBox" style="width:800px;height:600px;display:none;"></div>
        </div>
    </div>
    <input id="printqrcode" type="hidden" value="0" />
    <input id="asnId" type="hidden" value="" />
</body>

<script src="../../../../res_plugin/jquery/jquery-1.11.3.min.js"></script>
<script src="../../../../res_plugin/jquery/jquery-migrate-1.2.1.js" title="jQuery migrate插件解决迁移兼容问题"></script>
<script src="../../../../res_plugin/jquery/jquery-barcode.min.js" title="条形码"></script>
<script src="../../../../res_plugin/jquery/jquery.jqprint-0.3.js" title="打印插件"></script>
<script src="../../../../res/jscript/web_print.js" type="text/javascript"></script>
<script src="../../../g_spd/html/wi/jquery.qrcode.min.js"></script>


<script>
    var formTool_edit = {},
        codeOutputbox = $("#codeOutputbox"),
        codeInput = $("#codeInput"),
        tableBox = $("#tableBox");

    function pageSize(sel) {
        if (sel.value == "5") {
            tableBox.css("padding-top", "5px");
            $("table").addClass("table5");
        } else {
            tableBox.css("padding-top", "30px");
            $("table").removeClass("table5");
        }
    }
    //条形码配置
    var barcodeSettings = {
        btype: "code128", //ean8  ean13  std25  int25  code11  code39  code93  code128（一般商品扫描使用）  codabar  msi  datamatrix
        output: 'bmp', //渲染方式 css/bmp/svg/canvas
        //bgColor: '#ff0000', //条码背景颜色
        //color: '#00ff00',   //条码颜色
        barWidth: 1, //单条条码宽度
        barHeight: 50, //单体条码高度
        //moduleSize: 10,   //条码大小
        // posX: 10,        //条码坐标X
        // posY: 5,         //条码坐标Y
        showHRI: true, //是否在条码下方显示内容
        addQuietZone: false //是否添加空白区（内边距）
    };
    //设置网页打印的页眉页脚为空 ，仅IE浏览器可用
    function PageSetup_Null() {
        try {
            var Wsh = new ActiveXObject("WScript.Shell");
            HKEY_Key = "header";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "");
            HKEY_Key = "footer";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "");
        } catch (e) {}
    }

    //设置网页打印的页眉页脚为默认值 ，仅IE浏览器可用
    function PageSetup_Default() {
        try {
            var Wsh = new ActiveXObject("WScript.Shell");
            HKEY_Key = "header";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "&w&b页码,&p/&P");
            HKEY_Key = "footer";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "&u&b&d");
        } catch (e) {}
    }

    function myBrowser() {
        var userAgent = navigator.userAgent; // 取得浏览器的userAgent字符串
        var isOpera = userAgent.indexOf("Opera") > -1;
        if (isOpera) {
            return "Opera"
        }; // 判断是否Opera浏览器
        if (userAgent.indexOf("Firefox") > -1) {
            return "FF";
        } // 判断是否Firefox浏览器
        if (userAgent.indexOf("Chrome") > -1) {
            return "Chrome";
        }
        if (userAgent.indexOf("Safari") > -1) {
            return "Safari";
        } // 判断是否Safari浏览器
        if (userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1 &&
            !isOpera) {
            return "IE";
        }; // 判断是否IE浏览器
        if (userAgent.indexOf(".NET") > -1) {
            return "IE";
        }
    };


    window.init = function(vf, dtlGrid) {
        var formData = vf.drViewOne;
        var dtlGridRows = dtlGrid.dtbViewData.rows;

        //供应单位  storagename
        $("#company_name").html(WebPrint.getObjStr(formData.company_name ? formData.company_name.value : ""));

        $("#storagename").html(WebPrint.getObjStr(formData.storage_fullname_req ? formData.storage_fullname_req.value : ""));
        $("#asn_date").html(WebPrint.dateFormat(formData.asn_date ? formData.asn_date.value : "", "ymd"));

        //二维码
        var asn_key = WebPrint.getObjStr(formData.asn_key ? formData.asn_key.value : "");
        $(".codeOutputinfo").html(asn_key);
        $("#printqrcode").val(vf.printqrCode);
        $("#asnId").val(formData.asn_id ? formData.asn_id.value : "");
        var codeOutputLast = tableBox.find('.codeOutput:last');
        codeOutputLast.html("").barcode(asn_key, barcodeSettings.btype, barcodeSettings);
        var poType = "购销";
        var companyNameMi = window.parent.topWin.companyNameMi;
        var maintitle = "送货单";
        if (companyNameMi && companyNameMi != "请选择院方" && companyNameMi != "请选择") maintitle = companyNameMi + "送货单";
        //maintitle+="(";
        //maintitle+=(formData.po_type_name?formData.po_type_name.value:"");
        //maintitle+=")";
        $("#maintitle").html(maintitle);


        if (dtlGridRows && dtlGridRows.length > 0) {
            var row, rowsHtml = [],
                amountCount = 0,
                qtyCount = 0;
            for (var i = 0; i < dtlGridRows.length; i++) {
                row = dtlGridRows[i];
                rowsHtml.push('<tr>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.matr_name ? row.matr_name.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.matr_spec ? row.matr_spec.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.isomoc ? row.isomoc.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.matr_unit ? row.matr_unit.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.qty ? row.qty.value : "", 0) + '</td>');
                rowsHtml.push('		<td>' + WebPrint.toFixed(row.price ? row.price.value : "", 2) + '</td>');
                rowsHtml.push('		<td>' + WebPrint.toFixed(row.amount ? row.amount.value : "", 2) + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.lot ? row.lot.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.dateFormat(row.exp_date ? row.exp_date.value : "", "ymd") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.manufacturer ? row.manufacturer.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.register_no ? row.register_no.value : "") + '</td>');
                rowsHtml.push('		<td>' + WebPrint.getObjStr(row.disinfection_lot ? row.disinfection_lot.value : "") + '</td>');
                rowsHtml.push('</tr>');
                amountCount += parseFloat(row.amount ? row.amount.value : "0");
                qtyCount += parseFloat(row.qty ? row.qty.value : "0");
            }
            $(".table-info tr:eq(0)").after(rowsHtml);

            $("#qtyCount").html(WebPrint.toFixed(qtyCount, 2));
            $("#amountCount").html(WebPrint.toFixed(amountCount, 2));
            WebPrint.toFixed(row.price ? row.price.value : "")
        }

    }

    formTool_edit.printTableId = "print-table";

    $(function() {
        //初始化
        formTool_edit.getPrintTableNew = function() {
            var formInpArr = [];
            formInpArr.push({
                id: "id1",
                text: "材料编号",
                placeholder: "请输入",
                value: "010101100535"
            });
            formInpArr.push({
                id: "id2",
                text: "材料名称",
                placeholder: "请输入",
                value: "双极射频消融电极针（三角锥型）"
            });
            formInpArr.push({
                id: "id3",
                text: "规格型号",
                placeholder: "请输入",
                value: "WB990148"
            });
            formInpArr.push({
                id: "id4",
                text: "生产批号",
                placeholder: "请输入",
                value: "333"
            });
            formInpArr.push({
                id: "id5",
                text: "生产日期",
                placeholder: "请输入",
                value: "2018-11-30"
            });
            formInpArr.push({
                id: "id6",
                text: "失效日期",
                placeholder: "请输入",
                value: "2019-12-06"
            });

            var rowHtml = [],
                rowOb;
            var tabelStyle = 'style="text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box; height: 211px; padding-top: 12px; position: relative; overflow: hidden;"';
            var pstyle = 'style="margin:0;float:left;clear:both"';
            var spanleftstyle = 'style="font-size: 14px; line-height: 16px;"';
            var spanrightstyle = 'style="font-size: 14px; line-height: 16px;"';
            var codestyle = 'style="text-align: center; padding: 0px; overflow: auto; width: 187px; margin: auto; display: inline-block; position: absolute; left: 30px; transform-origin: left bottom 0px; transform: scale(1.3); bottom: 12px;"';

            rowHtml.push('<div   class="print-table" ' + tabelStyle + '>');
            rowHtml.push('  <div');
            for (var i = 0; i < formInpArr.length; i++) {
                rowOb = formInpArr[i];
                rowHtml.push('<p ' + pstyle + '>');
                rowHtml.push('	<span  ' + spanleftstyle + '>' + rowOb.text + '</span>');
                rowHtml.push('	<span  ' + spanrightstyle + '>' + rowOb.value + '</span>');
                rowHtml.push("</p>");
            };
            rowHtml.push('  </div');

            //图片区域
            rowHtml.push('  <div name="codeOutput"  ></div>');

            rowHtml.push('</div>');

            tableBox.append(rowHtml.join(" "));

            return tableBox.children(".print-table");
        }


        /**
        	相关操作
        	type 		 
        	btn			操作的按钮（jq对象）
        	rowIndex	删改所操作的行索引
        */
        formTool_edit.op = function(type, btn, rowIndex) {
            if (type == "buildLine") { //生成条形码
                formTool_edit.printType = 1;
                var table = tableBox.find('.print-table:last').clone();
                table.attr("class", "print-table");

                tableBox.append(table.prop("outerHTML"));
            } else if (type == "build2code") { //生成二维码
                formTool_edit.printType = 2;
                codeOutput.html("").qrcode({
                    render: "canvas", //table方式
                    width: 700, //宽度
                    height: 400, //高度
                    text: codeInput.val() //任意内容
                });
            } else if (type == "print") { //打印
                //去掉table border

                if (formTool_edit.printType == 2) { //二维码打印
                    //codeOutputImg[0].src = codeOutput.children("canvas")[0].toDataURL();      
                    //codeOutput.hide();
                    //codeOutputImg.show();
                }
                PageSetup_Null();
                if (myBrowser() == "IE") $(".print-table").addClass("print-table-ie");
                tableBox.jqprint({
                    debug: false, //如果是true则可以显示iframe查看效果
                    //（iframe默认高和宽都很小，可以再源码中调大），默认是false
                    importCSS: true, //true表示引进原来的页面的css，默认是true。
                    //（如果是true，先会找$("link[media=print]")，若没有会去找$("link")中的css文件）
                    printContainer: true, //表示如果原来选择的对象必须被纳入打印
                    //（注意：设置为false可能会打破你的CSS规则）。
                    operaSupport: true //表示如果插件也必须支持歌opera浏览器，在这种情况下，
                        //它提供了建立一个临时的打印选项卡。默认是true
                });

            } else if (type == "reset") { //重置
                tableBox.children(".print-table").remove();
            } else if (type == "close") { //关闭设计弹窗
                xpasModal.confirm.setOkFun(function(param) {
                    formUtil_UV.winModalUviewEdit.close();
                }, {}).confirm("确认关闭该窗口么？");
            }
        };


        //var codeOutputLast=tableBox.find('.codeOutput:last');
        //codeOutputLast.html("").barcode("2018120203-01", barcodeSettings.btype, barcodeSettings);



    })
</script>

</html>