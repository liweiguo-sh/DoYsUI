<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- 打印表单模板页面  勿动 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link href="../../../../res_plugin/zui-1.8.1-dist/css/zuibtn.css" rel="stylesheet" type="text/css" />
    <style>
        .body-uview .row {
            margin: 0;
        }
        
        .body-uview .row .col-xs-12 {
            padding: 0;
        }
    </style>
</head>

<body id="body-uview" class="body-uview">
    <div class="container-fluid container-fluid-main scrollbar-hover" id="container-uview-edit">
        <div class="row">
            <div class="col-xs-12">
                <table class="table table-hover table-borderless table-condensed table-striped">
                    <tbody>
                        <tr>
                            <td colspan="1">
                                <div class="form-group">
                                    <div class="col-xs-12">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-primary" onclick="formTool_edit.op('print',false);" title="打印">打印(浏览器)</button>
                                            <button type="button" class="btn btn-info" onclick="formTool_edit.op('print',true);" title="预览">预览(浏览器)</button>
                                            <!--  <button type="button" class="btn btn-primary" onclick="formTool_edit.op('print',false,true);" title="打印">打印</button>
                                            <button type="button" class="btn btn-info" onclick="formTool_edit.op('print',true,true);" title="预览">预览</button> -->
                                            <button type="button" class="btn" onclick="win.close();" title="关闭当前窗口">关闭</button>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="1">
                                <div class="form-group">
                                    <div class="col-xs-2">
                                        <div class="input-group" style="padding-right:9px;">
                                            <span class="input-group-addon">每页数量</span>
                                            <input class="form-control" id="pageRowNum" title="每页数量" value="10" type="number" style="height: 22px;">
                                        </div>
                                    </div>
                                    <div class="col-xs-2">
                                        <div class="input-group" style="padding-right:9px;">
                                            <span class="input-group-btn">
									    <button class="btn btn-default" type="button">列表样式</button>
									  </span>
                                            <select class="form-control" id="pageSize" title="纸张大小" onchange="pageSize(this)">
									  		<option value="a4">正常</option>
									  		<option value="b5">无间距</option>
									  		<option value="b52">无间距并且自动换行</option>
									  	</select>
                                        </div>
                                    </div>
                                    <div class="col-xs-2">
                                        <div class="input-group">
                                            <span class="input-group-btn">
									    <button class="btn btn-default" type="button">固定位置</button>
									  </span>
                                            <select class="form-control" id="pageFixed" title="固定位置">
									  		<option value="pf2" >每页都包含头部，尾部放到最后一页</option>
											<option value="pf1" selected = "selected">每页都包含头部和尾部</option>
									  	</select>
                                        </div>
                                    </div>
                                    <div class="col-xs-6"></div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="1">
                                <div class="form-group">
                                    <div class="col-xs-12" id="printInfoBoxId">

                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="tableBox">
                <style type="text/css"  media="print" id="stylePrint">
                    .noprint {
                        display: none
                    }
                    
                    .print {
                        margin-left: 25%
                    }
                    
                    @("@")page {
                        size: auto;
                        /* auto is the initial value */
                        margin: 0mm;
                        /* this affects the margin in the printer settings */
                    }
                    
                    .print-table {
                        color: black;
                        margin: auto auto;
                        width: 100%;
                        background-color: rgb(255, 255, 255);
                        box-sizing: border-box;
                        PADDING-LEFT: 10PX;
                        table-layout: fixed;
                        font-family: microsoft yahei;
                    }
                    
                    .noboder {
                        border: 0px !important;
                    }
                    
                    table {
                        width: 100%;
                        border-spacing: 0;
                        border-collapse: collapse;
                    }
                    
                    table th {
                        word-break: keep-all;
                    }
                    
                    .table5 {
                        margin-top: 0px;
                    }
                    
                    .table5 th,
                    .table5 td {
                        padding: 2px 4px !important;
                    }
                    
                    .table5 .codeOutput object {
                        height: 60px;
                    }
                    
                    .table52 td {
                        word-break: normal !important;
                        white-space: normal !important;
                        overflow: auto !important;
                        text-overflow: initial !important;
                    }
                    
                    table td {
                        word-break: break-all;
                        white-space: nowrap;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }
                    
                    table th,
                    table td {
                        padding: 10px 5px;
                        border: 1px solid #2f2f2f;
                    }
                    
                    .codeOutput {
                        padding-top: 10px !important;
                        width: 100% !important;
                        margin: auto auto;
                    }
                    
                    .codeOutput object {
                        height: 70px;
                        width: 100%;
                    }
                    
                    .codeOutput div:LAST-CHILD {
                        font-size: 9px !important;
                        height: auto !important;
                        text-align: left !important;
                    }
                    
                    .codeOutputinfo {
                        text-align: center;
                        letter-spacing: 0.5px;
                        font-size: 13px;
                    }
                    
                    .title {
                        text-align: center;
                        font-weight: 700;
                        font-size: 22px;
                    }
                    
                    .table-info {}
                    
                    .title2,
                    .table-info th {
                        font-size: 12px;
                        font-weight: 700;
                    }
                    
                    .print-table-ie .title {
                        font-size: 52px !important;
                    }
                    
                    .table-footer {
                        font-weight: bold;
                        font-size: 12px;
                    }
                    
                    .print-table-ie .table-footer {
                        font-size: 22px !important;
                    }
                    
                    .table-footer,
                    .table-footer td {
                        border: 0px !important;
                    }
                    
                    .print-table-ie .title2,
                    .print-table-ie .table-info th {
                        font-size: 22px !important;
                    }
                    
                    .table-info td {
                        font-size: 11px;
                    }
                    
                    .print-table-ie .table-info td {
                        font-size: 21px !important;
                    }
                    
                    .spanpage {
                        position: absolute;
                        right: 44px;
                    }
                </style>
                <table id="print-table" class="print-table print-table-1">
                    <!-- 头部区域 -->
                    <tr>
                        <td id="print-title" class="title noboder" style="text-align: center;" colspan="2">
                            打印标题
                        </td>
                        <!-- <td id="print-txm" class="noboder" style="width:300px;padding-right:20px;">
                            <div class="codeOutput">条形码显示区域</div>
                            <div class="codeOutputinfo">2018120203-01</div>
                        </td> -->
                    </tr>
                    <!-- 表头区域 -->
                    <tr id="table-form-head">
                        <td class="noboder" colspan="2" style="padding-top: 0px; padding-bottom: 0px;">
                            <table id="table-form" class="table-info" style="">
                            </table>
                        </td>
                    </tr>
                    <!-- 明细区域 -->
                    <tr id="table-form-dtl">
                        <td class="noboder" colspan="2" style="padding-top: 0px; padding-bottom: 0px;">
                            <table id="grid" class="table-info" style="margin-top:5px !important;">
                            </table>
                        </td>
                    </tr>
                    <!-- 表尾区域 -->
                    <tr id="table-form-footer" style="padding-top: 0px; padding-bottom: 0px;">
                        <td class="noboder" colspan="2">
                            <table id="table-footer" class="table-info" style="table-layout: fixed;">
                            </table>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</body>

<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>

<script src="../../../../res_plugin/jquery/jquery-1.11.3.min.js"></script>
<script src="../../../../res_plugin/jquery/jquery-migrate-1.2.1.js" title="jQuery migrate插件解决迁移兼容问题"></script>
<script src="../../../../res_plugin/jquery/jquery-barcode.min.js" title="条形码"></script>
<script src="../../../../res_plugin/jquery/jquery.jqprint-0.3.js" title="打印插件"></script>

<script src="../../../../res/jscript/jquery.qrcode.min.js"></script>
<script src="../../../../res/jscript/web_print.js" type="text/javascript"></script>


<script>
    var formTool_edit = {},
        codeOutputbox = $("#codeOutputbox"),
        codeInput = $("#codeInput"),
        tableBox = $("#tableBox");

    function pageSize(sel) {
        if (sel.value == "b5") {
            tableBox.css("padding-top", "5px");
            $("table").addClass("table5");
        } else if (sel.value == "b52") {
            tableBox.css("padding-top", "5px");
            $(".print-table ").addClass("table5").addClass("table52");
        } else {
            tableBox.css("padding-top", "30px");
            $(".print-table ").removeClass("table5").removeClass("table52");;
        }
    }
    //条形码配置
    var barcodeSettings = {
        btype: "code128", //ean8  ean13  std25  int25  code11  code39  code93  code128（一般商品扫描使用）  codabar  msi  datamatrix
        output: 'bmp', //渲染方式 css/bmp/svg/canvas
        //bgColor: '#ff0000', //条码背景颜色
        //color: '#00ff00',   //条码颜色
        barWidth: 1, //单条条码宽度
        barHeight: 50, //单体条码高度
        //moduleSize: 10,   //条码大小
        // posX: 10,        //条码坐标X
        // posY: 5,         //条码坐标Y
        showHRI: true, //是否在条码下方显示内容
        addQuietZone: false //是否添加空白区（内边距）
    };
    //设置网页打印的页眉页脚为空 ，仅IE浏览器可用
    function PageSetup_Null() {
        try {
            var Wsh = new ActiveXObject("WScript.Shell");
            HKEY_Key = "header";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "");
            HKEY_Key = "footer";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "");
        } catch (e) {}
    }

    //设置网页打印的页眉页脚为默认值 ，仅IE浏览器可用
    function PageSetup_Default() {
        try {
            var Wsh = new ActiveXObject("WScript.Shell");
            HKEY_Key = "header";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "&w&b页码,&p/&P");
            HKEY_Key = "footer";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "&u&b&d");
        } catch (e) {}
    }

    function myBrowser() {
        var userAgent = navigator.userAgent; // 取得浏览器的userAgent字符串
        var isOpera = userAgent.indexOf("Opera") > -1;
        if (isOpera) {
            return "Opera"
        }; // 判断是否Opera浏览器
        if (userAgent.indexOf("Firefox") > -1) {
            return "FF";
        } // 判断是否Firefox浏览器
        if (userAgent.indexOf("Chrome") > -1) {
            return "Chrome";
        }
        if (userAgent.indexOf("Safari") > -1) {
            return "Safari";
        } // 判断是否Safari浏览器
        if (userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1 &&
            !isOpera) {
            return "IE";
        }; // 判断是否IE浏览器
        if (userAgent.indexOf(".NET") > -1) {
            return "IE";
        }
    };

    var paramG;
    window.init = function(param) {
        if (!param) {
            alert("初始化参数错误，请检查");
            return;
        }
        // if (topWin.serverName == 'SPD_BJTT') {
        //     $('#print-table').css({
        //         display: 'block'
        //     });
        //     $('#print-table > tbody > tr:first-child').css({
        //         position: 'relative',
        //         display: 'block',
        //         height: '80px'
        //     });
        //     $('#print-table > tbody > tr:first-child > td:first-child').css({
        //         display: 'block'
        //     });
        //     $('#print-table > tbody > tr:first-child > td:last-child').css({
        //         position: 'absolute',
        //         right: '90px',
        //         top: '40px'
        //     });
        //     if (param.form.ths.length > 1) {
        //         $('#print-txm').show();
        //         $('.codeOutputinfo').text(param.form.ths[2].value);
        //         var codeOutputLast = tableBox.find('.codeOutput:last');
        //         codeOutputLast.html("").barcode(param.form.ths[2].value, 'code128', {
        //             btype: "code128", //ean8  ean13  std25  int25  code11  code39  code93  code128（一般商品扫描使用）  codabar  msi  datamatrix
        //             output: 'bmp', //渲染方式 css/bmp/svg/canvas
        //             //bgColor: '#ff0000', //条码背景颜色
        //             //color: '#00ff00',   //条码颜色
        //             barWidth: 1, //单条条码宽度
        //             barHeight: 50, //单体条码高度
        //             //moduleSize: 10,   //条码大小
        //             // posX: 10,        //条码坐标X
        //             // posY: 5,         //条码坐标Y
        //             showHRI: true, //是否在条码下方显示内容
        //             addQuietZone: false //是否添加空白区（内边距）
        //         });
        //     } else {
        //         $('#print-txm').hide();
        //     }

        // } else {
        //     $('#print-txm').hide();
        // }
        paramG = param;
        //1、打印标题
        if (param.title) $("#print-title").html("<span class=''>" + param.title + "</span>" + "<span class='spanpage'>1/1</span>");
        //标题样式
        if (param.titleCss) $("#print-title").attr("style", param.titleCss);

        //标题样式
        if (param.gridCss) {
            var cssold = $("#grid").attr("style");
            if (!cssold) cssold = "";
            $("#grid").attr("style", cssold + param.gridCss);
        }

        //2、表头区域
        if (param.form) {
            if (param.form.ths) {
                var th;
                var tableForm = $("#table-form");
                var thsHtml = [];
                var colNumThs = param.colNumThs;

                if (!colNumThs) colNumThs = 4;
                colNumThs = parseInt(colNumThs);
                var tdWidth = "",
                    tdColNum = 1,
                    ret = 0,
                    sum = 0,
                    css, cssLable, cssText;
                var barcodeType, barcodeStyle, barWidth, barHeight;
                for (var i in param.form.ths) {
                    sum++;
                    th = param.form.ths[i];
                    var thHtml = ['<tr class="title2">'];
                    tdWidth = th.width;
                    tdColNum = th.colspan;
                    css = th.css;
                    cssLable = th.cssLable;
                    cssText = th.cssText;
                    if (!css) css = "";
                    if (!cssLable) cssLable = "";
                    if (!cssText) cssText = "";


                    if (!tdWidth) tdWidth = "10%";
                    if (!tdColNum) tdColNum = 1;

                    barWidth = th.barWidth;
                    barHeight = th.barHeight;
                    if (!barWidth) barWidth = "1";
                    if (!barHeight) barHeight = "50";

                    barcodeType = th.barcodeType;
                    barcodeStyle = th.barcodeStyle;
                    if (!barcodeType) barcodeType = "";
                    if (!barcodeStyle) barcodeStyle = "";


                    thsHtml.push('<td  class="noboder" style="width: 10%;font-weight: 700;' + cssLable + '">' + th.text + ':</td>');
                    thsHtml.push('<td barWidth="' + barWidth + '" barHeight="' + barHeight + '"  barcodeType="' + barcodeType + '" barcodeStyle="' + barcodeStyle + '"  class="noboder" colspan=' + tdColNum + ' style="text-align:left;' + cssText + css + '">' + th.value + '</td>');
                    if ((sum) % colNumThs == 0) {
                        tableForm.append("<tr>" + thsHtml.join("") + "</tr>");
                        thsHtml = [];
                    }
                }
                if (thsHtml.length > 0) {
                    for (var i = 0; i < colNumThs - (thsHtml.length / 2); i++) {
                        //thsHtml.push('<td  class="noboder" style="width: 5%;word-break: keep-all;font-weight: 700;"></td>');
                        //thsHtml.push('<td  class="noboder" style="text-align:left;"></td>');
                    }
                    tableForm.append("<tr>" + thsHtml.join("") + "</tr>");
                }
            }
        }

        //3、明细数据
        if (param.grid) {
            var grid = $("#grid");

            //表头

            if (param.grid.ths) {
                var th, trHtml = [],
                    thwidths = param.grid.thwidths,
                    thWidth = "auto",
                    thstyle;
                var thstyles = param.grid.thstyles,
                    thstyle;
                trHtml.push("<tr class='datahead'>");
                for (var i in param.grid.ths) {
                    th = param.grid.ths[i];

                    thWidth = "auto";
                    if (thwidths && thwidths.length > 0 && thwidths[i]) thWidth = thwidths[i];
                    thstyle = "";
                    if (thstyles && thstyles.length > 0 && thstyles[i]) thstyle = thstyles[i];
                    trHtml.push("<th style='width:" + thWidth + ";" + thstyle + "'>" + th + "</th>");
                }
                trHtml.push("</tr>");
                grid.append(trHtml.join(""));
            }


            //表格明细
            var tds, trHtml = [],
                tdVal,
                thwidths = param.grid.thwidths,
                thWidth = "auto";
            var tdstyles = param.grid.thstyles,
                tdstyle;
            var dateFormats = param.grid.dateFormats,
                dateFormat;

            if (param.arrBySql) {
                for (var i in param.grid.data) {
                    tds = param.grid.data[i];
                    trHtml.push("<tr  class='datarow'>");
                    for (var j in param.grid.thsfield) {
                        thWidth = "auto";
                        fieldName = param.grid.thsfield[j];

                        if (fieldName == "index") {
                            tdVal = (parseInt(i) + 1);
                        } else {
                            tdVal = tds[fieldName];
                        }


                        if (thwidths && thwidths.length > 0 && thwidths[j]) thWidth = thwidths[j];
                        tdstyle = "";
                        if (tdstyles && tdstyles.length > 0 && tdstyles[j]) tdstyle = tdstyles[j];
                        tdVal = tds[j];
                        if (dateFormats && dateFormats.length > 0 && dateFormats[j]) tdVal = WebPrint.dateFormat(tdVal, dateFormats[j]);;
                        var fieldType = typeof(tdVal);
                        trHtml.push('<td fieldType="' + fieldType + '" style="max-width:' + thWidth + ';width:' + thWidth + ';' + tdstyle + '">' + tdVal + '</td>');
                    }
                    trHtml.push("</tr>");
                }
                grid.append(trHtml.join(""));
            } else {
                for (var i in param.grid.data) {
                    tds = param.grid.data[i];
                    trHtml.push("<tr  class='datarow'>");
                    for (var j in tds) {
                        thWidth = "auto";
                        if (thwidths && thwidths.length > 0 && thwidths[j]) thWidth = thwidths[j];
                        tdstyle = "";
                        if (tdstyles && tdstyles.length > 0 && tdstyles[j]) tdstyle = tdstyles[j];
                        tdVal = tds[j];
                        if (dateFormats && dateFormats.length > 0 && dateFormats[j]) tdVal = WebPrint.dateFormat(tdVal, dateFormats[j]);;
                        var fieldType = typeof(tdVal);
                        trHtml.push('<td fieldType="' + fieldType + '" style="max-width:' + thWidth + ';width:' + thWidth + ';' + tdstyle + '">' + tdVal + '</td>');
                    }
                    trHtml.push("</tr>");
                }
                grid.append(trHtml.join(""));
            }
        }

        //2、底部区域
        if (param.form) {
            if (param.form.tfooters) {
                var th;
                var tableForm = $("#table-footer");
                var thsHtml = [];
                var colNumTfooters = param.colNumTfooters,
                    sum = 0,
                    cssLable, cssText;;
                if (!colNumTfooters) colNumTfooters = 4;
                for (var i in param.form.tfooters) {
                    sum++;
                    th = param.form.tfooters[i];
                    var thHtml = '<tr class="title2">';

                    cssLable = th.cssLable;
                    cssText = th.cssText;
                    if (!cssLable) cssLable = "";
                    if (!cssText) cssText = "";

                    thsHtml.push('<td  class="noboder" style="width: 10%;font-weight: 700;' + cssLable + '">' + th.text + ':</td>');
                    thsHtml.push('<td  class="noboder" style="text-align:left;' + cssText + '"  >' + th.value + '</td>');
                    if ((sum) % colNumTfooters == 0) {
                        tableForm.append("<tr>" + thsHtml.join("") + "</tr>");
                        thsHtml = [];
                    }
                }
                if (thsHtml.length > 0) {
                    for (var i = 0; i < colNumTfooters - (thsHtml.length / 2); i++) {
                        thsHtml.push('<td  class="noboder" style="width: 5%;word-break: keep-all;font-weight: 700;"></td>');
                        thsHtml.push('<td  class="noboder" style="text-align:left;"></td>');
                    }
                    tableForm.append("<tr>" + thsHtml.join("") + "</tr>");
                }
            }


        }

        if (param.afterInit) param.afterInit($("#grid"), $("#print-title"), $("#table-form-head"), $("#table-form-footer"));
        if (param.afterInitGlobal) param.afterInitGlobal($("#grid"), $("#print-title"), $("#table-form-head"), $("#table-form-footer"), $("body"));

        if (param.pageRowNum) $("#pageRowNum").val(param.pageRowNum);

        if (param.pageFixed) $("#pageFixed").val(param.pageFixed);
        
        
        if (param.pageSize) $("#pageSize").val(param.pageSize);

        //生成条形码
        var barcodeSettings = {
            btype: "code128", //ean8  ean13  std25  int25  code11  code39  code93  code128（一般商品扫描使用）  codabar  msi  datamatrix
            output: 'bmp', //渲染方式 css/bmp/svg/canvas
            barWidth: 1, //单条条码宽度
            barHeight: 50, //单体条码高度
            showHRI: true, //是否在条码下方显示内容
            addQuietZone: false //是否添加空白区（内边距）
        };

        var barWidth, barHeight;
        $("td[barcodeType=1]").each(function() {
                var td = $(this);
                if (td.attr("barWidth")) barWidth = parseInt(td.attr("barWidth"));
                if (td.attr("barHeight")) barHeight = parseInt(td.attr("barHeight"));
                barcodeSettings.barWidth = barWidth;
                barcodeSettings.barHeight = barHeight;
                var tdVal = td.html();
                td.html("");
                td.append('<div class="barcodeOutput"   >条形码显示区域</div>');
                td.append('<div class="barcodeInfo"  >' + tdVal + '</div>');
                td.children(".barcodeOutput").barcode(tdVal, barcodeSettings.btype, barcodeSettings);

            })
            //生成二维码
        $("td[barcodeType=2]").each(function() {
            var td = $(this);
            var tdVal = td.html(),
                barcodeStyle = td.attr("barcodeStyle");

            td.html("");
            td.append('<div class="codeOutput">二维码显示区域</div>');
            td.append(' <img class="codeOutputImg" style="' + barcodeStyle + '" />');

            var codeOutput = td.children(".codeOutput");
            var codeOutputImg = td.children(".codeOutputImg");

            codeOutput.qrcode({
                render: "canvas", //table方式
                width: 70, //宽度
                height: 70, //高度
                text: tdVal //任意内容
            });

            var canvas = codeOutput.children("canvas");
            var img = canvas[0].toDataURL("image/png");
            codeOutputImg.prop("src", img);
            codeOutput.hide();
            codeOutputImg.show();
        })

        //直接打印 printNow
        if (param.printNow && param.printNow == true) formTool_edit.op('print', false);

    }

    formTool_edit.printTableId = "print-table";

    var pageRowNumInp = $("#pageRowNum");
    $(function() {
        /**
        	type 		 
        	isPrintView	 true:预览
        	isByLodop	 通过Lodop客户端
        */
        formTool_edit.op = function(type, isPrintView, isByLodop) {

            if (type == "print") { //打印
                PageSetup_Null();
                if (myBrowser() == "IE" && !isByLodop) $(".print-table").addClass("print-table-ie");
                //打印前，重置显示
                $(".print-table[id!='print-table']").remove();

                //删除合计列
                $("#grid tr").not(".datahead,.datarow").remove();
                //清除合计行
                if ($("#grid tbody>td").length != 0){
                    $("#grid tbody td:last").remove();
                }
                $(".page").remove();
                $("#print-table").show();

                //根据每页数量，拆分表格
                var tableFormHead = $("#table-form-head").clone();
                var tableFormFooter = $("#table-form-footer");
                var tableFormDtl = $("#table-form-dtl").clone();
                var dtlNum = $("#table-form-dtl .table-info tr").length - 1;
                var pageRowNum = parseInt(pageRowNumInp.val());
                if (pageRowNum != -1 && dtlNum > pageRowNum) {
                    var pageSize = Math.ceil(dtlNum / pageRowNum);
                    var pageFixed = $("#pageFixed").val();
                    var tableFormDtlNew;
                    var printTableFirst = $(".print-table:first").clone(),
                        printTableNew, datarowsnew;
                    for (var i = 0; i < pageSize; i++) {
                        printTableNew = printTableFirst.clone();
                        if (i == 0) { //第一个表格，保留最大数目
                            printTableNew.find(".datarow").slice(pageRowNum).remove();
                        } else { //2-n动态计算
                            //删掉之后的
                            printTableNew.find(".datarow").slice((pageRowNum * (i + 1))).remove();
                            //删掉之前的
                            printTableNew.find(".datarow").slice(0, pageRowNum * i).remove();
                        }
                        printTableNew.attr("id", "");

                        //尾部放到最后一页
                        if (pageFixed == "pf2" && i != pageSize - 1) {
                            printTableNew.find("#table-form-footer").remove();
                        }


                        //追加每页的汇总行
                        try {
                           if (paramG.sumTableFun) {
                               // $("#grid tbody td:last").remove();
                               var trHtml = paramG.sumTableFun(printTableNew);
                                printTableNew.find("#grid").find("tr:last").after(trHtml);
                            } else if(paramG.sumTableFunGlobal){
                                var trHtml = paramG.sumTableFunGlobal(printTableNew);
                                printTableNew.find("#grid").find("tr:last").after(trHtml);
                            }
                        } catch (e) {
                            console.log("paramG.sumTableFun.error");
                            console.log(e);
                        }

                        //页数显示
                        try {
                            printTableNew.find(".spanpage").html((i + 1) + "/" + pageSize);
                        } catch (e) {

                        }


                        $("#tableBox").append(printTableNew);


                        $("#tableBox").append('<div class="page" style="page-break-after: always;"></div>');
                    }
                    $(".print-table:first").hide();
                } else { //只有一页
                    //追加每页的汇总行
                    try {
                    	 if (paramG.sumTableFun) {
                             var trHtml = paramG.sumTableFun($(".print-table:first"));
                            $(".print-table:first").find("#grid").find("tr:last").after(trHtml);

                         } else if(paramG.sumTableFunGlobal){
                              var trHtml = paramG.sumTableFunGlobal($(".print-table:first"));
                            $(".print-table:first").find("#grid").find("tr:last").after(trHtml);
                         }
                    } catch (e) {
                        console.log("paramG.sumTableFun.error");
                        console.log(e);
                    }

                    //页数显示
                    try {
                        $(".print-table:first").find(".spanpage").html((1) + "/1");
                    } catch (e) {}
                }

                //将网格中的input内容取出来放到html中
                $(".table-info").each(function() {
                    var table = $(this);
                    table.find("td").each(function() {
                        var td = $(this);
                        var inp = td.children("input");
                        if (inp.length <= 0) return true;
                        var inpVal = inp.val();
                        td.html(inpVal);
                    })

                })
 

                tableBox.jqprint({
                    debug: false, //如果是true则可以显示iframe查看效果
                    //（iframe默认高和宽都很小，可以再源码中调大），默认是false
                    importCSS: true, //true表示引进原来的页面的css，默认是true。
                    //（如果是true，先会找$("link[media=print]")，若没有会去找$("link")中的css文件）
                    printContainer: true, //表示如果原来选择的对象必须被纳入打印
                    //（注意：设置为false可能会打破你的CSS规则）。
                    operaSupport: true //表示如果插件也必须支持歌opera浏览器，在这种情况下，
                        //它提供了建立一个临时的打印选项卡。默认是true
                });

                if (myBrowser() == "IE") $(".print-table").removeClass("print-table-ie");

                //打印完，重置显示
                $(".print-table[id!='print-table']").remove();
                $(".page").remove();
                $("#print-table").show();
            }
        };

    })

 
</script>

</html>