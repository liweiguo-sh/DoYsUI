<!DOCTYPE html />
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>JSON解析工具</title>
    <link href="../../../../res_plugin/bootstrap4.0/my_bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <script src="../../../../res_plugin/bootstrap4.0/my_bootstrap/jquery-3.2.1.slim.min.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/bootstrap4.0/my_bootstrap/popper.min.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/bootstrap4.0/my_bootstrap/bootstrap.min.js" type="text/javascript"></script>
    <link href="../../../../res/control/tree/style2/xwf.tree.css" rel="stylesheet" />

    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
    <script src="../../../../res/control/tree/xwf.tree.js"></script>

    <style type="text/css">
        #divTree {
            width: 100%;
            border: solid 1px #DFDFDF;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container-fluid" style="width: 1200px;">
        <br />
        <h4>JSON解析器</h4>
        <div class="card card-primary">
            <div class="card-header bg-primary text-white">测试区</div>
            <div class="card-body">
                <div class="row" id="divRow1">
                    <div class="col-sm-12">
                        <textarea class="form-control" id="txtJSON" rows="12" placeholder="请输入JSON 字符串"></textarea>
                        <br />
                    </div>
                    <div class="col-sm-6 text-center">                        
                        <a href="#" id="btnParse1" class="btn btn-primary" style="width: 200px;" onclick="btnParse_click(1);">解析 (JSON.parse)</a>                        
                    </div>
                    <div class="col-sm-6 text-center">                        
                        <a href="#" id="btnParse2" class="btn btn-primary" style="width: 200px;" onclick="btnParse_click(2);">解析 (eval)</a>                        
                    </div>
                    <div class="col-sm-12">
                        <br />
                        <div id="divTree"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
    var txtJSON = gId("txtJSON");
    var divTree = gId("divTree");

    var parseMode = 1;
    var rootKey = "";
    var tree = null;
    // ------------------------------------------------------------------------
    function formLoad() {
    }
</script>
<!-- 页面控件处理 -->
<script type="text/javascript">
    function btnParse_click(mode) {
        parseMode = mode;
        initTree();

        if (txtJSON.value.equals("")) {
            txtJSON.value = "{\"name\":\"王老吉\", \"age\":\"24\", \"post\":[{\"zip\": \"200002\", \"address\": \"南京东路1234号\" }, {\"zip\": \"250011\", \"address\": \"大明湖畔清风亭\"}]}";
        }
        parseJson(tree.nodes[rootKey], txtJSON.value);

        tree.expand(rootKey);
    }

    function initTree() {
        var rootNodeKey = "";
        var jsonPara = {
            divContainer: gId("divTree"),
            imgPath: "../../../../res/control/tree/" + top.cssStyle + "/",
            title: "JSON OBJECT TREE",
            nodeClick: nodeClick,
            sd: "~"
        };
        tree = new window.xwf_tree(jsonPara);

        rootKey = "0" + tree.sd + "0";
        tree.addNode({ key: rootKey, text: "根节点", jsonString: txtJSON.value });
    }
</script>

<!-- parseJson -->
<script type="text/javascript">    
    function parseJson(nodeParent, jsonParent) {
        var nodeKey = "", jsonString = "";
        var joParent, jo;

        try {
            if (parseMode == 1) {
                joParent = JSON.parse(jsonParent);
            }
            else {
                eval("var joParent = " + jsonParent);
            }

            for (var key in joParent) {
                nodeKey = nodeParent.key + tree.sd + key;
                jo = joParent[key];

                if (typeof (jo) == "string") {
                    if (jo.substring(0, 1).equals("{")) {
                        tree.addNode({ key: nodeKey, text: key, jsonString: jo });
                        parseJson(tree.nodes[nodeKey], jo);
                    }
                    else {
                        tree.addNode({ key: nodeKey, text: key + " : " + jo });
                    }
                }
                else if (typeof (jo) == "object") {
                    jsonString = JSON.stringify(jo);
                    tree.addNode({ key: nodeKey, text: key, jsonString: jsonString });
                    parseJson(tree.nodes[nodeKey], jsonString);
                }
                else if (typeof (jo) == "number") {
                    tree.addNode({ key: nodeKey, text: key + " : " + jo });
                }
                else {
                    tree.addNode({ key: nodeKey, text: key + " : " + jo });
                }
            }
        }
        catch (e) {
            alert(e.toString());
        }
    }

    function nodeClick(node) {
        if (node.jsonString) {
            txtJSON.value = node.jsonString;
        }
    }
</script>