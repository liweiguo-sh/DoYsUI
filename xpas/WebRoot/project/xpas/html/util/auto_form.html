<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>界面窗口</title>
	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
    <script src="../../../../res/control/tab/xwf.tab.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
	<style type="text/css">
		body {
			font-family: 微软雅黑;
			padding:10px;
		}
		.tbLayout {
			table-layout: fixed;
			border-collapse: collapse;
		}
		.tdLayout {
			padding: 0px;
			overflow: hidden;
			border: dashed 0px #c0c0c0;
		}
		#divFields,#divTable
		{
		    background-color:ghostwhite;
		    border:1px solid lightgray;
		    border-radius:5px;
		    padding:10px;
		    height:850px;
		    overflow:auto;
		    vertical-align:top;   
		}
		#divTab
		{
		    margin:10px;
		    background-color:ghostwhite;
		    border:1px solid lightgray;
		    border-radius:5px;
		    padding:10px;
		    height:820px; 
		    --width:1500px;
		}
		
		#divFields div{
			width: 450px;
			padding:2px;
			border:1px solid grey;
			margin-top:5px;
			border-radius:5px;
			color:black;
			line-height:30px;
		}
		
		.BaseFields
		{
		    background-color:lightgreen;
		}
		.ViewFields
		{
		    background-color:lightblue;
		}
		div textarea
		{
		    width:95%;
		    margin:10px;
		    height:95%;   
		}
		#divCols label
		{
		    margin-right:20px;
		}
		#selectView
		{   
		    width:490px;
		    border-radius:5px;
		    padding:5px;
		    font-family:Courier New;
			font-size:18px;
		    border:1px solid lightgray;
		}
		#taSource
		{
		    width:98%;
		       
		}
	</style>
	<!-- 主布局表 -->
	<style type="text/css">
		.tbMain {
			table-layout: fixed;
			border-collapse: collapse;
			margin-top:5px;
		}
		
		.tbForm td {
			padding: 6px;
			overflow: hidden;
			border: solid 1px lightgrey;
			font-family:Courier New;
			font-size:18px;
		}
		.tbForm th {
			padding: 6px;
			overflow: hidden;
			border: solid 1px lightgrey;
			font-family:Courier New;
			font-size:18px;
			font-weight:bolder;
		}
		
		.tbColumns span:hover {
			color: red;
		}
		
	</style>
</head>
<body>
    <div id="divTab" class="xwf_tab_divContainer">
        <div id="divDesign" style="overflow:hidden;width:100%">
            <table id="tbLayout1" class="tbLayout" style="width:100%;">
		        <tr>
			        <th style="width:500px;"></th>
			        <th style="width:auto;"></th>
		        </tr>
                <tr>
                    <td>
                        <input type="text" id="selectView" />
                    </td>
                    <td><div id="divCols">
               
                        <fieldset style="border:0px;">
                            <input type="radio" name="raCols" id ="radio1" onclick="changeLayout(1)"/><label for="radio1">单列</label>
                            <input type="radio" name="raCols" checked="checked" id ="radio2" onclick="changeLayout(2)"/><label for="radio2">双列</label>
                            <input type="radio" name="raCols" id ="radio3" onclick="changeLayout(3)"/><label for="radio3">三列</label>
                            <input type="radio" name="raCols" id ="radio4" onclick="changeLayout(4)"/><label for="radio4">四列</label>
                        </fieldset>
                    </div></td>
                </tr>
		        <tr>
			        <td><div id="divFields"></div></td>
			        <td style="vertical-align:top;">
                        <div id="divTable"><table id="tbForm" class="tbForm" style="width: 960px;"></table></div>  
                    </td>
		        </tr>
        
	        </table>
        </div>
                    
        <div id="divSource" style="width: 100%;" >
            <div id="divCodeSetting" style="padding:10px;" class="divButtons">
                <input type="radio" id="radioPart" name="buildMode" onclick="createHTML(0)" /><label for="radioPart">Table HTML</label>
                <input type="radio" id="radioAll" name="buildMode" checked="checked" onclick="createHTML(1)" /><label for="radioAll">File HTML</label>

                <input type="text" id="fileName" style="width:700px;margin-left:20px;margin-right:10px;"/><input type="button" value="保存文件" onclick="saveFile()" />
            </div>
            <textarea id="taSource" rows="30" cols="10"></textarea>
        </div>
    </div>
	

</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
    var tbForm = gId("tbForm");
    var tabs = null;
    var projectPath = "";
    var formSavePath ="";
    //拖放的起始元素
    var srcEl = null;
    //上一个放置的TD
    var preTd = null;
    var dtbView = null;
    var dtbViewField = null;
    var tbRows = 0;
    var cols = 2;
    // ----------------------------------------------------
    function formLoad() {
        initConfig();
        cssFormat(gId("tbLayout1"));
    }

    function btnClose_click() {
        win.close();
    }
    function btnCreate_click() {

        getTableHtml();
    }
    
</script>
<!-- 初始化界面 -->
<script type="text/javascript">

    // ----------------------------------------------------
    function initConfig() {
        gId("divTab").style.height = (win.p.maxHeight - 50) + "px";
        gId("divFields").style.height = (win.p.maxHeight - 120) + "px";
        gId("divTable").style.height = (win.p.maxHeight - 120) + "px";
        gId("taSource").style.height = (win.p.maxHeight - 120) + "px";

        tabs = new window.xwf_tab({ divContainer: gId("divTab"), tabClick: tab_click });
        tabs.addTab({ key: "Design", text: "设计", control: gId("divDesign") });
        tabs.addTab({ key: "Source", text: "HTML代码", control: gId("divSource") });


        if (g.a.send("processType=com.xznext.util.AutoForm&actionType=GetViewList", {}, true)) {

            if (g.a.OK) {
                dtbView = g.a.cReturn.dtbView;
                projectPath = g.a.cReturn.projectPath;
                
                var jsonProp = {
                    dtb: dtbView,
                    colCount: 2,
                    valueField: "view_key",
                    textField: "view_name",
                    searchField: "view_key,view_name",
                    itemSelect: onSelectView
                };
                topWin.dropgrid.bindTextbox(gId("selectView"), jsonProp);
            }
        }

    }
    function tab_click(tab) {

        if (tab.key == "Design") {

        }
        else if (tab.key == "Source") {
            createHTML(gId("radioAll").checked);
        }
        return true;
    }
    function onSelectView(drRow) {
        if (g.a.send("processType=com.xznext.util.AutoForm&actionType=GetViewFields", { viewKey: drRow["view_key"].value }, true)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;

                dtbViewField = cReturn.dtbViewField;
                dtbViewField.sort("table_name DESC");
                formSavePath = projectPath + drRow["system_name"].value + "\\html\\subfolder\\" + drRow["view_key"].value + ".html";
                gId("fileName").value = formSavePath;
                initHtml();
            }
            else {
                return false;
            }
        }
        else {
            return false;
        }
    }
    function changeLayout(c) {
        cols = c;
        if (gId("selectView").value != "") {
            initHtml();
        }
    }
    function initHtml() {
        var iRow = 0;
        var arrHtml = new Array();
        var className = "";
        // ---初始化变量---------------------------------------------
        preTd = null;
        srcEl = null;
        tbRows = 1;
        //-------------------------
        for (iRow = 0; iRow < dtbViewField.rowCount; iRow++) {

            var fieldName = firstUpper(dtbViewField.rows[iRow]["field_name"].value);
            var fieldText = dtbViewField.rows[iRow]["field_text"].value;
            if (dtbViewField.rows[iRow]["table_name"].value.equals("")) {
                className = "ViewFields";
            } else {
                className = "BaseFields";
            }
            var dataType = dtbViewField.rows[iRow]["field_type"].value;
            var selectSrc = dtbViewField.rows[iRow]["field_query_source"].value;
            var fieldLength = dtbViewField.rows[iRow]["field_length"].value;
            var fieldType = className.equals("BaseFields") ? "_c" : "_g";
            var fieldStr = "<div class='" + className + "'";
            fieldStr+=" fieldName='" + fieldName +"'" ;
            fieldStr+=" title='" + fieldText + "'";
            fieldStr+=" dataType='" + dataType + "'";
            fieldStr+=" selectSrc='" + selectSrc +"'";
            fieldStr += " fieldLength='" + fieldLength + "'";
            fieldStr += " outHidden = '0'";
            fieldStr+=" draggable='true' ondragstart='dragstart(event)' ondblclick='autoPutField(this)'>";

            fieldStr += "<span>" + fieldName +"<"+fieldText+ "></span>";
            fieldStr += "<input type='checkbox' style='float:right;margin-left:15px;margin-top:5px;' onchange='outHidden(this)'/>";
            fieldStr += "<span id='" + fieldType + fieldName + "_span' style='float:right;color:blue;cursor:pointer;display:none' onclick='removeField(this)'>移走</span>";

            fieldStr+="</div>";
            
            arrHtml.push(fieldStr);
        }

        gId("divFields").innerHTML = arrHtml.join("\n");

        // -----------------------------------------------

        tbForm.innerHTML = "";

        arrHtml = new Array();
        for (var iCol = 0; iCol < cols; iCol++) {
            arrHtml.push("<th style='width:150px;'>字段</th>");
            arrHtml.push("<th style='width:200px;'>控件类型</th>");
        }
        var node = document.createElement("tr");
        node.innerHTML = arrHtml.join("\n");
        tbForm.appendChild(node);

        arrHtml = new Array();
        node = document.createElement("tr");
        for (var iCol = 0; iCol < cols; iCol++) {
            arrHtml.push("<td role='label' fieldName='blank'>1</td>");
            arrHtml.push("<td role='data' fieldName='blank'  col='" + iCol + "' row='1' ondragover='dragover(event)' ondrop='drop(event)' onclick='changeCtl(this)'>1</td>");
        }

        node.innerHTML = arrHtml.join("\n");
        tbForm.appendChild(node);
        tbForm.style.width = ((win.p.width-600) *4/ 4) + "px";
    }
    function outHidden(chkbox) {
        var divField = chkbox.parentNode;
        if (chkbox.checked) {
            divField.setAttribute("outHidden", "1");
        } else {
            divField.setAttribute("outHidden", "0");
        }
        
    }
</script>

<!-- 字段拖放处理 -->
<script type="text/javascript">
    function dragstart(event) {
        srcEl = g.x.getEventTarget(event);

    }
    function dragover(event) {
        event.preventDefault();
    }
    function dropHidden(event) {//添加隐藏字段
        event.preventDefault();

        var fieldName = srcEl.getAttribute("fieldName");
        var fieldText = srcEl.getAttribute("title");
        var fieldType = srcEl.className.equals("BaseFields") ? "_c" : "_g";
        var ctlName = fieldType + fieldName;

        taSource.value = taSource.value + '\n' + '<input type="hidden" id="' + ctlName + '"/>'
    }
    function drop(event) {
        event.preventDefault();

        var targetEl = g.x.getEventTarget(event);
        putField(srcEl, targetEl);


    }
    function autoPutField(srcDiv) {
        //如果从未放置过，找到第一个可以的格子；否则找到上一个放置的格子后面的那个

        var findCell = null;


        if (preTd == null) {
            var tr = tbForm.firstChild; //标题行
            tr = getNextBro(tr); //第一行
            findCell = tr.firstChild;
            findCell = getNextBro(findCell);
        } else {
            findCell = getNextBro(preTd);
            while (findCell != null) {
                if (findCell.getAttribute("role").equals("data") && findCell.getAttribute("fieldName").equals("blank")) {
                    break;
                }
                findCell = getNextBro(findCell);
            }
            if (findCell == null) {//如果本行找不到，到下一行找
                var nextTr = getNextBro(preTd.parentNode); //下一行
                while (nextTr != null) {
                    findCell = nextTr.firstChild;
                    while (findCell != null) {
                        if (findCell.getAttribute("role").equals("data") && findCell.getAttribute("fieldName").equals("blank")) {
                            break;
                        }
                        findCell = getNextBro(findCell);
                    }
                    if (findCell != null) {
                        break;
                    }
                    nextTr = getNextBro(nextTr);
                }
            }
        }
        if (findCell == null) {
            showErr("无法自动分配位置!");
            return;
        }
        putField(srcDiv, findCell);
    }
    //双击字段，拖放字段执行下面代码
    function putField(fromEl, targetEl) {
        var preEl = getPreviousBro(targetEl);
        var fieldName = fromEl.getAttribute("fieldName");
        var fieldText = fromEl.getAttribute("title");
        var fieldType = fromEl.className.equals("BaseFields") ? "_c" : "_g";
        var dataType = fromEl.getAttribute("dataType");
        var selectSrc = fromEl.getAttribute("selectSrc");
        var fieldLength = fromEl.getAttribute("fieldLength");
        //看看格子里是否有控件,替换原来的字段

        var oldFieldName = targetEl.getAttribute("fieldName");
        if (oldFieldName != "blank") {
            removeField(gId(oldFieldName + "_span"));
        }
        //该字段有没有存在
        var tds = gId("tbForm").getElementsByTagName("td");
        for (var i = 0; i < tds.length; i++) {
            if (tds[i].getAttribute("fieldName").equals(fieldType + fieldName)) {
                var td = tds[i];
                td.setAttribute("fieldName", "blank");
                td.innerHTML = td.getAttribute("row");
                getPreviousBro(td).innerHTML = td.getAttribute("row");
                break;
            }
        }
        //更改格子信息
        if (fieldType.equals("_c")) {
            switch (dataType) {

                case "datetime":
                    targetEl.innerHTML = "wdate";
                    break;
                default:
                    if (parseInt(fieldLength) >= 100) {
                        targetEl.innerHTML = "textarea";
                    } else {
                        targetEl.innerHTML = "input";
                    }

                    break;
            }
            if (selectSrc.length > 0) {
                targetEl.innerHTML = "dropgrid";
            }
        } else {
            targetEl.innerHTML = "span";
        }
        targetEl.setAttribute("fieldName", fieldType + fieldName);
        preEl.innerHTML = fieldText;

        //若是最后一行就添加一行
        var row = targetEl.getAttribute("row");
        if (row == tbRows) {
            
            tbRows++;
            var node = document.createElement("tr");
            var arrHtml = new Array();
            for (var iCol = 0; iCol < cols; iCol++) {
                arrHtml.push("<td role='label' fieldName='blank'>" + tbRows + "</td>");
                arrHtml.push("<td role='data' fieldName='blank' col='" + iCol + "' row='" + tbRows + "' ondragover='dragover(event)' onclick='changeCtl(this)' ondrop='drop(event)'>" + tbRows + "</td>");
            }

            node.innerHTML = arrHtml.join("\n");
            tbForm.appendChild(node);
        }

        //做好标记
        gId(fieldType + fieldName+"_span").style.display="";

        preTd = targetEl;
    }
    function changeCtl(td) {
        switch (td.innerHTML) {
            case "span":
                td.innerHTML = "wdate";
                break;
            case "wdate":
                td.innerHTML = "select";
                break;
            case "select":
                td.innerHTML = "dropgrid";
                break;
            case "dropgrid":
                td.innerHTML = "input";
                break;
            case "input":
                td.innerHTML = "textarea";
                break;
            case "textarea":
                td.innerHTML = "span";
                break;

        }
    }
    function removeField(obj) {
        obj.style.display = "none";
        var node = obj.parentNode;
        var fieldName = node.getAttribute("fieldName");
        var fieldType = node.className.equals("BaseFields") ? "_c" : "_g";
        var tds = gId("tbForm").getElementsByTagName("td");
        for (var i = 0; i < tds.length; i++) {
            if (tds[i].getAttribute("fieldName").equals(fieldType + fieldName)) {
                var td = tds[i];
                td.setAttribute("fieldName", "blank");
                td.innerHTML = td.getAttribute("row");
                getPreviousBro(td).innerHTML = td.getAttribute("row");
                break;
            }
        }

    }
    //上一个兄弟
    function getPreviousBro(obj) {
        var tmp = obj.previousSibling;

        while (tmp != null) {

            if (tmp.nodeType === 1) {
                return tmp;
                break;
            }
            tmp = tmp.previousSibling;
        }
        return tmp;
    }
    //下一个兄弟
    function getNextBro(obj) {
        var tmp = obj.nextSibling;

        while (tmp != null) {

            if (tmp.nodeType === 1) {
                return tmp;
                break;
            }
            tmp = tmp.nextSibling;
        }
        return tmp;
    }

    function firstUpper(str) {
        return str.substring(0, 1).toUpperCase() + str.substring(1);
    }

    function getTableHtml() {


        var tbResult = gId("tbForm");

        //输出HTML
        var arrHtml = new Array();
        var twoTabs = "        ";
        arrHtml.push('<table id="tbForm" class="tbForm" style="width:810px;">');
        var trs = tbResult.getElementsByTagName("tr");
        for (var i = 0; i < trs.length; i++) {

            var tdsOftr = trs[i].getElementsByTagName("td");
            var thsOftr = trs[i].getElementsByTagName("th");
            var trNeedOut = false;
            var arrTr = new Array();
            if (thsOftr.length > 0) {//th行
                arrTr.push('    <tr id="trH">');//每行的第一个行不加两个tabs，后面循环一起加。
                for (var j = 0; j < thsOftr.length; j++) {
                    var colWidth = 0;
                    if (j % 2 == 0) {
                        colWidth = 150;
                    } else {
                        colWidth = 250;
                    }
                    arrTr.push(twoTabs+'        <th style="width: ' + colWidth + 'px;"></th>');
                }
                arrTr.push(twoTabs + '    </tr>');
                trNeedOut = true;
            } else {
                arrTr.push('    <tr>');
                for (var j = 0; j < tdsOftr.length; j++) {
                    var role = tdsOftr[j].getAttribute("role");
                    var fieldName = tdsOftr[j].getAttribute("fieldName");
                    if (role.equals("data") && fieldName != "blank") {
                        //只要有非空字段就输出该行
                        trNeedOut = true;

                        //输出标签行
                        arrTr.push(twoTabs + '        <td>' + getPreviousBro(tdsOftr[j]).innerHTML + '</td>');

                        //将后面空的格子合并到前面，产生strColSpan字符串，准备拼接
                        var colSpan = 1;
                        var findCell = getNextBro(tdsOftr[j]); //先向后找
                        while (findCell != null) {
                            if (findCell.getAttribute("role").equals("data") && findCell.getAttribute("fieldName").equals("blank")) {
                                colSpan += 2;
                            } else if (findCell.getAttribute("role").equals("data") && !findCell.getAttribute("fieldName").equals("blank")) {
                                break;
                            }
                            findCell = getNextBro(findCell);
                        }

                        var findCell = getPreviousBro(tdsOftr[j]); //向前找，如果直接到NULL，也全并上
                        var backCols = 0;
                        var hasField = false;
                        while (findCell != null) {
                            if (findCell.getAttribute("role").equals("data") && findCell.getAttribute("fieldName").equals("blank")) {
                                backCols += 2;
                            } else if (findCell.getAttribute("role").equals("data") && !findCell.getAttribute("fieldName").equals("blank")) {
                                hasField = true;
                                break;
                            }
                            findCell = getPreviousBro(findCell);
                        }
                        if (!hasField) {
                            colSpan += backCols;
                        }
                        var strColSpan = "";
                        if (colSpan > 1) {
                            strColSpan = ' colspan="' + colSpan + '"';
                        }


                        //根据不同的控件类型产生
                        var ctlType = tdsOftr[j].innerHTML;
                        var tdHtml = "";
                        switch (ctlType) {
                            case "span":
                                tdHtml = '<span id="' + fieldName + '"></span>';
                                break;
                            case "wdate":
                                tdHtml = '<input type="text" id="' + fieldName + '" class="Wdate" onclick="WdatePicker()" />';
                                break;
                            case "select":
                                tdHtml = '<select id="' + fieldName + '"></select>';
                                break;
                            case "dropgrid":
                                tdHtml = '<input type="text" id="' + fieldName + '" colcount="1" valuefield="替换" textfield="替换" searchfield="替换" />';
                                break;
                            case "textarea":
                                tdHtml = '<textarea id="' + fieldName + '" rows="5"></textarea>';
                                break;
                            case "checkbox":
                                tdHtml = '<input type="checkbox" id="' + fieldName + '" />';
                                break;
                            default:
                                tdHtml = '<input type="text" id="' + fieldName + '" />';
                                break;
                        }

                        arrTr.push(twoTabs + '        <td' + strColSpan + '>' + tdHtml + '</td>');
                    }


                }
                arrTr.push(twoTabs + '    </tr>');
            }

            if (trNeedOut) {
                arrHtml.push(arrTr.join("\n"));
            }


        }
        arrHtml.push('</table>');
        //追加隐藏字段
        var divFields = gId("divFields").getElementsByTagName("div");
        for (var i = 0; i < divFields.length; i++) {
            if (divFields[i].getAttribute("outHidden").equals("1")) {
                var fieldName = divFields[i].getAttribute("fieldName");
                var fieldType = divFields[i].className.equals("BaseFields") ? "_c" : "_g";
                arrHtml.push('<input type="hidden" id="' + fieldType + fieldName + '"/>');
            }
        }
        //加上两个Tabs
        for (var i = 0; i < arrHtml.length; i++) {
            arrHtml[i] = twoTabs + arrHtml[i];
        }
        return arrHtml.join("\n");

        

    }

    function createHTML(allMode) {
        if (allMode) {
            gId("taSource").value = getBeforeHtml()+getTableHtml()+getAfterHtml();
        } else {
            gId("taSource").value = getTableHtml();
        }
    }
    function getBeforeHtml() {
        var arrHtml = new Array();
        arrHtml.push('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">');
        arrHtml.push('<html xmlns="http://www.w3.org/1999/xhtml">');
        arrHtml.push('<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />');
        arrHtml.push('<head>');
	    arrHtml.push('    <title id="title"></title>');
	    arrHtml.push('    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script\>');
	    arrHtml.push('    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script\>');
	    arrHtml.push('    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"><\/script\>');
	    arrHtml.push('    <script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script\>');
	    arrHtml.push('    <script src="../../../../res/control/uvform/xwf.uvform.js" type="text/javascript"></script\>');
	    arrHtml.push('    <script src="../../../../res/control/My97DatePicker/WdatePicker.js" type="text/javascript"></script\>');
	    arrHtml.push('    <script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script\>');
        arrHtml.push('</head>');
        arrHtml.push('<body>');
	    arrHtml.push('    <div id="divDC"></div>');
	    arrHtml.push('    <form id="frm" action="" target="">'+'\n');
        return arrHtml.join("\n");
    }
    function getAfterHtml() {
        var arrHtml = new Array();
        arrHtml.push('\n'+'    </form>');
        arrHtml.push('</body>');
        arrHtml.push('</html>');
        arrHtml.push('<!-- formLoad -->');
        arrHtml.push('<script type="text/javascript">');
	    arrHtml.push('    function formLoad() {');
		arrHtml.push('        vf.css(gId("tbForm"));');
	    arrHtml.push('    }');
        arrHtml.push('</script\>');

        return arrHtml.join("\n");
    }
    function saveFile() {
        var fileName = gId("fileName").value;
        var fso = null;
        var fileSave = null;

        try {
            fso = new ActiveXObject("Scripting.FileSystemObject");
        } catch (e) {
            showErr("文件系统对象创建失败！请检查IE配置！"+e.toString());
            return;
        }
        if (fso.FileExists(fileName)) {
            showErr("亲，文件已经存在了，稳妥起见，您还是拷贝一下吧！");
            return;
        }

        try {
            fileSave = fso.CreateTextFile(fileName, false,true);
        } catch (e) {
            showErr("文件创建失败！请检查路径是否符合规范及是否有文件操作权限！"+e.ToString());
            return;
        }
        fileSave.WriteLine(gId("taSource").value);
        fileSave.Close();
        showMsg("文件保存完毕，请在VS里刷新目录添加！");
    }
</script>
