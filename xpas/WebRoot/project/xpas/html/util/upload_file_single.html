<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>可独立运行的文件上传窗口</title>
	<style type="text/css">
		table {
			table-layout: fixed;
			border-collapse: collapse;
			margin: 10px 10px 20px 0px;
		}
		table td {
			padding: 0px;
		}
		input[type='file'] {
			width: 300px;
			height: 24px;
		}
	</style>
</head>
<body>
	<div id="divButtons" class="divButtons">
		<input type="button" id="btnUpload" value="上传" onclick="btnUpload_click();" />
		<input type="button" id="btnClose" value="关闭" onclick="btnClose_click();" />
	</div>
	<form id="frmUpload" name="frmUpload" method="post" action="" enctype="multipart/form-data" target="ifrCallback">
		<table>
			<tr>
				<td><input type="file" id="file1" name="file1" onchange="btnUpload_click()" /></td>
			</tr>
			<tr>
				<td><img id="img1" /></td>
			</tr>
		</table>		
	</form>
	<iframe src="about:blank" id="ifrCallback" name="ifrCallback" width="0" height="0" style="display:none;"></iframe>
</body>
</html>

<!-- upload file -->
<script type="text/javascript">
	var returnStr = "";
	var urlServer = "http://127.0.0.1:7000";

	function btnUpload_click() {
		var originalName = window.document.getElementById("file1").value;
		frmUpload.action = urlServer + "/xpas/filter.do?processType=example.training1.UploadFile&originalName=" + originalName + "&fileName=abc&ie=11";
		frmUpload.submit();
	}

	function callback(returnString) {
		var jsonReturn = {};
		var arrReturn = returnString.split("\1");
		if (arrReturn[0] == "OK") {
			fileUrl = arrReturn[1];
			filePath = arrReturn[2];
			fileName = arrReturn[3];

			window.document.getElementById("img1").src = urlServer + fileUrl + "?rnd=" + Math.random();
		}
		else {
			alert(arrReturn[1]);
		}
	}
</script>
