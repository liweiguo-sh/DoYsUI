<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<!-- 发货单 打印单据 -->
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
   <link href="../../../../res_plugin/zui-1.8.1-dist/css/zui.css" rel="stylesheet" type="text/css" />
</head>
<body id="body-uview">
<div class="container-fluid container-fluid-main scrollbar-hover" id="container-uview-edit">
	<div class="row" style="padding-left: 27px; padding-bottom: 10px;">
		<div class="col-xs-12">
				<div class="btn-toolbar btn-toolbar-my">
				  <div class="btn-group">
				  	<button type="button" class="btn btn-primary" onclick="formTool_edit.op('print');" title="打印" style="margin-left: 5px;">打印（浏览器）</button>
				  	<!-- <button type="button" class="btn btn-primary" onclick="formTool_edit.op('print',true);" title="预览"  style="margin-left: 5px;" >预览</button> -->
				  	<button  type="button" class="btn"  onclick="win.close();" title="关闭当前窗口"  style="margin-left: 5px;">关闭</button>
				  </div>
			 </div>
		</div>
		<div class="row" style="padding-left: 27px; padding-bottom: 10px;">
			<div class="col-xs-12" id="printInfoBoxId">
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-5">
			<div  id="tableBox" class="container-fluid">
				 <style type="text/css"  id="stylePrint">
				 	.noboder{
				 		border:0px   !important;
				 	}
				 	.print-table-1{
				 		margin-top:10px  !important;
				 		padding-top:0px  !important;
				 	}
				 	.print-table{
				 		margin-top: 40px;
				 		border: 1px dotted;
				 		width: 400px;
				 		background-color: rgb(255, 255, 255);
				 		padding-top:12px;
				 		box-sizing: border-box; 
	   					font-family:microsoft yahei;
					    font-weight: 700;
					    font-size: 13px;
					    overflow: hidden;
					    height: 212px;
				 	}
				 	.print-table>div{
				 		padding-left:10px;
				 	}
				 	.label,.text{
				 		margin:0px;
				 		padding:0px;
				 		display: inline;
				 		font-size: 14px;
				 		line-height: 16px;
				 	}
				 	.label{
				 		width:100px;
				 		text-align: right; 
				 		padding-left: 20px;
				 	}
				 	.text{
				 		text-align: left; 
				 		padding-left: 10px;
				 	}
				 	.codeOutput{
				 		       padding-top: 7px !important;
				 		       text-align:center;
	   							 width:100%  !important;
				 	}
				 	
				 	.codeOutput div{
						height:65px !important;
					}
				 	.codeOutput object{
						height: 70px;
					}
				 	.codeOutput div:LAST-CHILD {
						font-size: 12px !important;
						height:auto !important;
						    text-align: left  !important;
					}
					
					.codeOutputinfo{
					text-align: center;
	    			letter-spacing: 0.5px;
					}
					
					#tableBox{
						width: 400px;
	   					    padding: 0px;
	   					     font-weight: bold;
	   					 margin-left:0px;
					}
					#tableBox .bluerow{
						    border: 1px solid blue;
					}
					
					.printbox{
						    padding: 5px 20px;
					            width: 350px;
    					margin: auto auto;
					}
					
					.printlabel,.printtext{
						padding: 2px 0px 0px 0px !important;
   						 margin: 0px;
				     line-height: 1 !important;
				      overflow: hidden; 
					    text-overflow:ellipsis; 
					    white-space: nowrap; 
					}
					
					
					 
	 			</style>
							
			</div>
		</div>
		<div  class="col-xs-1 text-center"></div>
		<div class="col-xs-2 text-center">
			<div class="row">
				<div class="col-xs-12">
					浏览器设置
				</div>
				<div class="col-xs-12">
					<img alt="" src="../../images/print_1.png">
				</div>
			</div>
			
		</div>
		<div class="col-xs-2 text-center">
			<div class="row">
				<div class="col-xs-12">
					打印机设置
				</div>
				<div class="col-xs-12">
					<img alt="" src="../../images/print_2.png">
				</div>
			</div>
			
		</div>
		<div class="col-xs-2 text-center">
			<div class="row">
				<div class="col-xs-12">
					打印效果
				</div>
				<div class="col-xs-12">
					<img alt="" src="../../images/print_3.png">
				</div>
			</div>
		</div>
	</div>
</div>
</body>
 <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
  <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
  <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
<script src="../../../../res_plugin/jquery/jquery-1.11.3.min.js"></script>
<script src="../../../../res_plugin/jquery/jquery-migrate-1.2.1.js" title="jQuery migrate插件解决迁移兼容问题"></script>
<script src="../../../../res_plugin/jquery/jquery-barcode.min.js" title="条形码"></script>
<script src="../../../../res_plugin/jquery/jquery.jqprint-0.3.js" title="打印插件"></script>
 <script src="../../../../res/jscript/web_print.js" type="text/javascript"></script>


<script>
$.fn.numeral=function(bl){//限制金额输入、兼容浏览器、屏蔽粘贴拖拽等
      $(this).keypress(function(e){
          var keyCode=e.keyCode?e.keyCode:e.which;
        if(bl){//浮点数
          if((this.value.length==0 || this.value.indexOf(".")!=-1) && keyCode==46) return false;
          return keyCode>=48&&keyCode<=57||keyCode==46||keyCode==8;
        }else{//整数
          return  keyCode>=48&&keyCode<=57||keyCode==8;
        }
      });
      $(this).bind("copy cut paste", function (e) { // 通过空格连续添加复制、剪切、粘贴事件
          if (window.clipboardData)//clipboardData.setData('text', clipboardData.getData('text').replace(/\D/g, ''));
              return !clipboardData.getData('text').match(/\D/);
          else
              event.preventDefault();
       });
      $(this).bind("dragenter",function(){return false;});
      $(this).css("ime-mode","disabled");
      $(this).bind("focus", function() {  
        if (this.value.lastIndexOf(".") == (this.value.length - 1)) {  
            this.value = this.value.substr(0, this.value.length - 1);
        } else if (isNaN(this.value)) {  
            this.value = "";  
        }  
    });  
}
var numInp=$("#num");
$("#num").numeral(false);//限制只能输入整数 
var formTool_edit={},codeOutputbox=$("#codeOutputbox"),codeInput=$("#codeInput"),tableBox=$("#tableBox");
window.init=function(rows,param){
	var row,list=param.list,ob,isYMD;
	for(var i=0;i<rows.length;i++){
		row=rows[i];
		var rowsHtml=[]
		
		
		rowsHtml.push('		<div class="row bluerow printbox" > ');
		for(var j=0;j<list.length;j++){
			ob=list[j];
			isYMD=ob.isYMD;
			rowsHtml.push('			<div col="'+ob.lableCol+'" class="printlabel col-xs-'+ob.lableCol+'" > '+ob.text);
			rowsHtml.push('			</div> ');
			var value="";
			
			if(isYMD){
				value=WebPrint.dateFormat(row[ob.name].value,"ymd");
			}else{
				value=WebPrint.getObjStr(row[ob.name]?row[ob.name].value:"");
			}
			if(value.length<1) value=" 无 ";
			rowsHtml.push('			<div col="'+ob.valueCol+'" class="printtext col-xs-'+ob.valueCol+'" > '+value);
			rowsHtml.push('			</div> ');
		
		}
		
		//条形码
		var barcode=row[param.snFieldName].value;
		rowsHtml.push('			<div class="col-xs-12 codeOutput" > ');
		rowsHtml.push('			</div> ');
		rowsHtml.push('			<div class="col-xs-12 codeOutputinfo" > '+barcode);
		rowsHtml.push('			</div> ');
		
		//强制换页
		rowsHtml.push('			<div class="page" style="page-break-after: always;"></div>');
		rowsHtml.push('		</div> ');
		tableBox.append(rowsHtml.join(""));
		var codeOutputLast=tableBox.find('.codeOutput:last');
		codeOutputLast.html("").barcode(barcode, barcodeSettings.btype, barcodeSettings);
	}
	tableBox.find(".page:last").remove();
}
			          
//条形码配置
var barcodeSettings = {
	 btype: "code128",      //ean8  ean13  std25  int25  code11  code39  code93  code128（一般商品扫描使用）  codabar  msi  datamatrix
     output: 'bmp',       //渲染方式 css/bmp/svg/canvas
     //bgColor: '#ff0000', //条码背景颜色
     //color: '#00ff00',   //条码颜色
     barWidth: 1,        //单条条码宽度
     barHeight: 50,     //单体条码高度
     //moduleSize: 10,   //条码大小
     // posX: 10,        //条码坐标X
     // posY: 5,         //条码坐标Y
     showHRI: true,    //是否在条码下方显示内容
     addQuietZone: false  //是否添加空白区（内边距）
};
formTool_edit.printTableId="print-table";

$(function(){
	 
	
	/**
		相关操作
		type 		 
		btn			操作的按钮（jq对象）
		rowIndex	删改所操作的行索引
	*/
	formTool_edit.op=function(type,isByLodop){
		if (type=="print") { //打印
	    	//去掉table border
	    	$("#tableBox .row").removeClass("bluerow");
	    	if(isByLodop){
				lodopPrint();
				$("#tableBox .row").addClass("bluerow");
				return ;
			}
	    	 
	    	tableBox.jqprint({
	    		 debug:false, //如果是true则可以显示iframe查看效果
	    	     //（iframe默认高和宽都很小，可以再源码中调大），默认是false
	    	     importCSS: true, //true表示引进原来的页面的css，默认是true。
	    	     //（如果是true，先会找$("link[media=print]")，若没有会去找$("link")中的css文件）
	    	     printContainer: true, //表示如果原来选择的对象必须被纳入打印
	    	     //（注意：设置为false可能会打破你的CSS规则）。
	    	     operaSupport: true//表示如果插件也必须支持歌opera浏览器，在这种情况下，
	    	     //它提供了建立一个临时的打印选项卡。默认是true
	    	});
	    	//添加table border
	    	$("#tableBox .row").addClass("bluerow");
	    }else if (type=="reset") { //重置
	    	tableBox.children(".print-table").remove();
	    }else if (type=="close") { //关闭设计弹窗
	    	xpasModal.confirm.setOkFun(function(param){
	    		formUtil_UV.winModalUviewEdit.close();
			},{}).confirm("确认关闭该窗口么？");
	    }
	};
})

  var LodopModelUser;

   function lodopPrint() {
       if (!LodopModelUser) {
	        var param={
				printerName:getLocalItem("SPD2_SNPrinter"),
				printerOrient:getLocalItem("SNPrinterOrient"),
				//printerPage:getLocalItem("SPD2_SNPrinterPage"),
				checkUsable:true,
				printerPageWidth:70,
				printerPageHeight:40,
				printType:"label",
				printInfoBoxId:"printInfoBoxId"
			};
           LodopModelUser = new window.LodopModel(param);
       }
       if (!LodopModelUser || !LodopModelUser.usable) {
           LodopModelUser = null;
           return;
       }

		$(".printlabel,.printtext").each(function(){
			var div=$(this);
			var colWidth=parseInt(div.attr("col"))/12*100+"%";
			div.css({"width":colWidth,"max-width":colWidth,float:"left","font-size":"11px"});
		})

       var strBodyStyle="<style>"+document.getElementById("stylePrint").innerHTML+"</style>";
		var printTableLen=$(".printbox").length;
		
		strBodyStyle="";
		if(printTableLen == 0){
			LodopModelUser.addPrintHtml(strBodyStyle+$(".printbox").prop("outerHTML"));
		}else{
			$(".printbox").each(function(index){
				var table=$(this);
				LodopModelUser.addPrintHtml(strBodyStyle+table.prop("outerHTML"));
				if(printTableLen != (index+1)) LodopModelUser.newPage();
			});
		}
		
		LodopModelUser.printView();
		
		$(".printlabel,.printtext").attr("style","");
   }

</script>
</html>