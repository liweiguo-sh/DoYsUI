<!DOCTYPE html>
<html>

<head>
    <title>文档库</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
	 <script src="../../../../res_plugin/zui-1.8.1-dist/lib/jquery/jquery.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/js/zui.js"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/js/zuiExt.js"></script>
    <link rel="stylesheet" href="../../../../res_plugin/zui-1.8.1-dist/css/zui.min.css" />
   <script src="../../../../res_plugin/jquery/jquery-migrate-1.2.1.js" title="jQuery migrate插件解决迁移兼容问题"></script>
	<script src="../../../../res_plugin/jquery/jquery.jqprint-0.3.js" title="打印插件"></script>
	
	<style type="text/css">
		.modal-body{
			white-space: pre-line;
		}
	</style>
</head>

<body>
    <div class="container-fluid with-padding" >
    	 <div class="row ">
    	 	<div class="col-xs-12 with-padding" >
	            <div class="btn-group">
				  <button type="button" class="btn" onclick="win.close();"  style="    margin-left: 3px;">关闭</button>
				</div>
    	 	</div>
        </div>
    	 <div class="row with-padding">
    	 	<div class="col-xs-1 text-right" >
    	 	</div>
    	 	<div class="col-xs-11" >
    	 		只显示项目目录下面docs目录第一级文件列表，目前仅支持文本类型(txt)预览。
    	 	</div>
    	 	<div class="col-xs-1 text-right" >
    	 		文档命名规则
    	 	</div>
    	 	<div class="col-xs-11" >
    	 		开发文档/实施文档/操作文档_v2020001.doc
    	 	</div>
    	 	<div class="col-xs-1  text-right">
    	 		<span class="label label-badge label-success" >2</span>
    	 	</div>
    	 	<div class="col-xs-11" >
    	 		该数字表示该文档库下面有2个文档
    	 	</div>
        </div>
        <div class="row" >
        	<div class="col-xs-12 with-padding" id="infoBox" >
				   <div class="row">
					  <div class="col-xs-2">
					    <ul class="nav  nav-stacked nav-pills" id="docNav">
					    </ul>
					  </div>
					  <div class="col-xs-10">
						    <div class="tab-content col-xs-12" id="docNavContent">
						    </div>
					  </div>
				</div>
        	</div>
        </div>
    </div>
</body>
</html>

<script type="text/javascript">

var docNav,docNavContent,jsonArrG=[],urlparam={};
function formLoad() {
	docNav=$("#docNav");
	docNavContent=$("#docNavContent");
	urlparam=getUrlPara(win.p.url);
	init();
}

//加载数据
function init() {
	  //查询配置模板
       var param={viewKey:"",systemType:urlparam.systemType,nodev:urlparam.nodev,noimp:urlparam.noimp},jsonArr=[];
       if (g.a.send("processType=com.system.HelpView&actionType=getSystemDocs",param, true)) {
           if (g.a.OK) {
               var jsonarrstr = g.a.cReturn.jsonarr;
               if (jsonarrstr) {
            	   jsonArr = eval(jsonarrstr);
               }
           }
       }
       
	   jsonArrG=jsonArr;
       if(jsonArr.length > 0){
       	 docNav.html("");
       	 docNavContent.html("");
       	 var ob,docob,navId="",docNavContentHtml=[],docsList,numHtml="",docsListSize=0,isFirst=true;
       	 for(var i=0;i<jsonArr.length;i++){
       	 	ob=jsonArr[i];
       	 	docsList=ob.docsList;
       	 	docNavContentHtml=[];
       	 	docsListSize=0;
       	 	navId="nav"+i;
       	 	 
       	 	if(docsList && docsList.length>0)  docsListSize=docsList.length;
       	 	if(docsListSize == 0 )continue;
       	 	numHtml='<span class="label label-badge label-success" style=" position: absolute; right: 22px;">'+docsListSize+'</span>';
       	 	if(isFirst){
	       	 	docNav.append('<li class="active"><a href="###" data-target="#'+navId+'" data-toggle="tab">'+ob.docsLibName+numHtml+'</a></li>');
       	 	}else{
	       	 	docNav.append('<li ><a href="###" data-target="#'+navId+'" data-toggle="tab">'+ob.docsLibName+numHtml+'</a></li>');
       	 	}
       	 	
       	 	if(isFirst){
	       	 	docNavContentHtml.push('<div class="tab-pane fade active in" id="'+navId+'">');
	       	 	isFirst=false;
       	 	}else{
	       	 	docNavContentHtml.push('<div class="tab-pane fade" id="'+navId+'">');
       	 	}
       	 	docNavContentHtml.push(' 	<div class="table-responsive"> ');
       	 	docNavContentHtml.push(' 		<table class="table table-striped table-hover table-bordered table-condensed " >');
       	 	docNavContentHtml.push(' 			<thead>');
       	 	docNavContentHtml.push(' 				 <th class="text-center" >文件名称</th>');
       	 	docNavContentHtml.push(' 				 <th class="text-center"  style="width:200px;">文件类型</th>');
       	 	docNavContentHtml.push(' 				 <th class="text-center" style="width:200px;" >预览/下载</th>');
       	 	docNavContentHtml.push(' 			</thead>');
       	 	if(docsList && docsList.length>0){
	       	 	docNavContentHtml.push(' 			 <tbody>');
	       	 	var btnHtml=[];
	       	 	for(var j=0;j<docsList.length;j++){
	       	 		docob=docsList[j];
		       	 	docNavContentHtml.push(' 			 <tr>');
		       	 	docNavContentHtml.push(' 			 	<td  >'+docob.docName+'</td> ');
		       	 	docNavContentHtml.push(' 			 	<td  >'+docob.docType+'</td> ');
		       	 	
		       	 	btnHtml=[];
		       	 	btnHtml.push('<div class="btn-group">');
		       	 	if(docob.docType && docob.docType.indexOf("txt") >=0){
			       	 	btnHtml.push('	<button type="button" class="btn btn-primary btn-sm"  onclick="view('+i+','+j+');" >预览</button>');
		       	 	}else{
			       	 	btnHtml.push('	<button type="button" class="btn btn-primary btn-sm"  onclick="view('+i+','+j+');" style="    visibility: hidden;">预览</button>');
		       	 	}
		       	 	btnHtml.push('	<button type="button" class="btn btn-primary btn-sm" style="    margin-left: 5px;" onclick="topWin.downloadFileByUrl(\''+docob.docLink+'\');" >下载</button>');
		       	 	
		       	 	btnHtml.push('</div>');
		       	 	docNavContentHtml.push(' 			 	<td  style="    text-align: center;">'+btnHtml.join("")+'</td> ');
		       	 	docNavContentHtml.push(' 			 </tr>');
	       	 		
	       	 	}
	       	 	docNavContentHtml.push(' 			 </tbody>');
       	 	}else{
	       	 	docNavContentHtml.push(' 			 <tbody> <tr> <td colspan="3" style="text-align:center;font-size:18px;">该文档库没有文档</td> </tr> </tbody>');
       	 	}
       	 	
       	 	docNavContentHtml.push(' 		</table>');
       	 	docNavContentHtml.push(' 	</div>');
       	 	docNavContentHtml.push(' </div>');
       	 	docNavContent.append(docNavContentHtml.join(""));
       	 	
       	 }
       }
}

 
//print
function view(i,j) {
	var docob=jsonArrG[i].docsList[j];
	var txt=g.a.getWebPageContent(g.httpServer+g.appPath+docob.docRelPath);
	var option={
		showHeader:true,
		title:"文件预览("+docob.docName+")",
		custom:txt,
		moveable:"inside", //true:可移动,inside:框架内部移动
		keyboard:true,
		backdrop:true,
		size:"lg",  // lg、sm、fullscreen
		name:"modalTrigger",
		trigger:{
			shown:function(){ //当对话框完全显示后发生（执行完显示动画之后）
			},
			hidden:function(){ //当对话框完全隐藏后发生（执行完隐藏动画之后）
			}
		}
	};
	zuiExt.modalTrigger(option);
	   
}
 
    
</script>