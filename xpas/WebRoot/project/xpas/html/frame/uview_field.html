<!DOCTYPE html>
<html>
<head>
    <title>数据视图字段管理</title>
	<link href="../../../../res/control/dropgrid/style1/xwf.dropgrid.css" rel="stylesheet" type="text/css" />

	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>

	<script src="../../../../res/control/uvform/xwf.uvform.js" type="text/javascript"></script>
	<script src="../../../../res/control/tab/xwf.tab.js" type="text/javascript"></script>
	<script src="../../../../res/control/grid/xwf.grid.js" type="text/javascript"></script>
	<script src="../../../../res/control/grid/xwf.gridview.js" type="text/javascript"></script>
	<script src="../../../../res/control/tree/xwf.tree.js" type="text/javascript"></script>

	<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
	<style type="text/css">
		b {
			color: Red;
		}
	</style>
</head>
<body>
	<div id="divDC"></div>
	<form id="frm" action="" target="">
		<div id="divTab" class="xwf_tab_divContainer" style="width:937px;height:450px;">
			<table id="tbForm" class="tbForm" style="width:937px;">
				<tr class="trH">
					<th style="width:130px;"></th>
					<th style="width:180px;"></th>
					<th style="width:130px;"></th>
					<th style="width:180px;"></th>
					<th style="width:130px;"></th>
					<th style="width:180px;"></th>
				</tr>
				<tr>
					<td>field_key：</td>
					<td colspan="3"><input id="_cField_Key" type="text" value="" /></td>
					<td>field_prefix：</td>
					<td><input id="_cField_prefix" type="text" value="" /></td>
				</tr>
				<tr>
					<td>字段：</td>
					<td><span id="_cField_Name"></span></td>
					<td><b>字段名称：</b></td>
					<td><input id="_cField_Text" type="text" value="" /></td>
					<td>字段提示：</td>
					<td><input id="_cField_Title" type="text" value="" /></td>
				</tr>
				<tr>
					<td>字段类型：</td>
					<td><span id="_cField_Type"></span></td>
					<td>数据类型：</td>
					<td><span id="_cDataType"></span></td>
					<td>字段长度</td>
					<td><span id="_cField_Length"></span></td>
				</tr>
				<tr>
					<td>主键字段：</td>
					<td><input id="_cField_pkey" type="checkbox" disabled="disabled" /></td>
					<td>自增量字段：</td>
					<td><input id="_cField_identity" type="checkbox" value="" title="ORACLE数据库需手工勾选" /></td>
					<td><b>允许空值：</b></td>
					<td><input id="_cField_nullable" type="checkbox" value="" /></td>
				</tr>
				<tr>
					<td>可更新字段：</td>
					<td><input id="_cField_updatable" type="checkbox" disabled="disabled" /></td>
					<td>允许修改：</td>
					<td><input id="_cField_editable" type="checkbox" /></td>
					<td>默认值：</td>
					<td><input id="_cField_default" type="text" value="" /></td>
				</tr>
				<tr>
					<td>数据源：</td>
					<td colspan="5"><textarea id="_cField_query_source" rows="5" cols="0"></textarea></td>
				</tr>
				<tr>
					<td>网格显示格式：</td>
					<td><input id="_cField_grid_format" type="text" value="" placeholder="示例：,2" /></td>
					<td>网格对齐方式：</td>
					<td><select id="_cField_align"><option value="left">左对齐</option><option value="center">居中</option><option value="right">右对齐</option></select></td>
					<td>网格宽度：</td>
					<td><input id="_cField_pixel_width" type="text" value="" /></td>
				</tr>
				<tr>
					<td><b>查询类型：</b></td>
					<td>
						<select id="_cField_query_type">							
							<option value="keyboard">手工输入</option>
							<option value="tree">查询树</option>
							<option value="none">禁用查询</option>							
						</select>
					</td>
					<td>查询KEY：</td>
					<td><input id="_cField_query_key" type="text" value="" /></td>
					<td>网格输入控件：</td>
					<td><input id="_cField_grid_control" type="text" value="" title="文本框：textbox" /></td>
				</tr>
				<tr>
					<td>输入界面格式：</td>
					<td><input id="_cField_input_format" type="text" value="" placeholder="示例：3"/></td>
					<td>JS验证KEY：</td>
					<td><input id="_cField_validation_key" type="text" value="" /></td>
					<td>CSS样式</td>
					<td><input id="_cField_css" type="text" value="" /></td>
				</tr>
				<tr>
					<td>备注：</td>
					<td colspan="5"><textarea id="_cField_Remark" rows="3" cols="0"></textarea></td>
				</tr>
				<tr>
					<td>创建人：</td>
					<td><span id="_cCreator"></span></td>
					<td>创建时间：</td>
					<td><span id="_cCDate"></span></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td>修改人：</td>
					<td><span id="_cModifier"></span></td>
					<td>修改时间：</td>
					<td><span id="_cMDate"></span></td>
					<td></td>
					<td></td>
				</tr>
			</table>
			<input type="hidden" id="_cView_Key" />
			<div id="divMore" style="display:none">more...</div>
		</div>
	</form>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
	// ----------------------------------------------------
	function formLoad() {
		vf.addExtraButton({ key: "createNavTreeByField", text: "创建导航" });
		vf.css(gId("tbForm"));

		tabs = new window.xwf_tab({ divContainer: gId("divTab") });
		tabs.addTab({ key: "tabB", text: "基本信息", control: gId("tbForm") });
		tabs.addTab({ key: "tabM", text: "扩展信息", title: "预留...", control: gId("divMore") });
	}
</script>

<!-- vf.events -->
<script type="text/javascript">
	vf.beforeSave = function () {
		// -- xTFS：判断是否已签出 ------------------------
		if (g.a.send("processType=com.xtfs.XtfsCore&actionType=getMDataStatus", { mdataType: "view", mdataKey: frm._cView_Key.value }, true)) {
			if (g.a.OK) {
				var cReturn = g.a.cReturn;
				if (!cReturn.newMData && !cReturn.myCheckout) {
					showWarn("主数据尚未签出，同步xTFS时修改会丢失，请谨慎操作。");
				}
			}
		}
		// ------------------------------------------------
        frm._cField_grid_format.value = frm._cField_grid_format.value.replace("，", ",");
		// ------------------------------------------------
		return true;
	}

	vf.beforeClick = function (prop) {
		if (prop.buttonKey.equals("createNavTreeByField")) {
			var jsonPost = {
				viewKey: frm._cView_Key.value,
				fieldName: vf.dtbBase.rows[0]["field_name"].value,
				fieldText: vf.dtbBase.rows[0]["field_text"].value
			};
			if (g.a.send("processType=com.xznext.xpas.ViewAid&actionType=createNavTreeByField", jsonPost, true)) {
				if (g.a.OK) {
					showMsg("创建成功，请手工继续完善节点定义。");
				}
			}
			else {
				return false;
			}
		}
		else {
			showErr("缺少处理程序。");
		}
		return false;
	}
</script>