<!DOCTYPE html>
<html>
<head>
    <title>用户定义</title>
	<script src="../../../../res/jscript/xwf.js"></script>
	<script src="../../../../res/jscript/xwf.ajax.js"></script>	
	<script src="../../../../res/jscript/xwf.const.js"></script>
	<script src="../../../../res/jscript/xwf.datatable.js"></script>
	<script src="../../../../res/control/uvform/xwf.uvform.js"></script>

	<script src="../../../../res/jscript/xwf.css.js"></script>
</head>
<body>
	<div id="divDC"></div>
    <div class="PanelA">
	    <form id="frm" action="" target="com.xznext.xpas.User">
		    <table id="tbForm" class="tbForm" style="width:685px;">
			    <tr class="trH">
				    <th style="width:150px;"></th>
				    <th style="width:180px;"></th>
				    <th style="width:150px;"></th>
				    <th style="width:200px;"></th>
			    </tr>
			    <tr>
				    <td>登陆名：</td>
				    <td><input id="_cUSER_KEY" type="text" value="" /></td>
				    <td>姓名：</td>
				    <td><input id="_cUser_Name" type="text" value="" /></td>
			    </tr>
			    <tr>
				    <td>密码：</td>
				    <td><input id="_cUser_password" type="text" value="" maxlength="20" /></td>
				    <td>状态：</td>
				    <td><input id="_cUser_inactive" type="checkbox" value="" /><label for="_cUser_inactive">账户已禁用</label></td>
			    </tr>
			    <tr>
				    <td>身份证号码：</td>
				    <td><input id="_cUser_id_card" type="text" value="" /></td>
				    <td>工作证号码：</td>
				    <td><input id="_cUser_job_number" type="text" value="" /></td>
			    </tr>
			    <tr>
				    <td>手机号码：</td>
				    <td><input id="_cUser_mobile" type="text" value="" /></td>
				    <td>电子邮箱：</td>
				    <td><input id="_cUser_email" type="text" value="" /></td>
			    </tr>
				<tr>
				    <td>MAC地址：</td>
				    <td colspan="3"><input id="_cMac" type="text" value="" /></td>
			    </tr>
			    <tr>
				    <td>备注：</td>
				    <td colspan="3"><textarea id="_cUser_Remark" rows="3" cols="0"></textarea></td>
			    </tr>
		    </table>
		    <input type="hidden" id="_cOffice_id" value="" />		
	    </form>
    </div>
</body>
</html>

<!-- formLoad -->
<script>
	var node = null;
	
	var eNodeKey = "";
	var office1Count = 0;
	// ----------------------------------------------------
	function formLoad() {
		node = win.para.gridView.tree.selectedNode;
		vf.css(gId("tbForm"));

		if (node.level > 1) {
			if (g.a.send("processType=com.xznext.xpas.User&actionType=get_eNodeKeyByOficeId", { viewKey: "fv_user", officeId: node.Columns["officeid"] }, true)) {
				if (g.a.OK) {
					var cReturn = g.a.cReturn;
					eNodeKey = cReturn.eNodeKey;
					office1Count = cReturn.office1Count;
					office1Count = 1;
				}
				else {
					return false;
				}
			}
			else {
				return false;
			}
		}
	}
</script>

<!-- vf.events -->
<script>
	vf.beforeAddnew = function () {
		if (node == null || node.Columns == null || node.Columns["officeid"] == null) {
			showWarn("请先选择上级机构。");
			return false;
		}
		return true;
	};
	vf.afterAddnew = function () {
		frm._cOffice_id.value = node.Columns["officeid"];
		frm._cUser_password.value = "123456";
		if (office1Count > 1) {
			// -- 多机构系统 --
			frm._cUSER_KEY.value = eNodeKey;
		}
	};

	vf.beforeSave = function () {
		frm._cUSER_KEY.value = frm._cUSER_KEY.value.trim();
		if (vf.status.equals("addnew")) {
			if (office1Count == 1) {
				// -- 单一机构系统 --
				if (frm._cUSER_KEY.value.length < 4) {
					showWarn("登录名长度不能少于4位。");
					frm._cUSER_KEY.focus();
					return false;
				}
			}
			else {
				// -- 多机构系统 --
				if (frm._cUSER_KEY.value.length < 7) {
					showWarn("登录名长度不能少于7位。");
					frm._cUSER_KEY.focus();
					return false;
				}
				if (!frm._cUSER_KEY.value.substring(0, 3).equals(eNodeKey)) {
					showWarn("用户名前3位必需是当前机构代码【" + eNodeKey + "】开头，请检查。");
					return false;
				}
			}
		}
		return true;
	}

	vf.afterMove = function () {
		if (vf.status.equals("addnew")) {
			frm._cUSER_KEY.disabled = false;
		}
		else {
			frm._cUSER_KEY.disabled = true;
		}
	}
</script>