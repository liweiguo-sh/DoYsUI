<!DOCTYPE html>
<html>
<head>
    <title>组织机构定义</title>
	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
	<script src="../../../../res/control/uvform/xwf.uvform.js" type="text/javascript"></script>

	<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
</head>
<body>
	<div id="divDC"></div>
	<form id="frm" action="" target="com.xznext.xpas.Office">
		<table id="tbForm" class="tbForm" style="width:665px;">
			<tr class="trH">
				<th style="width:130px;"></th>
				<th style="width:200px;"></th>
				<th style="width:130px;"></th>
				<th style="width:200px;"></th>
			</tr>
			<tr>
				<td>机构简称：</td>
				<td><input id="_cOffice_Shortname" type="text" value="" /></td>
				<td>机构代码：</td>
				<td><input id="_cOffice_Code" type="text" value="" /></td>
			</tr>
			<tr>
				<td>机构名称：</td>
				<td colspan="3"><input id="_cOffice_name" type="text" value="" /></td>
			</tr>
            <tr>
                <td>机构级别：</td>
                <td><input id="_cOffice_level_type" type="text" controlType="dropdown" fieldValue="office_level_type" fieldText="office_level_type_name" visibleSearch="false" /></td>
                <td>机构类别：</td>
                <td><input id="_cOffice_type" type="text" controlType="dropdown" fieldValue="office_type" fieldText="office_type_name" visibleSearch="false" /></td>
            </tr>
			<tr>
				<td>禁用标识：</td>
				<td><input id="_cOffice_hide" type="checkbox" value="" /><label for="_cOffice_hide">禁用</label></td>
				<td>序号：</td>
				<td><input id="_cOffice_order" type="text" value="" /></td>
			</tr>
			<tr>
				<td>备注：</td>
				<td colspan="3"><textarea id="_cOffice_Remark" rows="3" cols="0"></textarea></td>
			</tr>
		</table>
		<input type="hidden" id="_cPOffice_ID" value="" />
		<input type="hidden" id="_cOffice_ID" value="" />
		<input type="hidden" id="_cNode_Key" value="" />
		<input type="hidden" id="_cOffice_fullname" value="" />
		<input type="hidden" id="_cOffice_full_order" value="" />

		<input type="hidden" id="_xPNode_Key" value="" />
	</form>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
	var windowParent = null, tree = null;
	// ----------------------------------------------------
	function formLoad() {
		vf.css(gId("tbForm"));

		windowParent = win.parent.window;
		tree = windowParent.tree;
		node = tree.selectedNode;
	}
</script>

<script type="text/javascript">
	vf.afterAddnew = function () {
		if (!vf.copyAdd) {
			frm._cOffice_type.selectedIndex = 0;
		}
		
		frm._cOffice_order.value = "999";
	};

	vf.beforeSave = function () {
		if (vf.status.equals("addnew")) {
			frm._cPOffice_ID.value = node.officeId;
			frm._xPNode_Key.value = node.nodeKey;
		}
        if (frm._cOffice_Shortname.value.equals("")) {
            if (frm._cOffice_name.value.length <= 10) {
                frm._cOffice_Shortname.value = frm._cOffice_name.value;
            }
            else {
                showErr("请输入机构简称。");
                frm._cOffice_Shortname.focus();
                return false;
            }
        }
        else {
            if (frm._cOffice_Shortname.value.length > frm._cOffice_name.value.length) {
                frm._cOffice_Shortname.value = frm._cOffice_name.value;
            }
        }
		if (frm._cOffice_order.value.toInt() < 0 || frm._cOffice_order.value.toInt() > 999) {
			alert("机构序号范围为 0 - 999 之间。");
			return false;
		}
		return true;
	};
	vf.afterSave = function () {
		reloadParentNode();
	};
	vf.afterDelete = function () {
		reloadParentNode();
	}

	function reloadParentNode() {
		var nodeP = null;
		if (tree == null) {
			tree = vf.gridView.tree;
		}
		nodeP = tree.selectedNode;
		if (nodeP.generated || nodeP.children == 0) {
			// -- 父节点已展开，需要重新加载 --
			tree.reloadNode(nodeP);
		}
	}
</script>