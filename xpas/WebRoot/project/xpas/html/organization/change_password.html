<!DOCTYPE html>
<html>
<head>
    <title>修改密码</title>
	<script src="../../../../res_plugin/jquery/jquery-1.11.3.min.js" type="text/javascript"></script>
	<script src="../../../../res_plugin/jquery/jquery_md5.js" type="text/javascript"></script>

	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>	
	<style type="text/css">
		.divTitle {
			height: 48px;
			line-height: 48px;
			background-image: url('../../../../res/images/frame/password.gif');
			background-position: left center;
			background-repeat: no-repeat;
			padding-left: 52px;
		}
		.divLine {
			width: 340px;			
			height: 2px;
			margin: 10px 0px 10px 0px;
			background-color: #5373bf;
		}
		.tbPassword {
			margin: 0px 20px 0px 20px;
			table-layout: fixed;
			border-collapse: collapse;
		}
		.tbPassword td {
			padding: 0px;
			overflow: hidden;
			height: 32px;
			line-height: 32px;
			font-size: 11pt;
		}
		
		.divButtons {
			margin: 5px 0px 5px 0px;
			width: 340px;
			text-align: right;
		}

		input[type='password'] {
			height: 21px;
			width: 188px;
			border: solid 1px olive;
			color: Green;
		}
		input[type='button'] {
			width: 100px;
			height: 36px;
			font-size: 11pt;
			line-height: 32px;
			margin: 0px 5px 0px 0px;
		}
		input[type='button']:hover {
			color: Red;
		}
	</style>
</head>
<body>
	<div class="divTitle">请输入原密码和新密码（两遍）。</div>
	<div class="divLine"></div>
	<table class="tbPassword">
		<tr>
			<td style="width:110px;">原用户密码：</td>
			<td style="width:190px;"><input id="txtPassword" type="password" value="" maxlength="32" /></td>			
		</tr>
		<tr>
			<td>新用户密码：</td>
			<td><input id="txtPassword1" type="password" value="" maxlength="32" /></td>
		</tr>
		<tr>
			<td>新用户密码：</td>
			<td><input id="txtPassword2" type="password" value="" maxlength="32" /></td>			
		</tr>
	</table>
	<div class="divLine"></div>
	<div class="divButtons">
		<input type="button" id="btnChangePassword" value="修改密码" onclick="return btnChangePassword_click();" />
		<input type="button" value="关闭" onclick="return btnClose_click();" />
	</div>
</body>
</html>

<script type="text/javascript">
	var userKey = "";
	var txtPassword = gId("txtPassword");
	var txtPassword1 = gId("txtPassword1");
	var txtPassword2 = gId("txtPassword2");
	// ------------------------------------------------------------------------
	function formLoad() {
		if (window.topWin) {
			userKey = topWin.userKey;
		}
		else if (win.para.userKey) {
			userKey = win.para.userKey;
		}
		else {
			showMsg("程序员注意：框架已更新，请修改登录页面代码。");
			gId("btnChangePassword").style.display = "none";
		}
		txtPassword.focus();
	}

	function btnChangePassword_click() {
		if (!checkPassword()) return;

		if (g.a.send("processType=com.xznext.xpas.Login&actionType=changePassword", {
		    oldPassword: $.md5(userKey.toLowerCase() + "xwf.js" + txtPassword.value.toLowerCase()),
			newPassword: $.md5(userKey.toLowerCase() + "xwf.js" + txtPassword1.value.toLowerCase())
		}, true)) {
			if (g.a.OK) {
				showMsg("密码修改成功，请牢记。");
				if (win.para.invoker.equals("login")) {
					var txtPW = win.para.txtPW;
					txtPW.value = txtPassword1.value;
					txtPW.focus();
				}
				win.close();
			}
			else {
				return;
			}
		}
		else {
			return;
		}
	}
	function checkPassword() {
		txtPassword.value = txtPassword.value.trim();
		txtPassword1.value = txtPassword1.value.trim();
		txtPassword2.value = txtPassword2.value.trim();

		if (txtPassword.value.equals("")) {
			showWarn("请输入原密码。");
			txtPassword.focus();
			return false;
		}
		if (txtPassword1.value.equals("")) {
			showWarn("请输入新密码。");
			txtPassword1.focus();
			return false;
		}
		if (txtPassword1.value.equals(txtPassword.value)) {
			showWarn("您输入的新密码和原密码相同，请重新输入。");
			txtPassword1.value = "";
			txtPassword2.value = "";
			txtPassword1.focus();
			return false;
		}
		if (txtPassword2.value.equals("")) {
			showWarn("请再次输入相同的新密码。");
			txtPassword2.focus();
			return false;
		}
		if (!txtPassword1.value.equals(txtPassword2.value)) {
			showWarn("您2次输入的新密码不一致，请重新输入。");
			txtPassword1.value = "";
			txtPassword2.value = "";
			txtPassword1.focus();
			return false;
		}
		return true;
	}

	function btnClose_click() {
		win.close();
	}
</script>