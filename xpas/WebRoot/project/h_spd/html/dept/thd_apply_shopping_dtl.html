<!DOCTYPE html>
<html>
<head>
    <title>科室请领单</title>
    <script src="../../../../res/jscript/xwf.js?v=20191009" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>

     <script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/lib/jquery/jquery.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/js/zui.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/js/zuiExt.js" type="text/javascript"></script>
    <link href="../../../../res_plugin/zui-1.8.1-dist/css/zui.css" rel="stylesheet" type="text/css" />
    <script src="../../js/select_storage.js"></script>
     <script src="../../js/background.js"></script>
     <style type="text/css">
     	.nav2 button,.nav1 button{
     		margin-right: 5px;
     	}
     	
     	#noticebox{
     		height: 200px;
     	}
     	
     	#box-cards{
     		    max-height: 300px;
    			overflow-y: auto;
     	}
     	
     	
     	.article .content{
     		height: 100px !important;
     	}
     	.box-nav{
     		    margin: 0px;
    			padding-bottom: 40px;
     	}
     	
     	.btn-category:HOVER, .active{
     	}
     	
     	.btn-category{
     		margin-right: 5px;
     	}
     	
     	#panelshopcart{
     		    max-height: 240px;
    			overflow: auto;
     	}
     	
		.card{
			border-width: 3px;
			border-color:#fff;
		}
		
		#box-toolbar{
			    background-color: #f5f5f5;
		}
		
		.pager{
			margin: 0px 27px 0px 0px;
		}
		
		.card *{
			    cursor: pointer !important;
		}
		
				 
		 .static-text{
		 	box-shadow: none  !important;
		    outline: 0px  !important;
		    background: none  !important;
		    border: 0px  !important;
		   }
		   
		   
		   .card-shop-item{
		       border: 1px solid rgba(0,0,0,.2);
		    border-radius: 4px;
		    -webkit-box-shadow: 0 5px 10px rgba(0,0,0,.2);
		    box-shadow: 0 5px 10px rgba(0,0,0,.2);
		   }
		   
		   .input-lg {
		    height: 43px  !important;
		    padding: 10px 16px  !important;
		    font-size: 17px  !important;
		    line-height: 1.25  !important;
		    border-radius: 6px  !important;
		}
		
		 .btn-lg{
		  	padding: 10px 16px  !important;
		    font-size: 17px  !important;
		    line-height: 1.25  !important;
		    border-radius: 4px  !important;
		}
		
		.avatar{
			    width: 150px !important;
    		text-align: center !important;
    		    height: auto !important;
		
		}
		
		.comment .text{
			    word-break: break-all;
		}
		
		#myNiceCarousel .item {
			background-color:none  !important;
		}
		
     </style>
</head>
<body onload="formLoad();">

<form id="frm" action="" target="h_spd.dept.VIEW_thdApply">
	<input id="_cAPPLY_ID" type="hidden" value="" />
    <input id="_cAStatus" type="hidden" value="" />

    <input id="_cDept_id" type="hidden" value="" />
    <input id="_cStorage_id_dept" type="hidden" value="" />
    <input id="_cStorage_id_res" type="hidden" value="" />
    <input id="_cStorage_name_res" type="hidden" value="" />
</form>
<div class="container-fluid">
	<div class="row">
		<div class="col-xs-2" >
			<div class="row" id="box-user">
				<div class="col-xs-12">
					<div class="panel">
					  <div class="panel-heading text-center">
					  </div>
					  <div class="panel-body">
					   	<div class="row  with-padding">
							<label class="col-xs-4">当前库房
							</label>
							<div class="col-xs-8" ">
								<div class="input-control search-box has-icon-left has-icon-right" id="searchboxExample">
								  <input    id="_xStationStorage" type="search" class="form-control static-text "   disabled="disabled" >
								</div>
							</div>
						</div>
						<div class="row with-padding">
							<div class="col-xs-4" ">
							</div>
							<div class="col-xs-8" ">
								<button class="btn btn-block  " type="button" onclick="win.close();">关闭窗口</button>
							</div>
						
						</div>
					  </div>
					</div>
				</div>
			</div>
			<div class="row" style="display:none;">
				<div class="col-xs-12">
					<div class="panel">
					  <div class="panel-heading text-center">
						购物车
						<i class="icon  icon-refresh pull-right" style="cursor: pointer;" title="刷新购物车" onclick="vf.loadShopCart();"></i>
					  </div>
					  <div class="panel-body">
					  	<div class="row"  id="panelshopcart" >
							<div class="col-xs-12" >
						  		<table class="table table-hover table-striped table-condensed">
								  <thead>
								    <tr style="display: none;" >
								      <th class="text-center">耗材</th>
								      <th class="text-center">数量</th>
								      <th class="text-center">操作</th>
								    </tr>
								  </thead>
								  <tbody id="boxshopCart">
								    <tr>
								      <td colspan="3" class="text-center">暂无数据</td>
								    </tr>
								  </tbody>
								</table>
							</div>
						</div>
						<div class="row">
					  		<div class="col-xs-4" ">
								<button class="btn btn-block  btn-primary " id="btn-submit" type="button" onclick="vf.submit();" style="display: none;">提交</button>
							</div>
					  		<div class="col-xs-4" ">
								<button class="btn btn-block  btn-primary " type="button" onclick="vf.openApplyList();">查看</button>
							</div>
							<div class="col-xs-4" ">
								<button class="btn btn-block  " type="button" onclick="win.close();">关闭窗口</button>
							</div>
						
						</div>
					  </div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-xs-10">
			<div class="row">
				<div class="col-xs-12">
					<div class="row">
						<div class="col-xs-8">
							<div class="cards" id="box-cards">
								
						   </div>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-8" id="com-box">
							 <header>
							    <h3>累计评论 <span id="com-num"></span></span></h3>
							  </header>
							 <footer>
							    <div class="reply-form with-padding" >
							      <form class="form">
							        <div class="form-group">
							          <textarea class="form-control new-comment-text" id="com-text" rows="2" placeholder="撰写评论..."></textarea>
								        <div class="pull-right" style="    padding-top: 5px;"><a href="javascript:;" onclick="vf.addMatrComm();" class="btn btn-primary"><i class="icon-comment-alt"></i> 发表评论</a></div>
							        </div>
							      </form>
							    </div>
							  </footer>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</body>
</html>


<!-- formLoad -->
<script type="text/javascript">
   var boxcards,boxtoolbar,timeoutload=300,boxshopCart,myPager,panelshopcart,boxuser,btnSubmit,matrId=0,vf={},applyId,comText;
    //窗口加载后调用
    function formLoad() {
    	setTimeout(function(){
    		matrId=win.p.menu.drMenu.menu_parameter.matrId;
    		applyId=win.p.menu.drMenu.menu_parameter.applyId;
    		frm._cAPPLY_ID.value=applyId;
	    	//设置工位
	    	initStation();
	    	if(getLocalItem("stationStorageId").toInt() <1){
	    		//alert(1111);
	    		//win.close();
	    		//return;
	    	}
	    	
	        boxcards=$("#box-cards");
	        boxtoolbar=$("#box-toolbar");
	        boxshopCart=$("#boxshopCart");
	        panelshopcart=$("#panelshopcart");
	        boxuser=$("#box-user");
	        btnSubmit=$("#btn-submit");
	        comText=$("#com-text");
	        
	      
		    
		    gId("_xStationStorage").value = getLocalItem("stationStorageName");
		    
		    //库存列表列表
	        vf.getStockList();
	        
	        vf.getMatrComm();
			vf.resetBoxH();
			
			$("#keyword").focus();
    	},300)
    }
    
    
    vf.resetBoxH=function(){
    	  //列表区域高度
        var boxcardH= window.innerHeight;
	    boxcardH = boxcardH - boxtoolbar.outerHeight() - $("#myPager").outerHeight()-10;
	    boxcards.css({"max-height":boxcardH+"px"})
	    
	    var pannelH= window.innerHeight;
	   	pannelH=pannelH-boxuser.outerHeight()-94;
	    panelshopcart.css({"max-height":pannelH+"px"})
    }
    
    
    
    //获取列表查询sql
    vf.getStockListFilter=function(){
    	var keyword=$.trim($("#keyword").val());
    	var filterSql=[];
    	
    	//关键字检索
    	var filterSqlLike=[];
    	if(keyword.length>0){
    		filterSqlLike.push(" material_name like '%"+keyword+"%' ")
    		filterSqlLike.push(" material_spec like '%"+keyword+"%' ")
    		filterSqlLike.push(" m.manufacturer_name like '%"+keyword+"%' ")
    		filterSqlLike.push(" sp_name like '%"+keyword+"%' ");
    	}
    	if(filterSqlLike.length >0) filterSql.push("  ("+filterSqlLike.join(" or ")+" )");
    	
    	
    	//品类筛选
    	filterSqlLike=[];
    	var boxnavid=$(".btn-category.active:last").closest(".box-nav").find(".btn-category.active").each(function(){
    		var node_key=$(this).attr("node_key");
    		filterSqlLike.push(" left(cat.node_key,len('"+node_key+"'))='"+node_key+"' ");
    	});
    	if(filterSqlLike.length >0) filterSql.push("  ("+filterSqlLike.join(" or ")+" )");
    	
    	if(filterSql.length>0) return "and ("+ filterSql.join(" and ")+")";
    	return "";
    	
    }
    //初始化商品列表
    vf.getStockList=function(pageload){
    	showWait();
	    setTimeout(function(){
	    	vf.getStockListExec(pageload);
	    	vf.resetBoxH();
	    	hideWait();
	    },timeoutload);
    }
    
    //初始化商品列表--执行查询
    vf.getStockListExec=function(pageload){
    	 var pageloadQ=1;
    	 
    	 if(pageloadQ<1) pageloadQ=1;
    	 
    	 if (g.a.send("processType=h_spd.dept.ThdApplyShopAux&actionType=getThdApplyInitDataOne", {filterSql: vf.getStockListFilter(),pageload:pageloadQ,storageId:topWin.stationStorageId,matrId:matrId}, false)) {
			boxcards.html("");
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                var dtbStock = cReturn.dtbStock;
                 var dtbImgs = cReturn.dtbImgs;
               	frm._cStorage_id_res.value=cReturn["storageIdRes"];
               	frm._cStorage_name_res.value=cReturn["storageNameRes"];
				
				var page=parseInt(cReturn["page"]);
				var recTotal=parseInt(cReturn["recTotal"]);
				var totalPage=parseInt(cReturn["totalPage"]);
				var row,html=[],inpId="";
				if(dtbStock.rowCount>0){
					for(var i=0;i<dtbStock.rowCount;i++){
						row=dtbStock.rows[i];
						var filePath=row.filepath?row.filepath.value:null;
						
						if(filePath){
							filePath=g.httpServer+filePath;
						}else{
							filePath=g.httpServer+g.appPath+"res/images/empty.png";
						}
						html=[];
						inpId="inp_"+i;
						
						html.push('<div class="col-md-12 ">');
						html.push('		<a class="card " href="###"  material_id='+row.material_id.value+'>');
						
						
						var material_spec=row.material_spec.value;
						html.push('		 	<div class="card-content text-muted form-horizontal form-condensed"> ');
						
						html.push('		 		 <div class="row  with-padding"   > ');
						html.push('					<div class="col-xs-9 text-center" id="imgBox">');
						html.push('					</div>');
						html.push('					<div class="col-xs-3" style="    padding: 50px 0px;font-size: 18px;">');
						html.push('		 			 	<div class="form-group"  > ');
						html.push('							<label  class="col-xs-3">品名:</label>');
						html.push('							<div class="col-xs-9">');
						html.push('								<input type="text" class="form-control static-text " value="'+row.material_name.value+'"  readonly="readonly"> ');
						html.push('							</div>');
						html.push('					 	</div>');
						html.push('		 			 	<div class="form-group"  > ');
						html.push('							<label  class="col-xs-3">品规:</label>');
						html.push('							<div class="col-xs-9">');
						html.push('								<input type="text" class="form-control static-text " value="'+row.material_spec.value+'"  readonly="readonly"> ');
						html.push('							</div>');
						html.push('					 	</div>');
						html.push('		 			 	<div class="form-group"  > ');
						html.push('							<label  class="col-xs-3">单位:</label>');
						html.push('							<div class="col-xs-9">');
						html.push('								<input type="text" class="form-control static-text " value="'+row.material_unit.value+'"  readonly="readonly"> ');
						html.push('							</div>');
						html.push('					 	</div>');
						
						
						html.push('		 		 		<div class="form-group"> ');
						html.push('							<label  class="col-xs-12 " style="    text-align: left;">申请数量:</label>');
						html.push('						</div>');
						html.push('		 		 		<div class="form-group"> ');
						html.push('							<div class="col-xs-3">');
						html.push('							</div>');
						html.push('							<div class="col-xs-6">');
						html.push('								<input type="text" style="cursor: text !important;"    class="form-control input-lg useio" placeholder="" value="1" id="'+inpId+'">');
						html.push('							</div>');
						html.push('						</div>');
						html.push('		 		 		<div class="form-group"> ');
						html.push('							<div class="col-xs-12">');
						html.push('								 <button class="btn btn-block  btn-primary btn-lg " type="button"   onclick="vf.addDtl('+row.material_id.value+',\''+inpId+'\','+row.qty_stock.value+')" >立即申请</button> ');
						html.push('							</div>');
						html.push('						</div>');
						
						html.push('					</div>');
						html.push('				 </div>');
						
						html.push('			</div>');
						html.push('		 </a>');
						html.push('</div>');
						
						boxcards.append(html.join(""));
						$(".useio:last").focus();
					}
					
					html=[];
					var htmlTitle=[],htmlItem=[];
					for(var i=0;i<dtbImgs.rowCount;i++){
						row=dtbImgs.rows[i];
						filePath=row.filepath.value;
						if(i==0){
							htmlTitle.push('								<li data-target="#myNiceCarousel" data-slide-to="'+i+'" class="active"></li>');
						}else{
							htmlTitle.push('								<li data-target="#myNiceCarousel" data-slide-to="'+i+'" ></li>');
						}
						if(i==0){
							htmlItem.push('								<div class="item active"><img alt="" src="'+filePath+'" /></div>');
						}else{
							htmlItem.push('								<div class="item"><img   style="    margin: auto auto;" alt="" src="'+filePath+'" /></div>');
						}
					}
					
					if(htmlTitle.length <1){
						filePath=g.httpServer+g.appPath+"res/images/empty.png";
						htmlTitle.push('								<li data-target="#myNiceCarousel" data-slide-to="0" class="active"></li>');
						htmlItem.push('								<div class="item active"><img style="    margin: auto auto;" alt="" src="'+filePath+'" /></div>');
					}
					
					html.push('						<div id="myNiceCarousel" class="carousel slide" data-ride="carousel">');
					html.push('							<ol class="carousel-indicators">'+htmlTitle.join(""));
					html.push('							</ol>');
					html.push('							<div class="carousel-inner">'+htmlItem.join(""));
					html.push('							</div>');
					html.push('							<a class="left carousel-control" href="#myNiceCarousel" data-slide="prev"> <span class="icon icon-chevron-left"></span> </a> ');
					html.push('							<a class="right carousel-control" href="#myNiceCarousel" data-slide="next">  <span class="icon icon-chevron-right"></span> </a>');
					html.push('						</div>');
					$("#imgBox").html(html.join(""));
					$('.carousel').carousel();
					
					
				}else{
					html=[];
					html.push('<div class="col-md-12 ">');
					html.push('		<div class="alert  with-icon">');
					html.push('			 <i class="icon-frown"></i>');
					html.push('			<div class="content"><strong>哎呀</strong> 没查到相关数据。</div> ');
					html.push('		</div>');
					html.push('</div>');
					boxcards.append(html.join(""));
				}
				
            } else {
            	var html=[];
				html.push('<div class="col-md-12 ">');
				html.push('		<div class="alert  with-icon">');
				html.push('			 <i class="icon-frown"></i>');
				html.push('			<div class="content"><strong>哎呀</strong> 没查到相关数据。</div> ');
				html.push('		</div>');
				html.push('</div>');
				boxcards.append(html.join(""));
				//分页
				var status={
					 page: 0,  //当前页码；
				    recTotal: 0,  //记录总数；
				    recPerPage: 20,  //每页记录数目；
				    totalPage: 0  //总页数；
				};
				
				$('#myPager').pager(status);
				myPager = $('#myPager').data('zui.pager');
				
				zuiExt.msg({msg:"数据加载失败，原因:"+g.a.ErrMessage,type:"danger"});
                return false;
            }
        } else {
            return false;
        }
    }
    
     
    
    
    //添加明细，如果主表不存在，则后台会先添加子表
    vf.addDtl=function(materialId,inpId,qtyStock,e) {
		var param={};
		var qtyInp=$("#"+inpId),qty=parseInt($.trim(qtyInp.val()));
		qtyStock=parseInt(qtyStock);
		if(isNaN(qty)){
			zuiExt.tip({id:qtyInp.attr("id"),title:"申请数量为大于0的整数",autoFocus:true});
			return;
		}
		if(qty <=0){
			zuiExt.tip({id:qtyInp.attr("id"),title:"申请数量应该大于1",autoFocus:true});
			return;
		}
		if(qty > qtyStock){
			zuiExt.tip({id:qtyInp.attr("id"),title:"申请数量应该小于可用库存"+qtyStock,autoFocus:true});
			return;
		}
		
		param.applyId=frm._cAPPLY_ID.value.toInt();
		param.matrId=materialId;
		param.qty=qty;
		param.rate=1;
		param.storageIdRes=frm._cStorage_id_res.value;
		param.storage_name_res=frm._cStorage_name_res.value;
		param.allowApplyZeroStock=0;
		param.userKey=topWin.userKey;
		param.userName=topWin.userName;
		param.dept_id=topWin.stationDeptId;
		param.dept_name=topWin.stationDeptName;
		param.storage_id_dept=topWin.stationStorageId;
		param.storage_name_dept=topWin.stationStorageName;
        if (g.a.send("processType=h_spd.dept.ThdApplyShopAux&actionType=addApplyDtl", param, false)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                frm._cAPPLY_ID.value=cReturn.applyId;
                zuiExt.msg({msg:"添加成功",type:"success",time:10000000});
                vf.loadShopCart();
                vf.getStockList();
                win.p.loadShopCartCall(frm._cAPPLY_ID.value);
                setTimeout(function(){
                	win.close();
                },500)
            } else {
            	vf.errorAfter(g.a.cReturn);
            	 win.p.loadShopCartCall(frm._cAPPLY_ID.value);
                return false;
            }
        } else {
            return false;
        }
    }
    
    
    
    //加载购物车
    vf.loadShopCart=function(){
    	 var param={applyId:frm._cAPPLY_ID.value.toInt()};
    	 if (g.a.send("processType=h_spd.dept.ThdApplyShopAux&actionType=getApplyDtls", param, true)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                var rsdtls = cReturn.rsdtls;
				frm._cAPPLY_ID.value=cReturn.applyId;
				if(rsdtls.rowCount>0){
					var row,tdHtml="";
					boxshopCart.html('');
					for(var i=0;i<rsdtls.rowCount;i++){
						row=rsdtls.rows[i];
						tdHtml="<tr>";
						tdHtml+='	<td>'+row.matr_name.value+'</td>';
						tdHtml+='	<td>'+row.qty.value+'</td>';
						tdHtml+='	<td class="text-center"><button class="btn btn-sm btn-danger" type="button" onclick="vf.deleteDtl('+row.apply_id.value+','+row.apply_dtl_id.value+','+row.stock_id.value+')">删除</button></td>';
						tdHtml+='</tr>';
						boxshopCart.append(tdHtml);
					}
					btnSubmit.show();
				}else{
					boxshopCart.html('<tr>  <td colspan="3" class="text-center">暂无数据</td>  </tr>');
					btnSubmit.hide();
				}
				//zuiExt.msg({msg:"购物车刷新成功",type:"success"});
            } else {
                return false;
            }
        } else {
            return false;
        }
    }
    
    
    //删除明细 
    vf.deleteDtl=function(apply_id,apply_dtl_id,stock_id) {
		var param={};
		
		param.apply_id=apply_id;
		param.apply_dtl_id=apply_dtl_id;
		param.stock_id=stock_id;
        if (g.a.send("processType=h_spd.dept.ThdApplyShopAux&actionType=deleteApplyDtl", param, false)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                zuiExt.msg({msg:"删除成功",type:"success"});
                vf.loadShopCart();
                vf.getStockList();
                 win.p.loadShopCartCall(frm._cAPPLY_ID.value);
            } else {
                vf.errorAfter(g.a.cReturn);
                 win.p.loadShopCartCall(frm._cAPPLY_ID.value);
                return false;
            }
        } else {
            return false;
        }
    }
    
    //打开申请列表
    vf.openApplyList=function() {
		 topWin.openMenu({ menuKey: "PG1010001001" });
    }
    
    //提交
    vf.submit=function() {
    	var param={};
		param.apply_id=frm._cAPPLY_ID.value;
		param.userKey=topWin.userKey;
        if (g.a.send("processType=h_spd.dept.ThdApplyShopAux&actionType=applyAudit", param, false)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                zuiExt.msg({msg:"提交成功",type:"success"});
                frm._cAPPLY_ID.value=0;
                vf.loadShopCart();
            } else {
               vf.errorAfter(g.a.cReturn);
                return false;
            }
        } else {
            return false;
        }
    }
    
     
    //操作失败后执行某种动作
    vf.errorAfter=function(ret) {
    	frm._cAPPLY_ID.value=0;
    	zuiExt.msg({msg:ret.ErrMessage,type:"danger"});
    	if(ret.code == -1){ //已被处理
    		 vf.loadShopCart();
    	}else if(ret.code == -99){//已被删除
    		vf.loadShopCart();
    	}
    }
    //单独打开某个耗材
    vf.openOne=function(matrId,material_name) {
    	var toHtml="project/h_spd/html/dept/thd_apply_shopping_dtl.html";
		var drMenu={drMenu:{menu_parameter:{matrId:matrId,matrName:material_name},id:{value:-1},menu_onlyone:{value:1}}};
		
		var prop = {
	         menu: drMenu,
	        text: "耗材详情："+material_name,
	         url: g.appPath +toHtml,
	        title: "耗材详情："+material_name
	     };
	     var para = {
	         viewKey: "sum"
	     };
	     topWin.openFullWindow(prop, para);
    }
    
     //添加评论
    vf.addMatrComm=function(materialId,inpId,qtyStock,e) {
		var param={};
		if($.trim(comText.val()).length <1){
			zuiExt.tip({id:"com-text",title:"请输入评论",autoFocus:true});
			return;
		}
		
		param.text=$.trim(comText.val());
		param.dept_name=topWin.stationDeptName;
		param.user_name=topWin.userName;
		param.matr_id=matrId;
		
        if (g.a.send("processType=h_spd.dept.ThdApplyShopAux&actionType=addMatrComm", param, false)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                frm._cAPPLY_ID.value=cReturn.applyId;
                zuiExt.msg({msg:"评论成功",type:"success"});
                comText.val("");
                 vf.getMatrComm();
            } else {
            	vf.errorAfter(g.a.cReturn);
                return false;
            }
        } else {
            return false;
        }
    }
							    
     
    //加载评论
    vf.getMatrComm=function(){
    	 var param={matrId:matrId};
    	 if (g.a.send("processType=h_spd.dept.ThdApplyShopAux&actionType=getMatrComm", param, true)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                var rsdtls = cReturn.rsdtls;
                $("#com-num").html(rsdtls.rowCount);
                
                 $("#com-box .comment").remove();
				if(rsdtls.rowCount>0){
					var row,tdHtml="";
					for(var i=0;i<rsdtls.rowCount;i++){
						row=rsdtls.rows[i];
						tdHtml='<div class="comment">';
						tdHtml+='	 <a href="###" class="avatar"><i class="icon-user icon-2x"></i> <h3>'+row.dept_name.value+'</h3><h3>'+row.cdate.value.substring(0,10)+'</h3>  </a>';
						tdHtml+='	 <div class="content">';
						tdHtml+='	 	<div class="text">'+row.text.value+'</div>';
						tdHtml+='	</div>';
						tdHtml+='</div>';
						$("#com-box").append(tdHtml);
					}
				}else{
				}
            } else {
                return false;
            }
        } else {
            return false;
        }
    }
    
    
</script>
 