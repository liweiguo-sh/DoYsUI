<!DOCTYPE html>
<html>
<head>
    <title>定数包拆包 (解除RIFD/SN绑定)</title>
    <script src="../../../../res/jscript/xwf.js"></script>
    <script src="../../../../res/jscript/xwf.ajax.js"></script>
    <script src="../../../../res/jscript/xwf.const.js"></script>

    <script src="../../../../res/control/tree/xwf.tree.js"></script>
    <script src="../../../../res/control/grid/xwf.grid.js"></script>
    <script src="../../../../res/control/grid/xwf.gridview.js"></script>

    <script src="../../../../res/jscript/xwf.css.js"></script>

    <style type="text/css">
        #tbButtons {
            margin: 15px 0px 10px 0px;
        }
        
        #tbButtons td {
            overflow: hidden;
            border: solid 0px red;
        }
        
        #divPkgSummary {
            color: blue;
            font-size: 12pt;
            height: 90px;
            line-height: 30px;
            overflow: auto;
            vertical-align: middle;
        }
        
        #txtScan {
            color: red;
            font-size: 11pt;
            height: 30px;
            line-height: 30px;
            width: 300px;
            border: solid 2px #3280FA;
            padding: 0px 8px 0px 8px;
        }
        
        #btnRelease {
            font-size: 12pt;
            border: 0px;
            height: 36px;
            width: 150px;
            color: white;
            background-color: #3280FA;
            border-radius: 4px;
            margin: 0px 10px 0px 10px;
            cursor: pointer;
        } 
        #btnRelease:hover {
            color: yellow;
        }
    </style>
</head>
<body>
    <div class="PanelA">
        <table id="tbButtons">
            <tr>
                <td style="width:330px;"><input type="text" id="txtScan" placeholder="请扫描RFID/SN..." /></td>
                <td style="text-align:right;width:160px;"><input type="button" id="btnRelease"  onclick="btnRelease_click();" value="解&nbsp;&nbsp;绑" /></td>
            </tr>
            <tr>
                <td colspan="2"><div id="divPkgSummary"></div></td>
            </tr>
        </table> 
    </div>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript"> 
    var packProcessId = 0, wiId = 0;

    var txtScan = gId("txtScan");
    var spanPkgSummary = gId("spanPkgSummary"); 
     
    // ------------------------------------------------------------------------
    function formLoad() {
        g.x.bindEnterEvent(txtScan, onTxtScanEnter);
        txtScan.focus();
    }     
</script>

<!-- buttons -->
<script type="text/javascript">
    function btnClose_click() {
        if (win.para.callback) {
            win.para.callback();
        }
        win.close();
    }
</script>

<!-- rfid scan -->
<script type="text/javascript">
    function onTxtScanEnter() {
        return false;
        var rfid = txtScan.value.trim();

        // ------------------------------------------------
        if (rfid.equals("")) {
            return false;
        }
        if (g.a.send("processType=h_spd.op.FixedNumPkgProcess&actionType=releasePackageByRfid", { rfid: rfid }, true)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;

                win.flashTitle("定数包解绑定成功，RFID/SN = " + rfid);
                txtScan.value = "";
                txtScan.focus();
            }
            else {
                return false;
            }
        }
    }

    function btnRelease_click() {
        var rfid = txtScan.value.trim();

        // ------------------------------------------------
        if (rfid.equals("")) {
            return false;
        }
        if (g.a.send("processType=h_spd.op.FixedNumPkgProcess&actionType=releasePackageByRfid", { rfid: rfid, packProcessId: packProcessId, wiId: wiId }, true)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                if (cReturn.packProcessId) {
                    packProcessId = cReturn.packProcessId;
                    wiId = cReturn.wiId;
                }

                win.flashTitle("定数包解绑定成功，RFID/SN = " + rfid);
                txtScan.value = "";
                txtScan.focus();
            }
            else {
                return false;
            }
        }
    }
</script>