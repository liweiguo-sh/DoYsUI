<!DOCTYPE html>
<html>
<head>
    <title>系统参数配置</title>
	<script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
	<script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>	
	<script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>

	<script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>

    <style type="text/css">
        .lbl {
        
        }
        .chk {
        
        }
        .txt {
            width: 90%
        }
    </style>
</head>
<body>
    <div id="divButton" class="divButtons" style="margin-bottom:12px;">
		<input type="button" id="btnSave" onclick="btnSave_click();" value="保存" />
        <input type="button" id="btnSaveAndClose" onclick="btnSaveAndClose_click();" value="保存并关闭" />
		<input type="button" id="btnClose" onclick="btnClose_click();" value="关闭" />
	</div>
	<form id="frm" action="" target="">
		<div id="divTab" class="xwf_tab_divContainer" style="width:910px;">
            <table id="tbWi" class="tbForm" style="width:900px;">
				<tr class="trH">
					<th style="width:30%;"></th>
                    <th style="width:20%;"></th>
                    <th style="width:30%;"></th>
                    <th style="width:20%;"></th>
				</tr>
				<tr>				
					<td><label id="_lblWI_AUTO_TO_DIST" class="lbl">是否开启入库转配送</label></td>
					<td><input id="_chkWI_AUTO_TO_DIST" class="chk" type="checkbox" /><label for="_chkWI_AUTO_TO_DIST">开启</label></td>				
				</tr>
			</table>
			<table id="tbApply" class="tbForm" style="width:900px;">
				<tr class="trH">
					<th style="width:30%;"></th>
                    <th style="width:20%;"></th>
                    <th style="width:30%;"></th>
                    <th style="width:20%;"></th>
				</tr>
				<tr>				
					<td><label id="_lblTHD_APPLY_ALLOW_ZERO_STOCK" class="lbl">是否允许请领无库存耗材</label></td>
					<td><input id="_chkTHD_APPLY_ALLOW_ZERO_STOCK" class="chk" type="checkbox" /><label for="_chkTHD_APPLY_ALLOW_ZERO_STOCK">允许</label></td>
					<td><label id="_lblTHD_APPLY_OVERTIME_HOURS" class="lbl">自动解锁锁定库存时间 (小时)</label></td>
					<td><input id="_txtTHD_APPLY_OVERTIME_HOURS" class="txt" type="text" /></td>					
				</tr>
                <tr>			
					<td><label id="_lblTHD_APPLY_SHOW_LIMIT" class="lbl">是否显示限额控制（请领）</label></td>
					<td><input id="_chkTHD_APPLY_SHOW_LIMIT" class="chk" type="checkbox" /><label for="_chkTHD_APPLY_SHOW_LIMIT">显示</label></td>
                </tr>
			</table>
            <table id="tbDemand" class="tbForm" style="width:900px;">
				<tr class="trH">
					<th style="width:30%;"></th>
                    <th style="width:20%;"></th>
                    <th style="width:30%;"></th>
                    <th style="width:20%;"></th>
				</tr>
				<tr>				
					<td><label id="_lblTHD_DEMAND_OVERTIME_HOURS" class="lbl">需求超时审批自动进入下一步 (小时)</label></td>
					<td><input id="_txtTHD_DEMAND_OVERTIME_HOURS" class="txt" type="text" /></td>
                    <td><label id="_lblTHD_DEMAND_SHOW_LIMIT" class="lbl">是否显示限额控制（需求计划）</label></td>
					<td><input id="_chkTHD_DEMAND_SHOW_LIMIT" class="chk" type="checkbox" /><label for="_chkTHD_DEMAND_SHOW_LIMIT">显示</label></td>
 
				</tr>
			</table>
			<table id="tbTpo" class="tbForm" style="width:900px;">
				<tr class="trH">
					<th style="width:30%;"></th>
                    <th style="width:20%;"></th>
                    <th style="width:30%;"></th>
                    <th style="width:20%;"></th>
				</tr>
				<tr>				
					<td><label id="_lblTPO_LASTTIME_DAY" class="lbl">最晚送达日期（天）</label></td>
					<td><input id="_txtTPO_LASTTIME_DAY" class="txt" type="text" /></td>
					<td>（含当天）</td>
				</tr>
			</table>
            <table id="tbClearDemand" class="tbForm" style="width:900px;">
                <tr class="trH">
                    <th style="width:30%;"></th>
                    <th style="width:20%;"></th>
                    <th style="width:30%;"></th>
                    <th style="width:20%;"></th>
                </tr>
                <tr>
                    <td><label id="_lblTAREP_POOL_TIME_REQ" class="lbl">未响应需求订单清除时间</label></td>
                    <td><input id="_txtTAREP_POOL_TIME_REQ" class="txt" type="text" /></td>
                    <td>（不含当天）</td>
                </tr>
            </table>
		</div>
	</form>
</body>
</html>

<!-- formLoad -->
<script type="text/javascript">
    var arrDom = new Array();
    
    var tbWi = gId("tbWi");
    var tbApply = gId("tbApply");
    var tbDemand = gId("tbDemand");
    var tbTpo = gId("tbTpo");
    var tbClearDemand = gId("tbClearDemand");
    var tabs = null;
    // ------------------------------------------------------------------------
	function formLoad() {
        tabs = new window.xwf_tab({ divContainer: gId("divTab"), tabClick: tab_click });
        tabs.addTab({ key: "tabWi", text: "入库业务", control: tbWi });
        tabs.addTab({ key: "tabApply", text: "科室请领", control: tbApply });
        tabs.addTab({ key: "tabDemand", text: "科室需求", control: tbDemand });
        tabs.addTab({ key: "tabTpo", text: "采购订单", control: tbTpo });
        tabs.addTab({ key: "tabClearDemand", text: "清除需求池", control: tbClearDemand });
        init();
	}
</script>
<!-- init -->
<script type="text/javascript">
    function init() {
        var ctl = null;
        var all = document.getElementsByTagName("*");
        for (var i = 0; i < all.length; i++) {
            ctl = all[i];
            if (!ctl.id) continue;
            if (ctl.id.substring(0, 4).equals("_chk") || ctl.id.substring(0, 4).equals("_txt")) {
                ctl.fieldName = ctl.id.substring(4);
                arrDom.push(ctl);
            }
        }

        // ------------------------------------------------
        if (g.a.send("processType=h_spd.base_config.SystemParameter&actionType=getParameter", {}, true)) {
            if (g.a.OK) {
                var cReturn = g.a.cReturn;
                var dtb = cReturn.dtbParameter;
                var key = "", value = "";

                for (var i = 0; i < dtb.rowCount; i++) {
                    key = dtb.rows[i]["para_key"].value;
                    value = dtb.rows[i]["para_value"].value;
                    for (var j = 0; j < arrDom.length; j++) {
                        ctl = arrDom[j];
                        if (ctl.fieldName.equals(key)) {
                            if (ctl.type.equals("checkbox")) {
                                ctl.checked = value.equals("1");
                            }
                            else if (ctl.type.equals("text")) {
                                ctl.value = value;
                            }
                            else {
                                showWarn("尚未实现，请补充。");
                            }
                            break;
                        }
                    }
                }
            }
            else {
                return false;
            }
        }
        else {
            return false;
        }
    }
</script>

<!-- control.events -->
<script type="text/javascript">
    function tab_click(tab) {
        if (tab.key == "tabApply") {

        }
        else {

        }
        return true;
    }

    function btnSave_click() {
        save();
    }
    function btnSaveAndClose_click() {
        if (save()) {
            win.close();
        }
    }

    function btnClose_click() {
        win.close();
    }
</script>

<!-- save -->
<script type="text/javascript">
    function save() {
        var key = "", name = "", value = "";
        var parameterValues = "";
        var arrKeyVal = new Array();

        var ctl = null;
        // ------------------------------------------------
        for (var i = 0; i < arrDom.length; i++) {
            ctl = arrDom[i];
            key = ctl.fieldName;
            name = gId("_lbl" + ctl.fieldName).innerHTML;   
            if (ctl.type.equals("checkbox")) {
                value = ctl.checked ? "1" : "0";
            }
            else if (ctl.type.equals("text")) {
                value = ctl.value.trim();
            }
            else {
                showWarn("尚未实现，请补充。");
            }
            arrKeyVal.push(key + g.c.CHAR2 + name + g.c.CHAR2 + value);
        }
        parameterValues = arrKeyVal.join(g.c.CHAR1);

        // ------------------------------------------------
        if (g.a.send("processType=h_spd.base_config.SystemParameter&actionType=saveParameter", { parameterValues: parameterValues}, true)) {
            if (g.a.OK) {
                win.flashTitle("系统参数配置保存成功。");
            }
            else {
                return false;
            }
        }
        else {
            return false;
        }
        return true;
    }
</script>