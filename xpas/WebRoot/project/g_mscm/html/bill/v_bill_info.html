<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>记账单信息</title>
    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>
    <script src="../../../../res/control/uvform/xwf.uvform.js" type="text/javascript"></script>
    <script src="../../../../res/control/grid/xwf.grid.js" type="text/javascript"></script>
    <script src="../../../../res/control/grid/xwf.gridview.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/excel.js" type="text/javascript"></script>
    <script src="../../js/resource_print.js" type="text/javascript"></script>
    <script src="../../js/select_stock.js" type="text/javascript"></script>
    <script src="../../js/select_storage.js" type="text/javascript"></script>
    <script src="../../js/barcode_parse.js" type="text/javascript"></script>
    <link href="../../../../res_plugin/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
	    #tbLayout {
	        border-collapse: collapse;
	    }
	    #scanBox {
	        font-size: 1em;
	        font-family: Arial;
	        height: 26px;
	        line-height: 24px;
	        border: 2px solid #19A2D5;
	    }
        .fa-medkit {
            font-size: 1.5em;
            color: #19A2D5;
        }
        .import-alert {
            font-weight: bolder;
        }
        .a-small {
            font-size: 0.9em;
            color: Blue;
        }
        .a-small:hover {
            cursor: pointer;
            color: #19A2D5;
        }
        #divDC {
            width: 978px;
            padding: 5px 0 5px 5px;
            border: solid 1px lightgray;
            border-radius: 3px;
        }
	    .PanelA {
	        width: 963px;
	        margin-left: auto;
	        margin-right: auto;
	    }
        #tbForm {
            width: 100%;
        }
        #tbForm thead {
            display: none;
        }
        #tbForm tbody tr {
            display: block;
            font-size: 0;
            margin-bottom: 10px;
        }
        #tbForm tbody tr:last-child {
            margin: 0;
        }
        #tbForm tbody td {
            display: inline-block;
            padding: 0;
            line-height: 30px;
        }
        #tbForm tbody td:nth-child(odd) {
            width: 100px;
        }
        #tbForm tbody td:nth-child(even) {
            width: 220px;
        }
        #tbForm tbody td input{
            width: 208px;
            text-indent: 10px;
        }
        #tbForm tbody tr:nth-child(4) td:nth-child(2),
        #tbForm tbody tr:nth-child(5) td:nth-child(2) {
            width: 860px;
        }
        #tbForm tbody tr:nth-child(4) td:nth-child(2) input,
        #tbForm tbody tr:nth-child(5) td:nth-child(2) input {
            width: 848px;
        }
        .bill-dtl {
            margin-top: 10px;
        }
        #divGridDtl {
            height: 250px;
        }
    </style>
</head>
<body>
    <div id="divDC" class="ScreenCenter"></div>
    <div class="PanelA">
        <form id="frm" action="" target="">
            <table id="tbForm" class="tbForm">
                <thead>
                    <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>原记账单单号</td>
                        <td>
                            <input type="text" id="_cbill_sp_key" disabled="disabled" />
                        </td>
                        <td>院方</td>
                        <td>
                            <input type="text" class="divInputA" id="_gmedical_name" disabled="disabled" />
                        </td>
                        <td>供应商</td>
                        <td>
                            <input type="text" id="_gcompany_name" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td>供应商记账金额</td>
                        <td>
                            <input type="text" id="_cbill_sp_amount" disabled="disabled" />
                        </td>
                        <td>结算返点金额</td>
                        <td>
                            <input type="text" id="_cbill_sp_amount_rt" disabled="disabled" />
                        </td>
                        <td>院方记账金额</td>
                        <td>
                            <input type="text" id="_cbill_hp_amount" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td>记账日期</td>
                        <td>
                            <input type="text" id="_cbill_sp_date" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td>摘要</td>
                        <td>
                            <input type="text" id="_cbill_sp_summary" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td>备注</td>
                        <td>
                            <input type="text" id="_cbill_remark" disabled="disabled" />
                        </td>
                    </tr>
                </tbody>
            </table>
            <input type="hidden" id="_cbill_sp_id" value="0" />
            <input type="hidden" id="_ccompany_id_mi" value="0" />
            <input type="hidden" id="_ccompany_id" value="0" />
            <input type="hidden" id="_castatus" value="0" />
        </form>
    </div>
    <div class="PanelA bill-dtl">
        <div id="divGridDtl"></div>
    </div>
</body>
</html>
<script type="text/javascript">
    var frmParent = null;
    var repNotifyId = 0;
    var companyId = 0;
    var userName = "";
    var repreqDtl = null;
    // ------------------------------------------------------------------------
    function formLoad() {
        frmParent = win.parentWindow.frm;
        companyId = topWin.officeId;
        userName = topWin.userName
        vf.css(gId("tbForm"));
        vf.addExtraButton({ key: "extraConfirmBtn", text: "确认" });
        vf.addExtraButton({ key: "extraCancelConfirmBtn", text: "取消确认" });
    }

    vf.afterAddnew = function() {

    }
    vf.afterMove = function() {
        var astatus = frm._castatus.value;
        if (astatus.equals("-1")) {
            vf.buttons["extraConfirmBtn"].style.display = "none";
            vf.buttons["extraCancelConfirmBtn"].style.display = "block";
        } else {

            vf.buttons["extraConfirmBtn"].style.display = "block";
            vf.buttons["extraCancelConfirmBtn"].style.display = "none";
        }
        showGridDtl();
    }
    vf.beforeClick = function(jsonProp) {
        var btnKey = jsonProp.buttonKey;
        var keys = frm._cbill_sp_id.value;
        var astatus = frm._castatus.value;

        if (btnKey.equals("extraConfirmBtn")) {
            if (g.a.send("processType=g_mscm.bill.Voucher&actionType=confirmBill", { keys: keys, viewKey: 'v_bill_sp_mscm' }, true)) {
                if (g.a.OK) {
                    var cReturn = g.a.cReturn;
                    showMsg("记账单已确认成功！");
                    win.parentWindow.gridView.refresh();
                    closed();
                } else {
                    return false;
                }
            } else {
                return false;
            }

        } else if (btnKey.equals("extraCancelConfirmBtn")) {
            if (g.a.send("processType=g_mscm.bill.Voucher&actionType=cancelBill", { keys: keys, viewKey: 'v_bill_sp_mscm' }, true)) {
                if (g.a.OK) {
                    var cReturn = g.a.cReturn;
                    showMsg("记账单取消确认成功！");
                    win.parentWindow.gridView.refresh();
                    closed();
                } else {
                    return false;
                }
            } else {
                return false;
            }
        }
    }

    function showGridDtl() {
        repreqDtl = null;
        var gridViewFilter = "1=0";

        if (frm._cbill_sp_id.value != null) {
            gridViewFilter = "bill_sp_id = '" + frm._cbill_sp_id.value + "'";
        }
        if (repreqDtl == null) {
            var prop = {
                divContainer: gId("divGridDtl"),
                viewKey: "v_bill_detail",
                viewFilter: gridViewFilter,
                toolbarVisible: true,
                viewForm: ""
            };
            repreqDtl = new window.xwf_gridview(prop);
        } else {
            repreqDtl.setViewFilter("");
        }
        var dtb = repreqDtl.dtbViewData;
        if (dtb.rowCount > 0) {
            
        }
    }
</script>