<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8">
    <title>补货通知单</title>
    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>

    <script src="../../../../res/control/uvform/xwf.uvform.js" type="text/javascript"></script>
    <script src="../../../../res/control/grid/xwf.grid.js" type="text/javascript"></script>
    <script src="../../../../res/control/grid/xwf.gridview.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.css.js" type="text/javascript"></script>

    <script src="../../../../res/jscript/excel.js" type="text/javascript"></script>
    <script src="../../js/resource_print.js" type="text/javascript"></script>
    <script src="../../js/select_stock.js" type="text/javascript"></script>
    <script src="../../js/select_storage.js" type="text/javascript"></script>
    <script src="../../js/barcode_parse.js" type="text/javascript"></script>
    <link href="../../../../res_plugin/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        body {
        }
        #tbLayout {
            border-collapse: collapse;
        }
        #scanBox {
            font-size: 1em;
            font-family: Arial;
            height: 26px;
            line-height: 24px;
            border: 2px solid #19A2D5;
        }
        .PanelA {
            width: 980px;
            margin-left: auto;
            margin-right: auto;
        }
        .fa-medkit {
            font-size: 1.5em;
            color: #19A2D5;
        }
        .import-alert {
            font-weight: bolder;
        }
        .a-small {
            font-size: 0.9em;
            color: Blue;
        }
        .a-small:hover {
            cursor: pointer;
            color: #19A2D5;
        }
    </style>
</head>
<body>
    <div id="divDC"  style="width:1000px" class="ScreenCenter"></div>
    <div class="PanelA">
    	<form id="frm" action="" target="">
            <table id="tbForm" class="tbForm" style="width:100%">
            	<tr>
            		<th style="width: 14%;"></th>
                    <th style="width: 19%;"></th>
                    <th style="width: 14%;"></th>
                    <th style="width: 19%;"></th>
                    <th style="width: 14%;"></th>
                    <th style="width: 19%;"></th>
            	</tr>
            	<tr>
                    <td>通知单号</td>
                    <td><input type="text" id="_crn_key" disabled="disabled" /></td>
                    <td>供应商名称</td>
                    <td><input type="text" id="_gcompany_name" disabled="disabled" /></td>
                    <td>院方</td>
                    <td><input type="text" id="_gmedical_name" disabled="disabled"/></td>
                    
                </tr>
                <tr>
                    <td>通知日期</td>
                    <td><input type="text" id="_crn_date" disabled="disabled"/></td>
                    <td>送达日期</td>
                    <td><input type="text" id="_crn_delivery_date" disabled="disabled"/></td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
            </table>
            <input type="hidden" id="_ccompany_id" value="0"/>
            <input type="hidden" id="_crep_notify_id" value="0"/>
            <input type="hidden" id="_castatus" value="0"/>
        </form>
    </div>
    <div class="PanelA" style="margin-top:5px;">
    	<!--div id="IgnoreBtn" style="margin-bottom: 10px; margin-top: 5px;"><input type="button" value="忽略明细" style="height:30px;font-size:0.9em;font-family:微软雅黑" onclick="btnIgnore_click()"/>&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" value="取消忽略" style="height:30px;font-size:0.9em;font-family:微软雅黑" onclick="btnCancelIgnore_click()"/></div-->
        <div id="divGridDtl" style="height:250px;cursor:pointer;"></div>
        <div id="divBackgroundCover" style="display: none;"></div>
    </div>
</body>
</html>
<!-- formLoad -->
<script type="text/javascript">
	var repreqDtl = null;
    function formLoad() {   	
        vf.css(gId("tbForm"));
		var restHeight = win.p.height - gId("divGridDtl").offsetTop - 20;
        if (restHeight < 250) {
            restHeight = 250;
        }
        gId("divGridDtl").style.height = restHeight + "px";   	
    }    
    
    //--- vf事件 ---- 
	vf.afterMove = function(){
	    showGridDtl();	
	}
	vf.beforeClick = function(jsonProp){	
	   	return true;
	}

    //------------------------------------------------------------------------
    function showGridDtl() {
        if (frm._crep_notify_id.value != 0) {
            var gridViewFilter = "rep_notify_id=" + frm._crep_notify_id.value;
            if (repreqDtl == null) {
                var prop = {
                    divContainer: gId("divGridDtl"),
                    viewKey: "v_rep_notify_dtl_mscm",
                    viewFilter: gridViewFilter,
                    toolbarVisible:true,
                    viewForm: "project/g_mscm/html/advice/v_rep_notify_dtl_mscm.html",
                    jsonToolbar: { height: "M", onclick: toolbarClick }
                };
                repreqDtl = new window.xwf_gridview(prop);
                /*  暂时不需要 添加明细   */
            	//repreqDtl.toolbar.addBar({ type: "button", key: "btnAdd", text: "<i class='fa fa-plus-square' aria-hidden='true'></i>  添加明细", align: "left", style: "Grid", icon: null });
            	repreqDtl.toolbar.addBar({ type: "button", key: "btnDelete", text: "<i class='fa fa-minus-square' aria-hidden='true'></i>  删除记录", align: "left", style: "Grid", icon: null }); 
            } else {
                repreqDtl.setViewFilter(gridViewFilter);
            }
            var dtb = repreqDtl.dtbViewData;
            if (dtb.rowCount > 0) {
                //clearEditForm();
            }  
        }
    }

    function toolbarClick(para){
    	if (para.key.equals("btnAdd")) {	
            btnAdd_click();
        } else if (para.key.equals("btnDelete")) {
            btnDelete_click();
        } else {
            showErr("unknown button " + para.key);
        }
    }
    
    function btnAdd_click(){
    	repreqDtl.addnew();
    }
    
    function btnDelete_click(){
    	var arrSelectedRows = new Array();
    	for(var i = 0; i < repreqDtl.dtbViewData.rowCount;i++){
    		if(repreqDtl.dtbViewData.rows[i].checked){
    			arrSelectedRows.push(repreqDtl.dtbViewData.rows[i]["rep_notify_dtl_id"].value);
    		}
    	}
    	if(arrSelectedRows.length == 0){
    		showErr("请勾选需要删除的明细");
    		return false;
    	}
    	var confirm = showConfirm("删除明细后无法恢复，请谨慎操作");
    	if (confirm) {
    		var keys = arrSelectedRows.join(",");
	    	if (g.a.send("processType=g_mscm.advice.Replenishment&actionType=notifyDeleteDetail", { keys: keys, viewKey: 'v_rep_notify_dtl_mscm' }, true)) {
	            if (g.a.OK) {
	                var cReturn = g.a.cReturn;
	                showMsg("选中的明细已删除！");
	                showGridDtl();
	            } else {
	                return false;
	            }
	        } else {
	            return false;
	        }
    	}   	
    }
</script>
