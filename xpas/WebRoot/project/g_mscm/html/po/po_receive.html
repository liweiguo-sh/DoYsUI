<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>订单接收</title>
    <script src="../../../../res/jscript/xwf.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.const.js" type="text/javascript"></script>
    <script src="../../../../res/jscript/xwf.datatable.js" type="text/javascript"></script>

    <script src="../../../../res/jscript/xwf.main.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/lib/jquery/jquery.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/js/zui.js" type="text/javascript"></script>
    <script src="../../../../res_plugin/zui-1.8.1-dist/js/zuiExt.js" type="text/javascript"></script>
    <link href="../../../../res_plugin/zui-1.8.1-dist/css/zui.css" rel="stylesheet" type="text/css" />
    <link href="../../../../res_plugin/zui-1.8.1-dist/css/zuiExt.css" rel="stylesheet" type="text/css" />
    <script src="../../../g_spd/html/wi/pako.min.js" type="text/javascript"></script>
    <script src="../../../g_spd/html/wi/jquery.qrcode.min.js" type="text/javascript"></script>
</head>
<body>
<div class="container-fluid" style="min-width:600px;">
	<div class="row with-padding">
        <div class="col-xs-12 with-padding" >
            <input type="button" id="upload" class="btn btn-success btn-block" value="选择订单数据文件导入订单" onclick="onpenfile()"/>
        </div>
        <div class="col-xs-12 with-padding" >
        		<div class="alert alert-warning-inverse with-icon">
				    <i class="icon-info-sign"></i>
				    <div class="content"><strong>注意!</strong> 请选择内网导出的采购订单数据文件噢</div>
				  </div>
        </div>
    </div>
    <div class="row with-padding">
		<div class="col-xs-12">
			<textarea id="_cPo_contents" style="width:100%;height:300px;" class="form-control"></textarea>
		</div>
	</div> 
	<!-- <div class="row with-padding">
        <div class="col-xs-3" style="width:35%">
            <button class="btn btn-success" onclick="btnCommit_click()">订单接收</button>
            <input type="button" id="upload" class="btn btn-success" value="上传订单" onclick="onpenfile()"/>
            <button class="btn" onclick="win.close();">关闭窗口</button>
        </div>
		<div class="col-xs-9" style="width:65%">
			<div class="alert alert-default-inverse with-icon alert-mini">
			  <i class="icon-info-sign"></i>
			  <div class="content">请将下面输入区聚焦，然后扫描对应采购订单二维码</div>
			</div>
		</div>
	</div>   
	<div class="row with-padding">
		<div class="col-xs-12">
			<textarea id="_cPo_contents" style="width:100%;height:500px;" class="form-control"></textarea>
		</div>
	</div>    -->
</div>
</body>
	
</html>

<!-- formLoad -->
<script type="text/javascript">
	// ----------------------------------------------------
	$(document).ready(function () {
    });

    function formLoad() {
        $("#_cPo_contents").focus();
    }

    function onpenfile() {
        var prop = {
            parent: win
        };
        var para = {
            target: "com.xznext.util.UploadFileBaseCos",
            callback: uploadCallback
        };
        topWin.uploadFile(prop, para);
        return false;
    }

    function uploadCallback(para) {
        var fileServer = para.filePath + para.fileName;
        if (g.a.send("processType=g_mscm.i_spd.PO&actionType=poFromFile", { filePath: fileServer }, false)) {
            console.log(g.a)
            if (g.a.OK) {
                $("#_cPo_contents").val(g.a.cReturn.errorMsg);
                //if (g.a.cReturn.errorMsg != "") {
                //    zuiExt.msg({ msg: g.a.cReturn.errorMsg, type: "error" });
                //}
                //else {
                //    zuiExt.msg({ msg: "订单接收成功", type: "success" });
                //}
            }
            else {
                $("#_cPo_contents").val(g.a.cReturn.errorMsg);
            }
        }
    }

	function OnKeyDown(e){
		if(e.keyCode==13){
			alert(gId("_cPo_contents").value);
			btnCommit_click();
		}
	}
    function btnCommit_click() {
            var contents = gId("_cPo_contents").value;
            if(!zuiExt.strNotNull(contents)){
            	zuiExt.msg({msg:"请录入订单信息",type:"danger"});
            	$("#_cPo_contents").focus();
            	return;
            }
            if (g.a.send("processType=g_mscm.i_spd.PO&actionType=poFromScan", { pocontent: contents }, false)) {
            	console.log(g.a)
                if (g.a.OK) {
                	zuiExt.msg({msg:"订单接收成功",type:"success"});
		            $("#_cPo_contents").val("").focus();
                }
                else {
                	zuiExt.msg({msg:g.a.ErrMessage,type:"danger"});
                }
            }
    }
</script>
