<!DOCTYPE html>
<html>
<head>
	<title>供应链协同平台 - 登录</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
	<!-- zui -->
  <link href="../../../res_plugin/zui-1.8.1-dist/css/zui.min.css" rel="stylesheet">
	<script src="../../../res_plugin/jquery/jquery-3.1.1.min.js" type="text/javascript"></script>
	<script src="../../../res_plugin/jquery/jquery_md5.js" type="text/javascript"></script>
	<script src="../../../res_plugin/zui-1.8.1-dist/js/zui.min.js" type="text/javascript"></script>
	<script src="assets/js/xwf.js"></script>
	<script src="../../../res/jscript/xwf.ajax.js" type="text/javascript"></script>
	<script src="../../../res/jscript/xwf.const.js" type="text/javascript"></script>
	<script src="../../../res/control/window/xwf.window.js" type="text/javascript"></script>

	<script src="../../../res/jscript/xwf.login.js" type="text/javascript"></script>

	<style type="text/css">
		body {
			background-color: White;
			font-family:微软雅黑;
			margin: 0px;
		}
		#tbLayout {
			table-layout: fixed;
			border-collapse: collapse;			
			margin: auto;
			border: solid 0px red;			
		}
		#tbLayout td {
			padding: 0px;
			border: dotted 0px red;
		}

		.divUserkey {
			font-size: 12pt;
		}
		.txtUserkey {
			background-repeat: no-repeat;
			background-position: left center;
			padding-left: 50px;
			height: 45px;
			width: 290px;
			border-radius: 4px;
			border: solid 1px #446fa6;
		}
		#txtUserkey, #txtPassword {
			padding: 0px 5px 0px 10px;
			border: solid 0px red;
			line-height: 40px;
			height: 43px;
			width: 215px;
			font-size: 12pt;
			border-radius: 4px;
		}
		#txtUserkey:focus, #txtPassword:focus {
			outline: none;
		}
		#chkRemember {
			float: left;
			margin: 4px 4px 0 0;
		}
		#btnLogin {
			font-size: 14pt;
			line-height: 36px;
			background-color: #e8ebf2;
			border: solid 1px Green;
			padding-right: 5px;
			width: 120px;
			height: 36px;
			border-radius: 3px;
		}
		#btnLogin:hover {
			background-color: #fe970c;
			border: solid 1px red;
		}

		.spanVersion {
			font-size: 9pt;
			color: #c0c0c0;
		}
		.edit {
			position: absolute;
			top: -200%;
			left: 0;
			z-index: 1;
			width: 100%;
			height: 100%;
			transition: all .2s;
		}
		.edit.edit-show {
			top: 0;
		}
		.edit .mask {
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, .5);
		}
		.edit .edit-container {
			position: absolute;
			top: 50%;
			left: 50%;
			width: 300px;
			height: 300px;
			margin-top: -200px;
			margin-left: -150px;
			padding: 20px;
			box-sizing: border-box;
			background-color: #fff;
			border-radius: 10px;
		}
		.edit .edit-container > label {
			margin-bottom: 20px;
		}
		.edit .edit-container .input-control {
			margin-bottom: 12px;
		}
		.edit .edit-container .btn.btn-primary {
			width: 100%;
			margin-top: 30px;
		}
	</style>
</head>
<body onload="formLoad();">
	<table id="tbLayout">
		<tr>
			<td style="font-weight:bold;font-size:14pt;padding-top:15px;">
				<img src="../images/weixin/login/login.png" alt="" style="width:96px;height:96px;" />
				医疗供应链协同平台<span class="spanVersion"> v1.0</span>
			</td>
		</tr>
		<tr>
			<td style="text-align:center;padding:5px 0px 20px 0px;background-image:url('../images/login_line1.png');background-repeat:no-repeat;background-position:center center;">
			</td>
		</tr>
		<tr>
			<td>
				<div class="divUserkey" style="padding:30px 0px 5px 0px;">用户名称</div>
				<div class="txtUserkey" style="background-image:url('../images/weixin/login/userkey.png');">
					<input type="text" id="txtUserkey" value="" />
				</div>
				<div class="divUserkey" style="padding:30px 0px 5px 0px;">登录密码</div>
				<div class="txtUserkey" style="background-image:url('../images/weixin/login/password.png');">
					<input type="password" id="txtPassword" value="" />
				</div>
				<div style="padding:10px 0px 10px 0px;">
					<input type="checkbox" id="chkRemember" /><label for="chkRemember">记住密码</label>
				</div>
				<div style="padding:0px 0px 10px 160px;">
					<input type="button" id="btnLogin" value="登&nbsp;&nbsp;录" onclick="btnLogin_click();" />
				</div>
			</td></tr>
		<tr>
			<td style="text-align:center;padding:20px 0px 20px 0px;font-size:12pt;color:Gray;">
				forten-tech.com @2018
			</td>
		</tr>
	</table>
	<div class="edit">
		<div class="mask"></div>
		<div class="edit-container">
			<label>修改密码</label>
			<div class="input-control has-label-left ha-label-right">
				<input id="origin-password" type="password" class="form-control" placeholder="" />
				<label for="origin-password" class="input-control-label-left">原始密码</label>
			</div>
			<div class="input-control has-label-left ha-label-right">
				<input id="new-password" type="password" class="form-control" placeholder="" />
				<label for="new-password" class="input-control-label-left">新密码</label>
			</div>
			<div class="input-control has-label-left ha-label-right">
				<input id="confirm-password" type="password" class="form-control" placeholder="" />
				<label for="confirm-password" class="input-control-label-left">确认密码</label>
			</div>
			<button type="button" class="btn btn-primary" onclick="modifyPassword();">确认</button>
		</div>
	</div>
</body>
</html>

<!-- login -->
<script type="text/javascript">
	var userKey = "";
	var originPassword = gId('origin-password');
	var newPassword = gId('new-password');
	var confirmPassowrd = gId('confirm-password');
  function formLoad() {
    // -- 2. 常规登录 -----------------------------------
    window.Weixin = true;
    var jsonPara = {
      urlMainDefault: "weixin_main.html",
      txtUserkey: txtUserkey,
      txtPassword: txtPassword,
      chkRemember: chkRemember
    };
    initLogin(jsonPara);
    var loginout = window.location.search;
    if (loginPara.chkRemember && loginPara.txtPassword) {
    	if (loginout != "?loginout=1" )
    	btnLogin_click();
    }
    return ;
    // -- 1. 微信自动登录 -------------------------------
    if (g.a.send("processType=com.xznext.xpas.Login&actionType=getLoginStatus", {}, true)) {
      if (g.a.OK) {
          var c = g.a.cReturn;
          if (c.login == 1) {
              showMain();
              return;
          }
      }
    }
  }

	//-------------------------------------------------------------------------
	function btnLogin_click() {
		try {
			userKey = gId('txtUserkey').value.trim();
			loginSystem();
		}
		catch (e) {
			alert(e.toString());
		}
	}

	function changePassword() {
    // showMsg("请到PC端登录页面修改登录密码，谢谢！");
    $('.edit').addClass('edit-show');
    originPassword.focus();
    originPassword.value = '';
    newPassword.value = '';
    confirmPassowrd.value = '';
	}

	function modifyPassword () {
		if (!checkPassword()) return;

		var param = {
			oldPassword: $.md5(userKey.toLowerCase() + "xwf.js" + originPassword.value.trim().toLowerCase()),
			newPassword: $.md5(userKey.toLowerCase() + "xwf.js" + newPassword.value.trim().toLowerCase())
		}

		if (g.a.send("processType=com.xznext.xpas.Login&actionType=changePassword", param, true)) {
			if (g.a.OK) {
				new $.zui.Messager('密码修改成功!', {
	        type: 'success'
	      }).show();
				$('.edit').removeClass('edit-show');
				gId('txtPassword').value = newPassword.value.trim();
			} else {
				return false;
			}
		}
		else {
			return false;
		}
	}

	function checkPassword() {
		originPassword.value = originPassword.value.trim();
		newPassword.value = newPassword.value.trim();
		confirmPassowrd.value = confirmPassowrd.value.trim();

		if (originPassword.value.equals("")) {
			new $.zui.Messager('请输入原密码!', {
        type: 'warning'
      }).show();
			originPassword.focus();
			return false;
		}
		if (newPassword.value.equals("")) {
			new $.zui.Messager('请输入新密码!', {
        type: 'warning'
      }).show();
			newPassword.focus();
			return false;
		}
		if (newPassword.value.equals(originPassword.value)) {
			new $.zui.Messager('原密码与新密码不能相同!', {
        type: 'warning'
      }).show();
			newPassword.value = "";
			confirmPassowrd.value = "";
			newPassword.focus();
			return false;
		}
		if (confirmPassowrd.value.equals("")) {
			new $.zui.Messager('请确认密码!', {
        type: 'warning'
      }).show();
			confirmPassowrd.focus();
			return false;
		}
		if (!newPassword.value.equals(confirmPassowrd.value)) {
			new $.zui.Messager('新密码与确认密码不一致!', {
        type: 'warning'
      }).show();
			newPassword.value = "";
			confirmPassowrd.value = "";
			newPassword.focus();
			return false;
		}
		return true;
	}
</script>
