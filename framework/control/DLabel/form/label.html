<!DOCTYPE html>
<html>
<head>
    <title>标签定义</title>
    <link href="../../../../plugin/element/index.css" rel="stylesheet" />

    <script src="../../../../plugin/vue.js"></script>
    <script src="../../../../plugin/element/index.js"></script>

    <script src="../../../core/prototype.js"></script>
    <script src="../../../core/core.js"></script>

    <style type="text/css">
        body {
            overflow-x: hidden;
        }

        .el-col-base {
            padding-right: 20px;
        }
    </style>
</head>
<body>
    <div id="app" style="width:900px;height:500px;">
        <el-tabs v-model="activeTabName" type="card">
            <el-tab-pane label="基本信息" name="base">
                <el-form label-width="120px" label-position="right">
                    <el-row>
                        <el-col :span="span[1]" class="el-col-base">
                            <el-form-item label="宽度">
                                <el-input v-model="head.width"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="span[2]" class="el-col-base">
                            <el-form-item label="高度">
                                <el-input v-model="head.height"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <el-row>
                        <el-col :span="span[2]" class="el-col-base">
                            <el-form-item label="打印机点数">
                                <el-select v-model="head.point" style="width:100%">
                                    <el-option value="200" label="200"></el-option>
                                    <el-option value="300" label="300"></el-option>
                                    <el-option value="400" label="400"></el-option>
                                    <el-option value="600" label="600"></el-option>
                                    <el-option value="1200" label="1200"></el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <el-row>
                        <el-col :span="span[0]" class="el-col-base">
                            <el-form-item label="图片路径">
                                <el-input v-model="head.imageBaseUrl"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>
                </el-form>
            </el-tab-pane>
            <!-- 字段集 -->
            <el-tab-pane label="字段集" name="fields">
                <el-row :gutter="8" style="margin-bottom:5px;">
                    <el-col :span="6" class="el-col-base">
                        字段名
                    </el-col>
                    <el-col :span="12" class="el-col-base">
                        字段值
                    </el-col>
                </el-row>
                <el-row v-for="field,idx in fields" :key="idx" :gutter="8" style="margin-bottom:5px;">
                    <el-col :span="6" class="el-col-base">
                        <el-input v-model="field.k" @change="fieldNameChange(idx)"></el-input>
                    </el-col>
                    <el-col :span="12" class="el-col-base">
                        <el-input v-model="field.v"></el-input>
                    </el-col>
                    <el-col :span="6">
                        <el-button-group>
                            <el-button type="danger" v-if="field.k" @click="fieldDelete(idx)" title="删除" icon="el-icon-delete"></el-button>
                        </el-button-group>
                    </el-col>
                </el-row>
            </el-tab-pane>
            <!-- 条码、文本、图片 -->
            <el-tab-pane label="Script: AfterCompute" name="jsAfterCompute">
                <el-input v-model="head.scriptAfterCompute" type="textarea" :rows="20" placeholder="请输入脚本" spellcheck="false"></el-input>
            </el-tab-pane>
        </el-tabs>
    </div>
</body>
</html>

<!-- appInit -->
<script>
    var app = new Vue({
        el: '#app',
        data: {
            span: [24, 12, 12],
            activeTabName: "base",

            head: {},
            fields: [],

            remark: ""
        },
        methods: {
            fieldNameChange(idx) {
                let field = this.fields[idx];
                if (field.k != "" && idx == this.fields.length - 1) {                    
                    this.fields.push({ "k": "", "v": "" });
                } 
            },
            fieldDelete(idx) {
                this.fields.splice(idx, 1);
            }
        }
    });
</script>

<!-- winLoad -->
<script>
    function winLoad() {
        app.head = win.para.head;

        let fields = [], k, v;
        for (k in win.para.fields) {
            v = win.para.fields[k];
            fields.push({ k: k, v: v }); 
        }
        fields.push({ k: "", v: "" });
        app.fields = fields;

        // ------------------------------------------------
        win.addEventListener("afterClose", () => {
            let fields = {};
            for (let i = 0; i < app.fields.length; i++) {
                let field = app.fields[i];
                if (field.k) {
                    fields[field.k] = field.v;
                }
            }

            if (win.para.callback) {
                win.para.callback({
                    _this: win.para._this,
                    fields: fields
                });
            }
            app.$destroy();
        });
    }
</script>