<!DOCTYPE html>
<html>
<head>
    <title>标签窗口</title>
    <link href="../css/designer.css" rel="stylesheet" />

    <script src="../../../core/doys.js"></script>

    <script src="../js/label.js"></script>
    <script src="../js/element.js?v=1"></script>

    <style type="text/css">
        body {
            font-family: 微软雅黑;
        }

        #divButtons input[type=button] {
            height: 36px;
            line-height: 36px;
            min-width: 100px;
        }
    </style>
</head>
<body>
    <div>menu</div>
    <div>toolbar</div>
    <div id="divButtons">
        <input type="button" id="btnLoadLabel" onclick="btnLoadLabel_click();" value="加载标签" />
        &nbsp;&nbsp;&nbsp;&nbsp;
        <input type="button" id="btnNewLabel" onclick="btnNewLabel_click();" value="新标签" />
        <input type="button" id="btnSaveLabel" onclick="btnSaveLabel_click();" value="保存标签" />
        &nbsp;&nbsp;&nbsp;&nbsp;
        <input type="button" id="btnAddElement" onclick="btnAddElement_click();" value="添加新元素" />
        <input type="button" id="btnDelElement" onclick="btnDelElement_click();" value="删除元素" />
    </div>
    <table id="tbMain" class="tbMain">
        <tr>
            <td id="tdMainLeft" class="tdMain" style="width:300px;">属性区</td>
            <td id="tdMainRight" class="tdMain">
                <div id="divCanvas" style="border:solid 2px gray;margin:15px;padding:15px;position:relative"></div>
            </td>
        </tr>
    </table>
    <hr />
    <div>以下测试区</div>
    <textarea id="txtJson" rows="12" style="width:800px;" spellcheck="false"></textarea>
</body>
</html>

<!-- winLoad -->
<script>
    let tbMain = gId("tbMain");
    let tdMainLeft = gId("tdMainLeft");
    let tdMainRight = gId("tdMainRight");

    let divCanvas = gId("divCanvas");
    let txtJson = gId("txtJson");
    // ------------------------------------------------------------------------
    function winLoad() {
        winResize();

        btnLoadLabel_click();
    }

    function winResize() {
        let width = document.documentElement.clientWidth;
        let heigth = document.documentElement.clientHeight;

        tdMainRight.style.width = (width - tdMainLeft.offsetWidth) + "px";
        divCanvas.style.height = (heigth - tbMain.offsetTop - 300) + "px";
    }
</script>
<!-- controls event -->
<script>
    function btnSetDraggable1_click() {
        setUnDraggable();
        setDraggable(divE1);
    }
    function btnSetDraggable2_click() {
        setUnDraggable();
        setDraggable(divE2);
    }

    function btnCancelDraggable_click() {
        setUnDraggable();
    }

    function setDraggable(domDrag) {
        domDrag.ondragstart = function (evt) {
            ondragstart(evt, divCanvas, domDrag);
        };
        domDrag.ondragend = function (evt) {
            ondragend(evt, domDrag);
        };

        domDrag.draggable = true;
        domDrag.className = "canDrag";
    }
    function setUnDraggable() {
        divE1.draggable = false;
        divE1.className = "cantDrag";
        divE2.draggable = false;
        divE2.className = "cantDrag";
    }
</script>

<!-- main-drag -->
<script>
    let dragOffsetX, dragOffsetY;
    function ondragstart(evt, domContainer, domDrag) {
        dragOffsetX = domContainer.offsetLeft;                          // -- 容器偏移量 --
        dragOffsetX += domContainer.clientLeft;                         // -- 容器边框宽度 --
        dragOffsetX += g.x.getStyleValue(domContainer, "paddingLeft");  // -- 容器padding --
        dragOffsetX += g.x.getStyleValue(domDrag, "marginLeft");        // -- 拖动对象margin --
        dragOffsetX += domDrag.clientLeft;                              // -- 拖动对象边框宽度 --
        dragOffsetX += evt.offsetX;                                     // -- 拖动对象偏移量(鼠标坐标相对于拖动对象) --

        dragOffsetY = domContainer.offsetTop;                           // -- 容器偏移量 --
        dragOffsetY += domContainer.clientTop;                          // -- 容器边框宽度 --
        dragOffsetY += g.x.getStyleValue(domContainer, "paddingTop");   // -- 容器padding --  19
        dragOffsetY += g.x.getStyleValue(domDrag, "marginTop");         // -- 拖动对象margin --  15
        dragOffsetY += domDrag.clientTop;                               // -- 拖动对象边框宽度 --
        dragOffsetY += evt.offsetY;                                     // -- 拖动对象偏移量(鼠标坐标相对于拖动对象) --
    }
    function ondragend(evt, domDrag) {
        domDrag.style.left = (evt.clientX - dragOffsetX) + "px";
        domDrag.style.top = (evt.clientY - dragOffsetY) + "px";
    }
</script>
<!-- main-paint -->
<script>
    function btnPaint1_click() {
        var draw = gId("divE1");
        var context = draw.getContext("2d");

        context.fillStyle = "#A088F5";
        context.fillRect(50, 30, 150, 75);
    }
    function btnPaint2_click() {
        var draw = gId("divE2");
        var context = draw.getContext("2d");

        context.fillStyle = "#F588A0";
        context.fillRect(60, 20, 130, 95);
    }
</script>

<script>
    let lbl;
    function btnLoadLabel_click() {
        let content = getLabelString();

        if (lbl == null) {
            let para = {
                container: divCanvas,
                content: content
            }

            lbl = new Label(para);
        }
        else {
            lbl.loadLabel(content);
        }
    }
    function btnNewLabel_click() {
        let content = "";

        if (lbl == null) {
            let para = {
                container: divCanvas,
                content: content
            }

            lbl = new Label(para);
        }
        else {
            lbl.loadLabel(content);
        }
    }
    function btnSaveLabel_click() {
        txtJson.value = lbl.toJson();
    }

    function btnAddElement_click() {
        if (lbl) {
            lbl.addBlankTextElement();
        }
    }
    function btnDelElement_click() {
        if (lbl) {
            lbl.delElement();
        }
    }

    function getLabelString() {
        let jsonString = txtJson.value;

        if (jsonString.equals("")) {
            txtJson.value = getMock_LvKeMeng();

            //txtJson.value = getMock1();
            
            jsonString = txtJson.value;
        }
        
        return jsonString;
    }
    function getMock1() {
        return `
{
    "head": {
        "width": 100,
        "height": 80
    },
    "fields": [
        {
            "k": "客户代码",
            "v": "C001001"
        },
        {
            "k": "客户名称",
            "v": "上海样例科技有限公司"
        },
        {
            "k": "地址",
            "v": "上海样例路1234号"
        }
    ],
    "images": [
        {
            "k": "img1",
            "v": "https://cn.vuejs.org/images/imooc-sponsor2.png"
        },
        {
            "k": "img2",
            "v": "http://www.masocloud.com/DoYsUI/project/aprint/image/main/sub_system.png"
        },
        {
            "k": "img3",
            "v": "http://www.masocloud.com/DoYsUI/project/aprint/image/main/doys.png"
        }
    ],
    "elements": [
        {
            "head": {            
                "name": "元素1 - 文本",
                "elementType": "text"
            },
            "position": {
                "layer": 1,
                "width": 150,
                "height": 100,
                "left": 40,
                "top": 40
            },
            "sections": [
                {
                    "pos": 0,
                    "type": "fixed",
                    "value": "元素1-固定值A",
                    "format": ""
                },
                {
                    "pos": 1,
                    "type": "field",
                    "value": "客户名称",
                    "format": ""
                },
                {
                    "pos": 2,
                    "type": "symbol",
                    "value": "GS",
                    "format": ""
                },
                {
                    "pos": 3,
                    "type": ""
                }
            ],
            "font": {
                "name": "微软雅黑",
                "size": 18,
                "italic": true,
                "wordWrap": true,
                "lineHeight": 30
            },
            "frame": {}
        },
        {
            "head": {
                "name": "元素2 - 空",
                "elementType": "text"
            },
            "position": {
                "layer": 5,
                "hidden": true,
                "width": 380,
                "height": 70,
                "left": 542,
                "top": 21,
                "textAlign": "center",
                "verticalAlign": "middle",
                "marginLeft": 6,
                "marginRight": 5,
                "marginTop": 4,
                "marginBottom": 3
            },
            "font": {
                "name": "Consolas",
                "size": 16,
                "color": "#9400D3"
            },
            "frame": {
                "type": "rectangle",
                "width": 5,
                "color": "#DC982B",
                "fillColor": "#D4DAAD"
            },
            "sections": [
                {
                    "pos": 0,
                    "type": ""
                }
            ]
        },
        {
            "head": {
                "name": "元素3 - 图片",
                "elementType": "image"
            },
            "position": {
                "layer": 1,
                "width": 270,
                "height": 80,
                "left": 30,
                "top": 300
            },            
            "image": {
                "img": "img3",
                "deformation": "zoom"
            },
            "frame": {}
        },        
        {
            "head": {
                "name": "元素4 - 条码",
                "elementType": "barcode",
                "barcodeType": "Code128"
            },
            "position": {
                "layer": 1,
                "width": 350,
                "height": 100,
                "left": 300,
                "top": 160,
                "textAlign": "center",
                "verticalAlign": "middle",
                "marginTop": 10
            },
            "sections": [
                {
                    "pos": 0,
                    "type": "fixed",
                    "value": "元素4-固定值",
                    "format": ""
                },
                {
                    "pos": 1,
                    "type": "field",
                    "value": "客户名称",
                    "format": ""
                },
                {
                    "pos": 2,
                    "type": "symbol",
                    "value": "GS",
                    "format": ""
                },
                {
                    "pos": 3,
                    "type": ""
                }
            ],
            "segments": [
                {
                    "pos": 0,
                    "type": "fixed",
                    "value": "固定值1",
                    "format": ""
                },
                {
                    "pos": 1,
                    "type": "field",
                    "value": "客户代码",
                    "format": ""
                },
                {
                    "pos": 2,
                    "type": "symbol",
                    "value": "GS",
                    "format": ""
                },
                {
                    "pos": 3,
                    "type": ""
                }
            ],
            "font": {
                "name": "宋体",
                "size": 14,
                "bold": true,                
                "color": "#006400"
            },
            "frame": {}
        }
    ]
}
        `;
    }
    function getMock_LvKeMeng() {
        return `
{
  "head": {
    "width": 100,
    "height": 80
  },
  "fields": [
    {
      "k": "产品英文名称",
      "v": "Gardein Chipotle Lime Fingers"
    },
    {
      "k": "产品中文名称",
      "v": "柠香辣脆素鸡柳 9.5oz"
    },
    {
      "k": "条码",
      "v": "1234567890"
    }
  ],
  "images": [
    {
      "k": "img1",
      "v": "https://cn.vuejs.org/images/imooc-sponsor2.png"
    },
    {
      "k": "img2",
      "v": "http://www.masocloud.com/DoYsUI/project/aprint/image/main/user.png"
    },
    {
      "k": "img3",
      "v": "http://www.masocloud.com/DoYsUI/project/aprint/image/main/sub_system.png"
    },
    {
      "k": "img4",
      "v": "http://www.masocloud.com/DoYsUI/project/aprint/image/main/doys.png"
    }
  ],
  "elements": [
    {
      "head": {
        "name": "背景框",
        "elementType": "shape",
        "locked": true
      },
      "font": {
        "lineHeight": 0,
        "size": 12
      },
      "frame": {
        "type": "rectangle",
        "width": 5,
        "color": "#0D0A0A"
      },
      "position": {
        "layer": "0",
        "top": "10",
        "left": "10",
        "width": "600",
        "height": "350",
        "textAlign": "left",
        "verticalAlign": "top",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      }
    },
    {
      "head": {
        "name": "顶端背景色",
        "elementType": "shape",
        "locked": true
      },
      "font": {
        "lineHeight": 0,
        "size": 12
      },
      "frame": {
        "type": "rectangle",
        "width": 0,
        "fillColor": "#B7DBE8"
      },
      "position": {
        "layer": "0",
        "top": "15",
        "left": "15",
        "width": "590",
        "height": "80",
        "textAlign": "left",
        "verticalAlign": "top",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      }
    },
    {
      "head": {
        "name": "单价",
        "elementType": "text"
      },
      "sections": [
        {
          "pos": 0,
          "type": "fixed",
          "value": "$138.00",
          "format": ""
        },
        {
          "pos": 1,
          "type": "",
          "value": "",
          "format": ""
        }
      ],
      "font": {
        "lineHeight": 0,
        "size": "18",
        "bold": true,
        "name": "Arial"
      },
      "frame": {
        "type": "",
        "width": 0
      },
      "position": {
        "layer": 1,
        "top": 52,
        "left": 40,
        "width": 70,
        "height": 19,
        "textAlign": "left",
        "verticalAlign": "top",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      }
    },
    {
      "head": {
        "name": "会员价",
        "elementType": "text"
      },
      "sections": [
        {
          "pos": 0,
          "type": "fixed",
          "value": "$128.00",
          "format": ""
        },
        {
          "pos": 1,
          "type": "",
          "value": "",
          "format": ""
        }
      ],
      "font": {
        "lineHeight": 0,
        "size": "36",
        "bold": true,
        "name": "Arial"
      },
      "frame": {
        "type": "",
        "width": 0
      },
      "position": {
        "layer": 1,
        "top": 46,
        "left": 424,
        "width": 145,
        "height": 33,
        "textAlign": "right",
        "verticalAlign": "top",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      }
    },
    {
      "head": {
        "name": "C",
        "elementType": "text"
      },
      "sections": [
        {
          "pos": 0,
          "type": "fixed",
          "value": "C",
          "format": ""
        },
        {
          "pos": 1,
          "type": "",
          "value": "",
          "format": ""
        }
      ],
      "font": {
        "lineHeight": 0,
        "size": "18"
      },
      "frame": {
        "type": "",
        "width": 0
      },
      "position": {
        "layer": 1,
        "top": 25,
        "left": 565,
        "width": 17,
        "height": 18,
        "textAlign": "left",
        "verticalAlign": "top",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      }
    },
    {
      "head": {
        "name": "doys_label_element_6",
        "elementType": "text"
      },
      "sections": [
        {
          "pos": 0,
          "type": "field",
          "value": "产品英文名称",
          "format": ""
        },
        {
          "pos": 1,
          "type": "",
          "value": "",
          "format": ""
        }
      ],
      "font": {
        "lineHeight": 0,
        "size": "20",
        "name": "微软雅黑"
      },
      "frame": {
        "type": "",
        "width": 0
      },
      "position": {
        "layer": 1,
        "top": 131,
        "left": 52,
        "width": 509,
        "height": 40,
        "textAlign": "center",
        "verticalAlign": "middle",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      }
    },
    {
      "head": {
        "name": "doys_label_element_7",
        "elementType": "text"
      },
      "sections": [
        {
          "pos": 0,
          "type": "field",
          "value": "产品中文名称",
          "format": ""
        },
        {
          "pos": 1,
          "type": "",
          "value": "",
          "format": ""
        }
      ],
      "font": {
        "lineHeight": 0,
        "size": "20",
        "name": "微软雅黑"
      },
      "frame": {
        "type": "",
        "width": 0
      },
      "position": {
        "layer": 1,
        "top": 183,
        "left": 54,
        "width": 510,
        "height": 54,
        "textAlign": "center",
        "verticalAlign": "middle",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      }
    },
    {
      "head": {
        "name": "doys_label_element_8",
        "elementType": "barcode",
        "barcodeType": "Code128"
      },
      "sections": [
        {
          "pos": 0,
          "type": "fixed",
          "value": "12345678",
          "format": ""
        },
        {
          "pos": 1,
          "type": "",
          "value": "",
          "format": ""
        }
      ],
      "font": {
        "lineHeight": 0,
        "size": 12
      },
      "frame": {
        "type": "",
        "width": 0
      },
      "position": {
        "layer": 1,
        "top": 302,
        "left": 333,
        "width": 250,
        "height": 32,
        "textAlign": "center",
        "verticalAlign": "top",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      },
      "segments": [
        {
          "pos": 0,
          "type": "field",
          "value": "条码",
          "format": ""
        },
        {
          "pos": 1,
          "type": "",
          "value": "",
          "format": ""
        }
      ]
    },
    {
      "head": {
        "name": "doys_label_element_9",
        "elementType": "image"
      },
      "font": {
        "lineHeight": 0,
        "size": 12
      },
      "frame": {
        "type": "",
        "width": 0
      },
      "position": {
        "layer": 1,
        "top": "250",
        "left": 39,
        "width": "50",
        "height": "50",
        "textAlign": "left",
        "verticalAlign": "top",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      },
      "image": {
        "img": "img2",
        "deformation": "zoom",
        "url": "http://www.masocloud.com/DoYsUI/project/aprint/image/main/user.png"
      }
    },
    {
      "head": {
        "name": "doys_label_element_10",
        "elementType": "image"
      },
      "font": {
        "lineHeight": 0,
        "size": 12
      },
      "frame": {
        "type": "",
        "width": 0
      },
      "position": {
        "layer": 1,
        "top": "250",
        "left": 104,
        "width": "50",
        "height": "50",
        "textAlign": "left",
        "verticalAlign": "top",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      },
      "image": {
        "img": "img3",
        "deformation": "zoom",
        "url": "http://www.masocloud.com/DoYsUI/project/aprint/image/main/sub_system.png"
      }
    },
    {
      "head": {
        "name": "doys_label_element_21",
        "elementType": "text"
      },
      "sections": [
        {
          "pos": 0,
          "type": "fixed",
          "value": "Canada",
          "format": ""
        },
        {
          "pos": 1,
          "type": "",
          "value": "",
          "format": ""
        }
      ],
      "font": {
        "lineHeight": 0,
        "size": "14",
        "name": "Arial"
      },
      "frame": {
        "type": "",
        "width": 0
      },
      "position": {
        "layer": 1,
        "top": 326,
        "left": 25,
        "width": 53,
        "height": 21,
        "textAlign": "left",
        "verticalAlign": "top",
        "marginLeft": 0,
        "marginRight": 0,
        "marginTop": 0,
        "marginBottom": 0
      }
    }
  ]
}
        `;
    }
</script>